C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 1   


C51 COMPILER V6.14, COMPILATION OF MODULE FLASH
OBJECT MODULE PLACED IN .\OUT\flash.obj
COMPILER INVOKED BY: c:\Keil\C51\BIN\C51.EXE .\flash.c BROWSE DEBUG OBJECTEXTEND CODE LISTINCLUDE SYMBOLS PRINT(.\LST\fl
                    -ash.lst) OBJECT(.\OUT\flash.obj) 

stmt level    source

   1          #include "flash.h"
   1      =1  #ifndef __FLASH_H
   2      =1  #define __FLASH_H
   3      =1  
   4      =1  #include "com.h"
   1      =2  #ifndef __COM_H
   2      =2  #define __COM_H
   3      =2  
   4      =2  #include "reg66x.h"
   1      =3  /*-------------------------------------------------------------------------
   2      =3  REG66x.H
   3      =3  
   4      =3  Header file for Philips 8xC660/662/664
   5      =3    
   6      =3  Copyright (c) 1988-2001 Keil Elektronik GmbH and Keil Software, Inc.
   7      =3  All rights reserved.
   8      =3  -------------------------------------------------------------------------*/
   9      =3  
  10      =3  sfr  P0      =   0x80;			 
  11      =3  
  12      =3  sbit  AD7    =   P0^7;
  13      =3  sbit  AD6    =   P0^6;
  14      =3  sbit  AD5    =   P0^5;
  15      =3  sbit  AD4    =   P0^4;
  16      =3  sbit  AD3    =   P0^3;
  17      =3  sbit  AD2    =   P0^2;
  18      =3  sbit  AD1    =   P0^1;
  19      =3  sbit  AD0    =   P0^0;
  20      =3  
  21      =3  sfr  SP      =   0x81;
  22      =3  sfr  DPL     =   0x82;
  23      =3  sfr  DPH     =   0x83;
  24      =3  
  25      =3  sfr  PCON    =   0x87;			 
  26      =3  
  27      =3  sfr  TCON    =   0x88;             
  28      =3  
  29      =3  sbit  TF1    =   TCON^7;
  30      =3  sbit  TR1    =   TCON^6;
  31      =3  sbit  TF0    =   TCON^5;
  32      =3  sbit  TR0    =   TCON^4;
  33      =3  sbit  IE1_   =   TCON^3;
  34      =3  sbit  IT1    =   TCON^2;
  35      =3  sbit  IE0_   =   TCON^1;
  36      =3  sbit  IT0    =   TCON^0;
  37      =3  
  38      =3  sfr  TMOD    =   0x89;			 
  39      =3  
  40      =3  sfr  TL0     =   0x8A;			 
  41      =3  
  42      =3  sfr  TL1     =   0x8B;			 
  43      =3  
  44      =3  sfr  TH0     =   0x8C;			 
  45      =3  
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 2   

  46      =3  sfr  TH1     =   0x8D;			 
  47      =3  
  48      =3  sfr  P1      =   0x90;			 
  49      =3  
  50      =3  sbit  SDA     =   P1^7;
  51      =3  sbit  SCL     =   P1^6;
  52      =3  sbit  CEX2    =   P1^5;
  53      =3  sbit  CEX1    =   P1^4;
  54      =3  sbit  CEX0    =   P1^3;
  55      =3  sbit  ECI     =   P1^2;
  56      =3  sbit  T2EX    =   P1^1;
  57      =3  sbit  T2      =   P1^0;
  58      =3  
  59      =3  
  60      =3  sbit  P17     =   P1^7;
  61      =3  sbit  P16     =   P1^6;
  62      =3  sbit  P15    =   P1^5;
  63      =3  sbit  P14    =   P1^4;
  64      =3  sbit  P13    =   P1^3;
  65      =3  sbit  P12     =   P1^2;
  66      =3  sbit  P11    =   P1^1;
  67      =3  sbit  P10      =   P1^0;
  68      =3  
  69      =3  
  70      =3  sfr  S0CON    =   0x98;			 
  71      =3  sfr  S1CON    =	  0xD8;
  72      =3  
  73      =3  sbit  SM0    =   S0CON^7;
  74      =3  sbit  FE     =   S0CON^7;
  75      =3  sbit  SM1    =   S0CON^6;
  76      =3  sbit  SM2    =   S0CON^5;
  77      =3  sbit  REN    =   S0CON^4;
  78      =3  sbit  TB8    =   S0CON^3;
  79      =3  sbit  RB8    =   S0CON^2;
  80      =3  sbit  TI     =   S0CON^1;
  81      =3  sbit  RI     =   S0CON^0;
  82      =3  
  83      =3  sbit  CR2    =   S1CON^7;
  84      =3  sbit  ENS1   =   S1CON^6;
  85      =3  sbit  STA    =   S1CON^5;
  86      =3  sbit  STO    =   S1CON^4;
  87      =3  sbit  SI     =   S1CON^3;
  88      =3  sbit  AA     =   S1CON^2;
  89      =3  sbit  CR1    =   S1CON^1;
  90      =3  sbit  CR0    =   S1CON^0;
  91      =3  
  92      =3  sfr  SBUF    =   0x99;			 
  93      =3  
  94      =3  sfr  P2      =   0xA0;			 
  95      =3  
  96      =3  sbit  AD15    =   P2^7;
  97      =3  sbit  AD14    =   P2^6;
  98      =3  sbit  AD13    =   P2^5;
  99      =3  sbit  AD12    =   P2^4;
 100      =3  sbit  AD11    =   P2^3;
 101      =3  sbit  AD10    =   P2^2;
 102      =3  sbit  AD9     =   P2^1;
 103      =3  sbit  AD8     =   P2^0;
 104      =3  
 105      =3  
 106      =3  sbit  P27    =   P2^7;
 107      =3  sbit  P26    =   P2^6;
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 3   

 108      =3  sbit  P25    =   P2^5;
 109      =3  sbit  P24    =   P2^4;
 110      =3  sbit  P23    =   P2^3;
 111      =3  sbit  P22    =   P2^2;
 112      =3  sbit  P21    =   P2^1;
 113      =3  sbit  P20    =   P2^0;
 114      =3  
 115      =3  
 116      =3  sfr  IEN0    =   0xA8;
 117      =3  
 118      =3  sbit  EA     =   IEN0^7;
 119      =3  sbit  EC     =   IEN0^6;
 120      =3  sbit  ES1    =   IEN0^5;
 121      =3  sbit  ES0    =   IEN0^4;
 122      =3  sbit  ET1    =   IEN0^3;
 123      =3  sbit  EX1    =   IEN0^2;
 124      =3  sbit  ET0    =   IEN0^1;
 125      =3  sbit  EX0    =   IEN0^0;
 126      =3  
 127      =3  sfr IEN1	= 0xE8;
 128      =3  
 129      =3  sbit  ET2    =   IEN1^0;
 130      =3  
 131      =3  
 132      =3  sfr  SADDR   =   0xA9;			 
 133      =3  
 134      =3  sfr  P3      =   0xB0;			 
 135      =3  
 136      =3  sbit  RD      =   P3^7;
 137      =3  sbit  WR      =   P3^6;
 138      =3  sbit  T1      =   P3^5;
 139      =3  sbit  T0      =   P3^4;
 140      =3  sbit  INT1    =   P3^3;
 141      =3  sbit  INT0    =   P3^2;
 142      =3  sbit  TXD     =   P3^1;
 143      =3  sbit  RXD     =   P3^0;
 144      =3  
 145      =3  sfr  IPH      =   0xB7;			     
 146      =3  sfr  IP       =   0xB8;
 147      =3  
 148      =3  
 149      =3  sfr  SADEN   =   0xB9;			 
 150      =3  	
 151      =3  
 152      =3  sbit  PT2      =   IP^7;
 153      =3  sbit  PPC      =   IP^6;
 154      =3  sbit  PS1      =   IP^5;
 155      =3  sbit  PS0      =   IP^4;
 156      =3  sbit  PT1      =   IP^3;
 157      =3  sbit  PX1      =   IP^2;
 158      =3  sbit  PT0      =   IP^2;
 159      =3  sbit  PX0      =   IP^2;
 160      =3  
 161      =3  sfr  T2CON   =   0xC8;             
 162      =3  
 163      =3  sbit  TF2    =   T2CON^7;
 164      =3  sbit  EXF2   =   T2CON^6;
 165      =3  sbit  RCLK   =   T2CON^5;
 166      =3  sbit  TCLK   =   T2CON^4;
 167      =3  sbit  EXEN2  =   T2CON^3;
 168      =3  sbit  TR2    =   T2CON^2;
 169      =3  sbit  CT2    =   T2CON^1;
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 4   

 170      =3  sbit  CP     =   T2CON^0;
 171      =3  
 172      =3  sfr  T2MOD   =   0xC9;			 
 173      =3  
 174      =3  sfr  RCAP2L  =   0xCA;			 
 175      =3  sfr  RCAP2H  =   0xCB;			 
 176      =3  sfr  TL2     =   0xCC;			 
 177      =3  sfr  TH2     =   0xCD;			 
 178      =3  
 179      =3  sfr  PSW     =   0xD0;			 
 180      =3  sbit  CY     =   PSW^7;
 181      =3  sbit  AC     =   PSW^6;
 182      =3  sbit  F0     =   PSW^5;
 183      =3  sbit  RS1    =   PSW^4;
 184      =3  sbit  RS0    =   PSW^3;
 185      =3  sbit  OV     =   PSW^2;
 186      =3  sbit  UD     =   PSW^1;
 187      =3  sbit  P      =   PSW^0;
 188      =3  
 189      =3  			 
 190      =3  sfr  ACC     =   0xE0;			 
 191      =3  sfr  B       =   0xF0;			 
 192      =3  
 193      =3  sfr  CCON    =   0xC0;	
 194      =3  sbit  CF     =   CCON^7;
 195      =3  sbit  CR     =   CCON^6;
 196      =3  sbit  CCF4   =   CCON^4;
 197      =3  sbit  CCF3   =   CCON^3;
 198      =3  sbit  CCF2   =   CCON^2;
 199      =3  sbit  CCF1   =   CCON^1;
 200      =3  sbit  CCF0   =   CCON^0;		 
 201      =3  
 202      =3  sfr  CMOD    =   0xC1;			 
 203      =3  sfr  CCAPM0  =   0xC2;			 
 204      =3  sfr  CCAPM1  =   0xC3;			 
 205      =3  sfr  CCAPM2  =   0xC4;			 
 206      =3  sfr  CCAPM3  =   0xC5;			 
 207      =3  sfr  CCAPM4  =   0xC6;	
 208      =3  
 209      =3  sfr  CL      =   0xE9;			 
 210      =3  sfr  CCAP0L  =   0xEA;			 
 211      =3  sfr  CCAP1L  =   0xEB;			 
 212      =3  sfr  CCAP2L  =   0xEC;			 
 213      =3  sfr  CCAP3L  =   0xED;			 
 214      =3  sfr  CCAP4L  =   0xEE;			 
 215      =3  
 216      =3  sfr  CH      =   0xF9;			 
 217      =3  sfr  CCAP0H  =   0xFA;			 
 218      =3  sfr  CCAP1H  =   0xFB;			  
 219      =3  sfr  CCAP2H  =   0xFC;			 
 220      =3  sfr  CCAP3H  =   0xFD;			 
 221      =3  sfr  CCAP4H  =   0xFE;	
 222      =3  
 223      =3  
 224      =3  
 225      =3  sfr AUXR	= 0x8E;
 226      =3  sfr AUXR1	= 0xA2;
 227      =3  
 228      =3  sfr     S1DAT	=       0xDA;
 229      =3  sfr	S1IST	=	0xDC;
 230      =3  sfr	S1ADR	=	0xDB;
 231      =3  sfr	S1STA	=	0xD9;
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 5   

 232      =3  
 233      =3  sfr     WDTRST =       0xA6;
   5      =2  #include <stdio.h>
   1      =3  /*--------------------------------------------------------------------------
   2      =3  STDIO.H
   3      =3  
   4      =3  Prototypes for standard I/O functions.
   5      =3  Copyright (c) 1988-2001 Keil Elektronik GmbH and Keil Software, Inc.
   6      =3  All rights reserved.
   7      =3  --------------------------------------------------------------------------*/
   8      =3  
   9      =3  #ifndef EOF
  10      =3   #define EOF -1
  11      =3  #endif
  12      =3  
  13      =3  #ifndef NULL
  14      =3   #define NULL ((void *) 0)
  15      =3  #endif
  16      =3  
  17      =3  #ifndef _SIZE_T
  18      =3   #define _SIZE_T
  19      =3   typedef unsigned int size_t;
  20      =3  #endif
  21      =3  
  22      =3  #pragma SAVE
  23      =3  #pragma REGPARMS
  24      =3  extern char _getkey (void);
  25      =3  extern char getchar (void);
  26      =3  extern char ungetchar (char);
  27      =3  extern char putchar (char);
  28      =3  extern int printf   (const char *, ...);
  29      =3  extern int sprintf  (char *, const char *, ...);
  30      =3  extern int vprintf  (const char *, char *);
  31      =3  extern int vsprintf (char *, const char *, char *);
  32      =3  extern char *gets (char *, int n);
  33      =3  extern int scanf (const char *, ...);
  34      =3  extern int sscanf (char *, const char *, ...);
  35      =3  extern int puts (const char *);
  36      =3  
  37      =3  #pragma RESTORE
   6      =2  #include <string.h>
   1      =3  /*--------------------------------------------------------------------------
   2      =3  STRING.H
   3      =3  
   4      =3  String functions.
   5      =3  Copyright (c) 1988-2001 Keil Elektronik GmbH and Keil Software, Inc.
   6      =3  All rights reserved.
   7      =3  --------------------------------------------------------------------------*/
   8      =3  
   9      =3  #ifndef _SIZE_T
           =3  #define _SIZE_T
           =3  typedef unsigned int size_t;
           =3 #endif
  13      =3  
  14      =3  #ifndef NULL
           =3  #define NULL ((void *) 0L)
           =3 #endif
  17      =3  
  18      =3  #pragma SAVE
  19      =3  #pragma REGPARMS
  20      =3  extern char *strcat (char *s1, char *s2);
  21      =3  extern char *strncat (char *s1, char *s2, int n);
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 6   

  22      =3  
  23      =3  extern char strcmp (char *s1, char *s2);
  24      =3  extern char strncmp (char *s1, char *s2, int n);
  25      =3  
  26      =3  extern char *strcpy (char *s1, char *s2);
  27      =3  extern char *strncpy (char *s1, char *s2, int n);
  28      =3  
  29      =3  extern int strlen (char *);
  30      =3  
  31      =3  extern char *strchr (const char *s, char c);
  32      =3  extern int strpos (const char *s, char c);
  33      =3  extern char *strrchr (const char *s, char c);
  34      =3  extern int strrpos (const char *s, char c);
  35      =3  
  36      =3  extern int strspn (char *s, char *set);
  37      =3  extern int strcspn (char *s, char *set);
  38      =3  extern char *strpbrk (char *s, char *set);
  39      =3  extern char *strrpbrk (char *s, char *set);
  40      =3  extern char *strstr  (char *s, char *sub);
  41      =3  
  42      =3  extern char memcmp (void *s1, void *s2, int n);
  43      =3  extern void *memcpy (void *s1, void *s2, int n);
  44      =3  extern void *memchr (void *s, char val, int n);
  45      =3  extern void *memccpy (void *s1, void *s2, char val, int n);
  46      =3  extern void *memmove (void *s1, void *s2, int n);
  47      =3  extern void *memset  (void *s, char val, int n);
  48      =3  #pragma RESTORE
   7      =2  
   8      =2  // Function to initialize the serial port and the UART baudrate.
   9      =2  extern unsigned char xdata Rec_flag;
  10      =2  
  11      =2  extern void com_initialize (void); 
  12      =2  
  13      =2  //putachar: write a character to SBUF or transmission buffer
  14      =2  extern int putachar(char c);
  15      =2  
  16      =2  //putbuf: write string to SBUF or transmission buffer
  17      =2  extern void putbuf (char *pch); 
  18      =2  extern void putlenbuf (char *pch, int len); 
  19      =2  
  20      =2  // Replacement routine for the standard library _getkey routine.
  21      =2  // The getchar and gets functions uses _getkey to read a character.
  22      =2  extern char GetKey (char * C); 
  23      =2  
  24      =2  extern void ClearRcvBuf();
  25      =2  
  26      =2  #endif
  27      =2  
   5      =1  #define MAXFLASH 6
   6      =1  #define MAXFILENUM 200
   7      =1  
   8      =1  extern unsigned char xdata ckb;
   9      =1  extern unsigned int  xdata ErrorFlash;
  10      =1  extern unsigned char xdata wdata_buffer[512];		//flash write data buffer
  11      =1  extern unsigned char xdata wparameter_buffer[16];	//data parameter buffer
  12      =1  extern unsigned char xdata rdata_buffer[512];		//flash read data buffer
  13      =1  extern unsigned char xdata rparameter_buffer[16];	//data parameter buffer
  14      =1  
  15      =1  extern unsigned char xdata NowFileName;
  16      =1  
  17      =1  extern unsigned char xdata FileStart[MAXFILENUM][4];//Where is the file
  18      =1  extern unsigned char xdata FileSize[MAXFILENUM][4]; // 各文件大小
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 7   

  19      =1  extern unsigned char xdata FileNumber;//How many files in the flash
  20      =1  
  21      =1  extern unsigned char xdata ADDR9_16;
  22      =1  extern unsigned char xdata ADDR17_24;
  23      =1  extern unsigned char xdata ADDR25;
  24      =1  extern unsigned char xdata UseChip;
  25      =1  extern unsigned char xdata Erasel;
  26      =1  
  27      =1  extern void FindFlash();
  28      =1  extern void EraseFlash();
  29      =1  extern unsigned char FlashChip[MAXFLASH];
  30      =1  extern void EraseOneFlash(unsigned char i);
  31      =1  extern void EraseHalfFlash();
  32      =1  extern void EraseOneBlock();
  33      =1  extern void WriteOnePage();
  34      =1  extern void ReadOnePage();
  35      =1  extern void ReadOnePage_C();
  36      =1  extern unsigned char receive();
  37      =1  extern void FlashReady(int chip,unsigned char addr9_16,unsigned char addr17_24,unsigned char addr25);
  38      =1  
  39      =1  extern void FindEnd();
  40      =1  //extern int FindNextPage();
  41      =1  extern int FindPage(unsigned long int offset);
  42      =1  extern int FindNextBlock(unsigned long int offset);
  43      =1  extern int FindPrvBlock();
  44      =1  extern void FindFiles();
  45      =1  
  46      =1  extern void InitFlash();
  47      =1  //extern void delay(int count);
  48      =1  extern void ReadoneChip_leavefactory_invalidblock(unsigned char Chipi);
  49      =1  extern void ReadallChip_leavefactory_invalidblock();
  50      =1  extern void TestoneChip_Status_information(unsigned char Chipi);
  51      =1  extern void TestallChip_Status_information();
  52      =1  extern int USBSendData(unsigned char* buf, unsigned char len);
  53      =1  
  54      =1  union UNION_Data{
  55      =1  	unsigned char ch[4];
  56      =1  	long int i;
  57      =1  };
  58      =1  extern union UNION_Data U_Data;
  59      =1  extern unsigned int xdata ErrorBlock;
  60      =1  extern unsigned int xdata FileSumCheck;
  61      =1  extern unsigned char xdata tmpBuf[100];
  62      =1  
  63      =1  #endif
   2          #include "isr.h"
   1      =1  /*
   2      =1     //*************************************************************************
   3      =1     //
   4      =1     //                  		ZLGMCU
   5      =1     //				www.zlgmcu.com
   6      =1     // File Name:	ISR.h
   7      =1     // Revision:		V0.2(2002-04-08)
   8      =1     // Use library:  	USB51S.LIB
   9      =1     // Note:		USB51S.LIB不带DMA控制功能
  10      =1     //*************************************************************************
  11      =1     */
  12      =1  
  13      =1  #ifndef __ISR_H__
  14      =1  #define __ISR_H__
  15      =1  
  16      =1     /*
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 8   

  17      =1     //*************************************************************************
  18      =1     // D12控制引脚定义
  19      =1     //*************************************************************************
  20      =1     */
  21      =1  
  22      =1  	sbit MCU_D12CS	  = P1^6;
  23      =1  	
  24      =1  	sbit MCU_D12RST   = P1^7;
  25      =1  	//sbit MCU_D12RST   = P3^5;
  26      =1  	
  27      =1  	sbit D12SUSPD	  = P3^3;
  28      =1  
  29      =1  
  30      =1  /*
  31      =1     //*************************************************************************
  32      =1     // basic #defines
  33      =1     //*************************************************************************
  34      =1     */
  35      =1  
  36      =1  #define DISABLE		EA=0
  37      =1  #define ENABLE		EA=1
  38      =1  
  39      =1  
  40      =1  #define MAX_ENDPOINTS      (unsigned char)0x3
  41      =1  
  42      =1  #define EP0_TX_FIFO_SIZE   16
  43      =1  #define EP0_RX_FIFO_SIZE   16
  44      =1  #define EP0_PACKET_SIZE    16
  45      =1  
  46      =1  #define EP1_TX_FIFO_SIZE   4
  47      =1  #define EP1_RX_FIFO_SIZE   4
  48      =1  #define EP1_PACKET_SIZE    4
  49      =1  
  50      =1  #define EP2_TX_FIFO_SIZE   64
  51      =1  #define EP2_RX_FIFO_SIZE   64
  52      =1  #define EP2_PACKET_SIZE    64
  53      =1  
  54      =1  #define D12_NOLAZYCLOCK			0x02
  55      =1  #define D12_CLOCKRUNNING        0x04
  56      =1  #define D12_INTERRUPTMODE		0x08
  57      =1  #define D12_SOFTCONNECT			0x10
  58      =1  #define D12_ENDP_NONISO			0x00
  59      =1  #define D12_ENDP_ISOOUT			0x40
  60      =1  #define D12_ENDP_ISOIN			0x80
  61      =1  #define D12_ENDP_ISOIO			0xC0
  62      =1  
  63      =1  #define D12_CLOCK_12M			0x03
  64      =1  #define D12_CLOCK_4M			0x0b
  65      =1  #define D12_SETTOONE            0x40
  66      =1  #define D12_SOFONLY				0x80
  67      =1  
  68      =1  /*
  69      =1     //*************************************************************************
  70      =1     // masks
  71      =1     //*************************************************************************
  72      =1  */
  73      =1  
  74      =1  #define USB_RECIPIENT            (unsigned char)0x1F
  75      =1  #define USB_RECIPIENT_DEVICE     (unsigned char)0x00
  76      =1  #define USB_RECIPIENT_INTERFACE  (unsigned char)0x01
  77      =1  #define USB_RECIPIENT_ENDPOINT   (unsigned char)0x02
  78      =1  
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 9   

  79      =1  #define USB_REQUEST_TYPE_MASK    (unsigned char)0x60
  80      =1  #define USB_STANDARD_REQUEST     (unsigned char)0x00
  81      =1  #define USB_CLASS_REQUEST        (unsigned char)0x20
  82      =1  #define USB_VENDOR_REQUEST       (unsigned char)0x40
  83      =1  
  84      =1  #define USB_REQUEST_MASK         (unsigned char)0x0F
  85      =1  
  86      =1  #define DEVICE_ADDRESS_MASK      0x7F
  87      =1  
  88      =1  #define USB_ENDPOINT_DIRECTION_MASK               0x80
  89      =1  
  90      =1  
  91      =1  /*
  92      =1     //*************************************************************************
  93      =1     // macros
  94      =1     //*************************************************************************
  95      =1  */
  96      =1  #define SWAP(x)   ((((x) & 0xFF) << 8) | (((x) >> 8) & 0xFF))
  97      =1  
  98      =1  #define MSB(x)    (((x) >> 8) & 0xFF)
  99      =1  #define LSB(x)    ((x) & 0xFF)
 100      =1  
 101      =1  #define FALSE   0
 102      =1  #define TRUE    (!FALSE)
 103      =1  
 104      =1  /*
 105      =1     //*************************************************************************
 106      =1     // basic typedefs
 107      =1     //*************************************************************************
 108      =1  */
 109      =1  typedef unsigned char   UCHAR;
 110      =1  typedef unsigned short  USHORT;
 111      =1  typedef unsigned long   ULONG;
 112      =1  typedef unsigned char   BOOL;
 113      =1  
 114      =1  /*
 115      =1     //*************************************************************************
 116      =1     // structure and union definitions
 117      =1     //*************************************************************************
 118      =1  */
 119      =1  typedef union _epp_flags
 120      =1  {
 121      =1  	struct _flags
 122      =1  	{
 123      =1  		unsigned char timer               	: 1;
 124      =1  		unsigned char bus_reset           	: 1;
 125      =1  		unsigned char suspend             	: 1;
 126      =1  		unsigned char setup_packet  	  	: 1;
 127      =1  		unsigned char remote_wakeup		   	: 1;
 128      =1  		unsigned char in_isr		      	: 1;
 129      =1  		unsigned char control_state			: 2;
 130      =1  
 131      =1  		unsigned char configuration			: 1;
 132      =1  		unsigned char command				: 1;
 133      =1  		unsigned char ep1_rxdone			: 1;
 134      =1  		unsigned char ep2_rxdone			: 1; //Add by Liu Ying Bin
 135      =1  	} bits;
 136      =1  	unsigned short value;
 137      =1  } EPPFLAGS;
 138      =1  
 139      =1  typedef union _rom_addr 
 140      =1  {
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 10  

 141      =1  	struct _bytes
 142      =1  	{
 143      =1  		unsigned char high;
 144      =1  		unsigned char low;
 145      =1  	}byte;
 146      =1  	unsigned int word;
 147      =1  }rom_addr;
 148      =1  
 149      =1  
 150      =1  typedef struct _device_request
 151      =1  {
 152      =1  	unsigned char bmRequestType;
 153      =1  	unsigned char bRequest;
 154      =1  	unsigned short wValue;
 155      =1  	unsigned short wIndex;
 156      =1  	unsigned short wLength;
 157      =1  } DEVICE_REQUEST;
 158      =1  
 159      =1  typedef struct _IO_REQUEST {
 160      =1  	unsigned short	uAddressL;
 161      =1  	unsigned char	bAddressH;
 162      =1  	unsigned short	uSize;
 163      =1  	unsigned char	bCommand;
 164      =1  } IO_REQUEST, *PIO_REQUEST;
 165      =1  
 166      =1  #define MAX_CONTROLDATA_SIZE	8
 167      =1  
 168      =1  typedef struct _control_xfer
 169      =1  {
 170      =1  	DEVICE_REQUEST DeviceRequest;
 171      =1  	unsigned short wLength;
 172      =1  	unsigned short wCount;
 173      =1  	unsigned char * pData;
 174      =1  	unsigned char dataBuffer[MAX_CONTROLDATA_SIZE];
 175      =1  } CONTROL_XFER;
 176      =1  
 177      =1  /*
 178      =1     //*************************************************************************
 179      =1     // USB utility functions
 180      =1     //*************************************************************************
 181      =1  */
 182      =1  
 183      =1  extern void disconnect_USB(void);
 184      =1  extern void connect_USB(void);
 185      =1  extern void reconnect_USB(void);
 186      =1  extern void init_unconfig(void);
 187      =1  extern void init_config(void);
 188      =1  extern void single_transmit(unsigned char * pData, unsigned char len);
 189      =1  extern void code_transmit(unsigned char code * pRomData, unsigned short len);
 190      =1  extern void control_handler(void);
 191      =1  extern void reserved(void);
 192      =1  extern void fn_usb_isr(void);
 193      =1  extern void usbserve(void);
 194      =1  extern void D12_SetMode(unsigned char bConfig, unsigned char bClkDiv);
 195      =1  extern void D12_SetDMA(unsigned char bMode);
 196      =1  extern unsigned char D12_ReadLastTransactionStatus(unsigned char bEndp);
 197      =1  extern unsigned char D12_ReadEndpoint(unsigned char endp, unsigned char len, unsigned char * buf);
 198      =1  extern unsigned char D12_WriteEndpoint(unsigned char endp, unsigned char len, unsigned char * buf);
 199      =1  extern char data sendover;
 200      =1  extern unsigned char Readlens;
 201      =1  
 202      =1  #endif
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 11  

 203      =1  
 204      =1  
 205      =1  
   3          #include <absacc.h>
   1      =1  /*--------------------------------------------------------------------------
   2      =1  ABSACC.H
   3      =1  
   4      =1  Direct access to 8051, extended 8051 and Philips 80C51MX memory areas.
   5      =1  Copyright (c) 1988-2001 Keil Elektronik GmbH and Keil Software, Inc.
   6      =1  All rights reserved.
   7      =1  --------------------------------------------------------------------------*/
   8      =1  
   9      =1  #define CBYTE ((unsigned char volatile code  *) 0)
  10      =1  #define DBYTE ((unsigned char volatile data  *) 0)
  11      =1  #define PBYTE ((unsigned char volatile pdata *) 0)
  12      =1  #define XBYTE ((unsigned char volatile xdata *) 0)
  13      =1  
  14      =1  #define CWORD ((unsigned int volatile code  *) 0)
  15      =1  #define DWORD ((unsigned int volatile data  *) 0)
  16      =1  #define PWORD ((unsigned int volatile pdata *) 0)
  17      =1  #define XWORD ((unsigned int volatile xdata *) 0)
  18      =1  
  19      =1  
  20      =1  #ifdef __CX51__
           =1 #define FVAR(object, addr)   (*((object volatile far *) (addr)))
           =1 #define FARRAY(object, base) ((object volatile far *) (base))
           =1 #else
  24      =1  #define FVAR(object, addr)    (*((object volatile far *) ((addr)+0x10000L)))
  25      =1  #define FCVAR(object, addr)   (*((const object far *) ((addr)+0x810000L)))
  26      =1  #define FARRAY(object, base)  ((object volatile far *) ((base)+0x10000L))
  27      =1  #define FCARRAY(object, base) ((const object volatile far *) ((base)+0x810000L))
  28      =1  #endif
   4          
   5          #define DEBUG_2 1
   6          
   7          //unsigned char status;				//flash status
   8          unsigned char xdata wdata_buffer[512];		//flash write data buffer
   9          unsigned char xdata wparameter_buffer[16];	//data parameter buffer
  10          unsigned char xdata rdata_buffer[512];		//flash read data buffer
  11          unsigned char xdata rparameter_buffer[16];	//data parameter buffer
  12          unsigned int  xdata ErrorFlash;
  13          unsigned char  xdata ckb;
  14          
  15          unsigned char xdata NowFileName; 				// 当前记录文件名称
  16          
  17          unsigned char xdata FileStart[MAXFILENUM][4];	//各文件的起始位置
  18          unsigned char xdata FileSize[MAXFILENUM][4]; 	// 各文件大小
  19          unsigned char xdata FileNumber;					// 文件的数量
  20          unsigned char xdata bad[6];
  21          
  22          unsigned char xdata ADDR9_16;
  23          unsigned char xdata ADDR17_24;
  24          unsigned char xdata ADDR25;
  25          unsigned char xdata UseChip;
  26          unsigned char xdata ChipMark;
  27          unsigned int  xdata wChecknum;
  28          unsigned int  xdata rChecknum;
  29          unsigned char xdata BLOCKend = 0;
  30          unsigned char xdata BLOCKfir = 0;
  31          unsigned char xdata Erasel;
  32          unsigned char xdata num=0;
  33          
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 12  

  34          //unsigned char ckb;
  35          
  36          union UNION_Data U_Data;
  37          
  38          //if FlashChip[i] == 1 this chips exist else no this chip
  39          unsigned char  FlashChip[MAXFLASH];
  40          
  41          int CheckFlash()
  42          {
  43   1      	int i;
  44   1      	
  45   1      	if(U_Data.ch[1] > 0x1) {			//One Chip Have Been Operated
  46   2      	
  47   2              	for(i=UseChip+1; i < MAXFLASH; i++){
  48   3                   		if(FlashChip[i] == 0x40){
  49   4                       		UseChip = i;
  50   4                       		break;
  51   4      			}
  52   3      		}
  53   2      		if(i == MAXFLASH){
  54   3                    		UseChip = MAXFLASH;
  55   3                    		return 0;
  56   3      		}
  57   2              	U_Data.ch[3] = 0;
  58   2              	U_Data.ch[2] = 0;
  59   2              	U_Data.ch[1] = 0;
  60   2              	ADDR25 = U_Data.ch[1];
  61   2      		    ADDR9_16 = U_Data.ch[3];
  62   2      	    	ADDR17_24 = U_Data.ch[2];
  63   2      	    	
  64   2      	}
  65   1      	
  66   1      	return 1;
  67   1      	
  68   1      }
  69          
  70          
  71          int FindNextBlock(unsigned long int offset)
  72          {
  73   1          unsigned long int i  =0;
  74   1          unsigned long int len=0;
  75   1      	U_Data.ch[3] = ADDR9_16;
  76   1      	U_Data.ch[2] = ADDR17_24;
  77   1      	U_Data.ch[1] = ADDR25;
  78   1      	U_Data.ch[0] = 0;
  79   1      
  80   1      	len=offset*(0x20);
  81   1      
  82   1      	U_Data.i+=0x20;
  83   1      	if(U_Data.ch[0] != 0x00)
  84   1      	   return 0;
  85   1          if(U_Data.ch[1] > 0x01) 
  86   1      	{
  87   2              for(i=UseChip+1; i<MAXFLASH; i++)
  88   2      	    {
  89   3      	       if(FlashChip[i] == 0x40)
  90   3      	       {
  91   4                       UseChip = i;
  92   4                       break;
  93   4      	       }
  94   3      	    }
  95   2      	    if(i==MAXFLASH)
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 13  

  96   2      	    {
  97   3                 UseChip = MAXFLASH;
  98   3                 return 0;
  99   3      	    }
 100   2      		U_Data.i =0;
 101   2              ADDR25   =0x00;
 102   2      	    ADDR9_16 =0x00;
 103   2              ADDR17_24=0x00;
 104   2      	    ReadOnePage_C();
 105   2              while(rparameter_buffer[0] == 0x00)
 106   2      	    {
 107   3                   U_Data.i+=0x20;
 108   3      			 if(U_Data.ch[1]>0x01)
 109   3                   {
 110   4      			   	U_Data.i =0;
 111   4      				goto blockaddress;
 112   4       			 }
 113   3                   ADDR9_16 =U_Data.ch[3];
 114   3      			 ADDR17_24=U_Data.ch[2];
 115   3                   ADDR25   =U_Data.ch[1];
 116   3                   ReadOnePage_C();
 117   3      			 
 118   3      	    }
 119   2              if(rparameter_buffer[0] != 0x00)
 120   2      			goto blockaddress;
 121   2      	}
 122   1      	else
 123   1      	{
 124   2      	   ADDR25 = U_Data.ch[1];
 125   2      	   ADDR9_16 = U_Data.ch[3];
 126   2      	   ADDR17_24 = U_Data.ch[2];
 127   2             ReadOnePage_C();
 128   2             while(rparameter_buffer[0] == 0x00)
 129   2      	   {
 130   3                  U_Data.i+=0x20;
 131   3      			if(U_Data.ch[1]>0x01)
 132   3                  {
 133   4      			   U_Data.i =0;
 134   4      			   goto blockaddress;  
 135   4       			}
 136   3                  ADDR9_16 =U_Data.ch[3];
 137   3      			ADDR17_24=U_Data.ch[2];
 138   3                  ADDR25   =U_Data.ch[1];
 139   3                  ReadOnePage_C();
 140   3      			
 141   3      	   }
 142   2             if(rparameter_buffer[0]!=0x00)
 143   2                  goto blockaddress;
 144   2      
 145   2      	}
 146   1      blockaddress:
 147   1          ADDR9_16 =U_Data.ch[3];
 148   1      	ADDR17_24=U_Data.ch[2];
 149   1          ADDR25   =U_Data.ch[1];
 150   1        
 151   1      }
 152          
 153          int FindPrvBlock()
 154          {
 155   1        int i=0;
 156   1        if( (ADDR9_16==0x00)&&(ADDR17_24==0x00)&&(ADDR25==0x00) )
 157   1        { 
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 14  

 158   2            if(UseChip==0)//   this may not happen;
 159   2      	  {
 160   3               U_Data.i=0;
 161   3               goto prvblockaddress;
 162   3      	  }
 163   2            for(i=UseChip-1; i>=0; i--)
 164   2            {
 165   3               if(FlashChip[i] == 0x40)
 166   3               {
 167   4                  UseChip=i; 
 168   4                  break; 
 169   4               }
 170   3               else if(i==0)
 171   3               {
 172   4                  UseChip=MAXFLASH;
 173   4                  return 0;
 174   4               }
 175   3            }
 176   2      	  
 177   2            U_Data.ch[3]=0xe0;
 178   2            U_Data.ch[2]=0xff;
 179   2      	  U_Data.ch[1]=0x01;
 180   2      	  U_Data.ch[0]=0;
 181   2      
 182   2            ADDR9_16 =U_Data.ch[3];
 183   2            ADDR17_24=U_Data.ch[2];    
 184   2            ADDR25   =U_Data.ch[1];
 185   2            ReadOnePage_C();
 186   2      
 187   2            while(rparameter_buffer[0] == 0x00) 
 188   2            {
 189   3      	     U_Data.i-=0x20;
 190   3      		 if(U_Data.ch[0]>0x00)
 191   3      		 {
 192   4      		    U_Data.i=0;
 193   4                  goto prvblockaddress;
 194   4      		 } 
 195   3               ADDR9_16 =U_Data.ch[3];
 196   3               ADDR17_24=U_Data.ch[2];
 197   3               ADDR25   =U_Data.ch[1];
 198   3               ReadOnePage_C();
 199   3               if(rparameter_buffer[0] == 0xaa)
 200   3      		   break;
 201   3       
 202   3      	  }
 203   2            ADDR9_16 =U_Data.ch[3];
 204   2            ADDR17_24=U_Data.ch[2];
 205   2            ADDR25   =U_Data.ch[1];
 206   2      
 207   2        }
 208   1        else
 209   1        {
 210   2            U_Data.ch[3]=ADDR9_16;
 211   2            U_Data.ch[2]=ADDR17_24;
 212   2      	  U_Data.ch[1]=ADDR25;
 213   2      	  U_Data.ch[0]=0;
 214   2      
 215   2      	  U_Data.i-=0x20;
 216   2      	  ADDR9_16 =U_Data.ch[3];
 217   2            ADDR17_24=U_Data.ch[2];
 218   2            ADDR25   =U_Data.ch[1];
 219   2            ReadOnePage_C();
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 15  

 220   2      
 221   2            while(rparameter_buffer[0] == 0x00)
 222   2            {
 223   3      	     U_Data.i-=0x20;
 224   3      		 if(U_Data.ch[0] > 0x00)
 225   3      		 {
 226   4      		    U_Data.i=0;
 227   4                  goto prvblockaddress; 
 228   4      		 }
 229   3               ADDR9_16 =U_Data.ch[3];
 230   3               ADDR17_24=U_Data.ch[2];
 231   3               ADDR25   =U_Data.ch[1];
 232   3               ReadOnePage_C();
 233   3               if(rparameter_buffer[0] == 0xaa)
 234   3      		   break;
 235   3      
 236   3       	  }
 237   2            ADDR9_16 =U_Data.ch[3];
 238   2            ADDR17_24=U_Data.ch[2];
 239   2            ADDR25   =U_Data.ch[1];
 240   2      
 241   2        }
 242   1      prvblockaddress:
 243   1            ADDR9_16 =U_Data.ch[3];
 244   1            ADDR17_24=U_Data.ch[2];    
 245   1            ADDR25   =U_Data.ch[1];
 246   1      	  return 1;
 247   1         
 248   1      }
 249          int FindPage(unsigned long int offset)
 250          {
 251   1      	//int i;// j;
 252   1      	unsigned long int j,k,l,m,n;
 253   1      
 254   1      	U_Data.ch[3] = ADDR9_16;
 255   1      	U_Data.ch[2] = ADDR17_24;
 256   1      	U_Data.ch[1] = ADDR25;
 257   1      	U_Data.ch[0] = 0;
 258   1      
 259   1      	if(UseChip==0 && ADDR25==1 && ADDR17_24==0xff && ADDR9_16==0xdf)
 260   1       		U_Data.i = 0x1ffff;	
 261   1      
 262   1      	//坏块补丁说明：
 263   1      	//要有两种判断，
 264   1      	//第一种判断是所跳过的页中是否包括坏块，如果包括坏块的话，不能算坏块的页数；
 265   1      	//第二种判断是是否越过了flash，如果越了flash，修改地址。
 266   1      	//
 267   1      	
 268   1      	if((offset >= 0x20)||((ADDR9_16+offset)/0x20 != ADDR9_16/0x20)){	//原来的页与跳后的页不在一块中
 269   2      		k = offset/0x20;	//k为这次越页所要跳过的块数
 270   2      		//l = offset%0x20;	//l为所要越过的不足一块的页数
 271   2      		m = (unsigned long int)(ADDR9_16 - (ADDR9_16/0x20)*0x20);	//m为未跳转前当前页为当前块中的第几页
 272   2      		n = (unsigned long int)(ADDR9_16 - m);		// n为针对块号取整
 273   2      		j = (unsigned long int)(offset%0x20 + m);
 274   2      		l = (unsigned long int)j%0x20;  		// 跳转后在跳转块中的页序号
 275   2      		if(k != 0){					// 需要跳块
 276   3      			U_Data.i -= m;  //对齐当前块
 277   3      			for( ; k > 0; k--){
 278   4      				U_Data.i += 0x20;
 279   4      				if(CheckFlash() == 0)
 280   4      					return 0;
 281   4      				ADDR9_16 = U_Data.ch[3];
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 16  

 282   4      				ADDR17_24 = U_Data.ch[2];
 283   4      				ADDR25 = U_Data.ch[1];
 284   4      				//ReadOnePage();
 285   4      				ReadOnePage_C();
 286   4      				if(rparameter_buffer[0] == 0x00){
 287   5      					k++;
 288   5      					continue;
 289   5      				}else if((k == 1)&&(j >= 0x20)){	//最后一次循环，此块是好块，而且加上页偏移量还要再次跳块
 290   5      					U_Data.i += 0x20;
 291   5      					if(CheckFlash() == 0)
 292   5      						return 0;
 293   5      					ADDR9_16 = U_Data.ch[3];
 294   5      					ADDR17_24 = U_Data.ch[2];
 295   5      					ADDR25 = U_Data.ch[1];
 296   5      					//ReadOnePage();
 297   5      					ReadOnePage_C();
 298   5      					while(rparameter_buffer[0] == 0x00){
 299   6      						U_Data.i += 0x20;
 300   6      						if(CheckFlash() == 0)
 301   6      							return 0;
 302   6      						ADDR9_16 = U_Data.ch[3];
 303   6      						ADDR17_24 = U_Data.ch[2];
 304   6      						ADDR25 = U_Data.ch[1];
 305   6      						//ReadOnePage();
 306   6      						ReadOnePage_C();
 307   6      					}
 308   5      				}
 309   4      			}
 310   3      		}				//所要跳过的总页数不足一块，目的地址在下一个好块中
 311   2      		else
 312   2      			U_Data.i += (0x20 - m);		//下一好块的第一页，即对齐块号
 313   2      		if(CheckFlash() == 0)
 314   2      			return 0;
 315   2      		ADDR9_16 = U_Data.ch[3];
 316   2      		ADDR17_24 = U_Data.ch[2];
 317   2      		ADDR25 = U_Data.ch[1];
 318   2      		//ReadOnePage();
 319   2      		ReadOnePage_C();
 320   2      		while(rparameter_buffer[0] == 0x00){	//刚好下一块是坏块
 321   3      			U_Data.i += 0x20;
 322   3      			if(CheckFlash() == 0)				//需要检查一下是否超过了当前的flash
 323   3      				return 0;
 324   3      			ADDR9_16 = U_Data.ch[3];
 325   3      			ADDR17_24 = U_Data.ch[2];
 326   3      			ADDR25 = U_Data.ch[1];
 327   3      			//ReadOnePage();
 328   3      			ReadOnePage_C();
 329   3      		}
 330   2      		U_Data.i += l;
 331   2      				
 332   2      			
 333   2      	}
 334   1      		
 335   1      	
 336   1      	else
 337   1      		U_Data.i += offset;
 338   1      		
 339   1      	if(U_Data.ch[0] != 0)
 340   1      		return 0;
 341   1      	
 342   1      	ADDR25 = U_Data.ch[1];
 343   1      	ADDR9_16 = U_Data.ch[3];
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 17  

 344   1      	ADDR17_24 = U_Data.ch[2];
 345   1      	return 1;
 346   1      }
 347          
 348          //Half Mothed Look First Page Have Been Operated
 349          void FindEnd()			
 350          {
 351   1      	int i;
 352   1      	unsigned char chip =0;
 353   1      	unsigned char addr9_16 = 0;
 354   1      	unsigned char addr17_24 = 0;
 355   1      	unsigned char addr25 = 0;
 356   1          unsigned char address9_16 = 0;
 357   1      	unsigned char address17_24 = 0;
 358   1      	unsigned char address25 = 0;
 359   1      	int count = 0;	
 360   1          int i1=0;
 361   1      	unsigned char i2=0;
 362   1      
 363   1      	UseChip = 0;
 364   1      	U_Data.i = 0;
 365   1      	ADDR9_16 = U_Data.ch[3];
 366   1      	ADDR17_24 = U_Data.ch[2];
 367   1      	ADDR25 = U_Data.ch[1];
 368   1      	
 369   1      	// 判断flash数量。如果为0则返回
 370   1      	
 371   1      	for(i = 0; i < MAXFLASH ;i++)
 372   1      	{
 373   2      		if(FlashChip[i] == 0x40)
 374   2      	 	{
 375   3      			count++;
 376   3      			break;
 377   3      		}
 378   2      	}
 379   1      	if(count == 0) return;
 380   1      	
 381   1      	
 382   1      	chip = -1;
 383   1      	// 查找UseChip
 384   1      	// 只有发现当前flash有数据页的时候才对 chip 赋值
 385   1      	// 在当前flash中发现空白叶或
 386   1      	// 从当前位置直到最后一片flash都是坏块或
 387   1      	// 所有空间都填满的情况下结束循环
 388   1      	for(i = 0; i < MAXFLASH ;i++)			//If First Page of Each Chip Have Been Used
 389   1      	{
 390   2      		if(FlashChip[i] == 0x40)
 391   2      		{			
 392   3      			//FlashReady(i,unsigned char addr9_16,unsigned char addr17_24,unsigned char addr25)
 393   3      			// 读flash第一个page			
 394   3      			UseChip = i;
 395   3      			U_Data.i = 0;
 396   3      			ADDR9_16 = U_Data.ch[3];
 397   3      			ADDR17_24 = U_Data.ch[2];
 398   3      			ADDR25 = U_Data.ch[1];
 399   3      			ReadOnePage_C();
 400   3      			// 判断page是否已写文件.如果未写文件则退出
 401   3      			if(rparameter_buffer[0] == 0xAA)
 402   3      				{
 403   4      					chip = i;
 404   4      					UseChip = chip;
 405   4      				}
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 18  

 406   3      			//如果每个flash的第一块都是好的，就不会进入下面的程序块，这是小概率事件
 407   3      			else if(rparameter_buffer[0] == 0x00)
 408   3      			   {	//这里考虑的是这片flash的第一片是坏块的情况
 409   4      				
 410   4      				   U_Data.i += 0x20;
 411   4      				   ADDR9_16 = U_Data.ch[3];
 412   4      				   ADDR17_24 = U_Data.ch[2];
 413   4      				   ADDR25 = U_Data.ch[1];
 414   4      			       ReadOnePage_C();
 415   4      				   while(rparameter_buffer[0] == 0x00)
 416   4      				  {
 417   5      				   
 418   5      					   U_Data.i += 0x20;
 419   5      					   ADDR9_16 = U_Data.ch[3];
 420   5      					   ADDR17_24 = U_Data.ch[2];
 421   5      				   	   ADDR25 = U_Data.ch[1];
 422   5      					   ReadOnePage_C();
 423   5      					   if(U_Data.ch[1] > 0x01)          //all blocks are bad;
 424   5      					   {
 425   6      	                       i1=i+1;    
 426   6      						   if(i1 >= MAXFLASH)
 427   6      						   {
 428   7      							  if(chip != -1)
 429   7      								  goto findchip;
 430   7      							  else
 431   7      							 	  return;
 432   7      						   } 
 433   6      						   else
 434   6      						   {
 435   7      						      chip =i;
 436   7      						      goto findchip;
 437   7      						   }
 438   6      					   }
 439   5      					
 440   5      				   }
 441   4      				   if(rparameter_buffer[0] == 0xaa)
 442   4      				   {
 443   5      					  chip = i;
 444   5      					  UseChip = chip;
 445   5      				   }
 446   4      				   else		//在这里，在此片flash开始发现了一系列坏块后，终于发现了一个空白页
 447   4      					  break;	//最后一片带数据的flash已找到，结束循环，即确定了UseChip
 448   4      			   }		
 449   3      			   else {
 450   4      				// flash什么也没写，则返回
 451   4      				   if(chip == -1) {
 452   5      					   UseChip = i;
 453   5      					   return;
 454   5      				   	   }
 455   4      				   break;
 456   4      			   }
 457   3      		}//0X40
 458   2      	}	
 459   1      findchip:
 460   1       // T1=1;
 461   1        UseChip=chip; //get current used chip;
 462   1        U_Data.i=0;
 463   1      
 464   1        ADDR9_16 =U_Data.ch[3];
 465   1        ADDR17_24=U_Data.ch[2];
 466   1        ADDR25   =U_Data.ch[2];
 467   1        ReadOnePage_C();
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 19  

 468   1        
 469   1        for(i=0; i<4096; i++)
 470   1        { 
 471   2           if(i==4095)
 472   2      	 {
 473   3             sprintf(tmpBuf, "a UseChip:%02X\r\nADDR9_16:%02X\r\nADDR17_24:%02X\r\nADDR25:%02X\r\n",
 474   3      			(int)UseChip, (int)ADDR9_16, (int)ADDR17_24, (int)ADDR25);
 475   3      		putbuf(tmpBuf);	
 476   3      
 477   3      	  // if( (ADDR9_16==0xe0)&&(ADDR17_24==0xff)&&(ADDR25==0x01) )
 478   3      	     //T1=1;
 479   3      	 }
 480   2           if(rparameter_buffer[0] == 0xaa)
 481   2           {
 482   3      	    addr9_16 =ADDR9_16;
 483   3              addr17_24=ADDR17_24;
 484   3              addr25   =ADDR25;
 485   3       
 486   3      	    U_Data.i+=0x20;
 487   3              ADDR9_16=U_Data.ch[3];
 488   3              if(ADDR9_16==0x00)
 489   3      		{
 490   4      		   ADDR17_24++;
 491   4      		   if(ADDR17_24==0x00)
 492   4      		     {
 493   5      			   ADDR25++;
 494   5                     if(ADDR25 > 0x01)
 495   5      			     { 
 496   6      				   return;
 497   6      				 }
 498   5      			 }
 499   4      		} 
 500   3              ReadOnePage_C(); 
 501   3           }   
 502   2           else if(rparameter_buffer[0] == 0x00)
 503   2           {
 504   3              addr9_16 =ADDR9_16;
 505   3              addr17_24=ADDR17_24;
 506   3              addr25   =ADDR25;
 507   3      
 508   3      	    U_Data.i+=0x20;
 509   3              ADDR9_16=U_Data.ch[3];
 510   3              if(ADDR9_16==0x00)
 511   3      		 {
 512   4      		   ADDR17_24++;
 513   4      		   if(ADDR17_24==0x00)
 514   4      		     {
 515   5      			   ADDR25++;
 516   5                     if(ADDR25 > 0x01)
 517   5      			     { 
 518   6      				   addr9_16 =0;
 519   6      				   addr17_24=0;
 520   6      				   addr25   =0;
 521   6      				   goto findaddress;
 522   6      				 }
 523   5      			 }
 524   4      		 }
 525   3               
 526   3              ReadOnePage_C();  
 527   3           } 
 528   2      
 529   2           else//no data is written to this block (0xff);
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 20  

 530   2           {
 531   3              break;
 532   3           }
 533   2        }
 534   1      findaddress:
 535   1        ADDR9_16 =addr9_16;          //get block first address; 
 536   1        ADDR17_24=addr17_24;
 537   1        ADDR25   =addr25;
 538   1        sprintf(tmpBuf, " b UseChip:%02X\r\nADDR9_16:%02X\r\nADDR17_24:%02X\r\nADDR25:%02X\r\n",
 539   1      			(int)UseChip, (int)ADDR9_16, (int)ADDR17_24, (int)ADDR25);
 540   1        putbuf(tmpBuf);	
 541   1      
 542   1      	ReadOnePage();
 543   1      
 544   1      	NowFileName = rparameter_buffer[1];		
 545   1      	NowFileName ++;
 546   1      
 547   1      	// 确定现存文件个数
 548   1      	FileNumber = NowFileName;
 549   1      	// 保存最后一个文件的起始位置和大小
 550   1      	FileStart[FileNumber-1][0] = rparameter_buffer[2];		//UseChip
 551   1      	FileStart[FileNumber-1][1] = rparameter_buffer[3];		//ADDR9_16
 552   1      	FileStart[FileNumber-1][2] = rparameter_buffer[4];		//ADDR17_24
 553   1      	FileStart[FileNumber-1][3] = rparameter_buffer[5];		//ADDR25
 554   1          address9_16 =ADDR9_16;
 555   1          address17_24=ADDR17_24;
 556   1          address25   =ADDR25;
 557   1      
 558   1          U_Data.ch[3] = ADDR9_16;
 559   1          U_Data.ch[2] = ADDR17_24;
 560   1          U_Data.ch[1] = ADDR25;
 561   1      
 562   1      
 563   1      	for(i2=0; i2<32; i2++)
 564   1      	{  
 565   2             ADDR9_16 =U_Data.ch[3];
 566   2         	   ADDR17_24=U_Data.ch[2];
 567   2      	   ADDR25   =U_Data.ch[1];
 568   2             ReadOnePage_C();
 569   2             if(rparameter_buffer[0]==0xaa)
 570   2      	   {
 571   3                 addr9_16 =ADDR9_16;
 572   3                 addr17_24=ADDR17_24;
 573   3                 addr25   =ADDR25;
 574   3      	   
 575   3                 U_Data.i++;
 576   3      	   }
 577   2      	   else if(rparameter_buffer[0]==0x00)
 578   2      	   {
 579   3                 U_Data.i++;
 580   3      	   }
 581   2      	   else
 582   2      	   {   
 583   3      	       break;
 584   3      	   }
 585   2      	}
 586   1          ADDR9_16 =addr9_16;          //get block first address; 
 587   1          ADDR17_24=addr17_24;
 588   1          ADDR25   =addr25;
 589   1      	ReadOnePage_C();
 590   1      	
 591   1      	FileSize[FileNumber-1][0] = rparameter_buffer[6];
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 21  

 592   1      	FileSize[FileNumber-1][1] = rparameter_buffer[7];
 593   1      	FileSize[FileNumber-1][2] = rparameter_buffer[8];
 594   1      	FileSize[FileNumber-1][3] = rparameter_buffer[9];
 595   1      	// 查找下一个可以写入的页
 596   1      //go_out:
 597   1          ADDR9_16 =address9_16;          //get block first address; 
 598   1          ADDR17_24=address17_24;
 599   1          ADDR25   =address25;
 600   1          FindNextBlock(1);
 601   1      	//FindPage(1);
 602   1          //T1 = 1;	
 603   1          sprintf(tmpBuf, "0:%02X\r\n1:%02X\r\n2:%02X\r\n3:%02X\r\n",
 604   1      			(int)FileSize[FileNumber-1][0], 
 605   1                  (int)FileSize[FileNumber-1][1], 
 606   1                  (int)FileSize[FileNumber-1][2], 
 607   1                  (int)FileSize[FileNumber-1][3]);
 608   1          putbuf(tmpBuf);	
 609   1      
 610   1      
 611   1      }
 612          
 613          void FindFiles()
 614          {
 615   1      	int i=0;
 616   1      	unsigned char j=0;
 617   1          unsigned char space9_16  = 0;
 618   1      	unsigned char space17_24 = 0;
 619   1      	unsigned char space25    = 0;
 620   1      	FileSumCheck = 0;
 621   1      	//UseChip = 0;
 622   1      	//ADDR9_16 = 0;
 623   1      	//ADDR17_24 = 0;
 624   1      	//ADDR25 = 0;
 625   1      	FindEnd();
 626   1      	//change at 03.8.1
 627   1      
 628   1      	for(i=FileNumber-2; i>=0; i--) 
 629   1      	{
 630   2      	  	 UseChip = FileStart[i+1][0];
 631   2      	     ADDR9_16 = FileStart[i+1][1];
 632   2      	     ADDR17_24 = FileStart[i+1][2];
 633   2      	     ADDR25 = FileStart[i+1][3];
 634   2      		 //FindPrvPage();
 635   2      		 FindPrvBlock();
 636   2               ReadOnePage();
 637   2      		 FileStart[i][0] = rparameter_buffer[2];
 638   2      		 FileSumCheck += rparameter_buffer[2];
 639   2      		 FileStart[i][1] = rparameter_buffer[3];
 640   2      		 FileSumCheck += rparameter_buffer[3];
 641   2      		 FileStart[i][2] = rparameter_buffer[4];
 642   2      		 FileSumCheck += rparameter_buffer[4];
 643   2      		 FileStart[i][3] = rparameter_buffer[5];
 644   2      		 FileSumCheck += rparameter_buffer[5];
 645   2      
 646   2               
 647   2               U_Data.ch[3] = ADDR9_16;
 648   2               U_Data.ch[2] = ADDR17_24;
 649   2               U_Data.ch[1] = ADDR25;
 650   2      
 651   2      
 652   2      	     for(j=0; j<32; j++)
 653   2      	     {  
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 22  

 654   3                   ADDR9_16 =U_Data.ch[3];
 655   3         	         ADDR17_24=U_Data.ch[2];
 656   3      	         ADDR25   =U_Data.ch[1];
 657   3                   ReadOnePage_C();
 658   3                   if(rparameter_buffer[0]==0xaa)
 659   3      	         {
 660   4                      space9_16 =ADDR9_16;
 661   4                      space17_24=ADDR17_24;
 662   4                      space25   =ADDR25;
 663   4      	   
 664   4                      U_Data.i++;
 665   4      	         }
 666   3      	         else if(rparameter_buffer[0]==0x00)
 667   3      	         {
 668   4                      U_Data.i++;
 669   4      	         }
 670   3      	         else
 671   3      	         {   
 672   4      	             break;
 673   4      	         }
 674   3               }
 675   2               ADDR9_16 =space9_16;          //get block first address; 
 676   2               ADDR17_24=space17_24;
 677   2               ADDR25   =space25;
 678   2      	     ReadOnePage_C();
 679   2      
 680   2               FileSize[i][0]  = rparameter_buffer[6];
 681   2               FileSumCheck += rparameter_buffer[6];
 682   2         	     FileSize[i][1]  = rparameter_buffer[7];
 683   2               FileSumCheck += rparameter_buffer[7];
 684   2      	     FileSize[i][2]  = rparameter_buffer[8];
 685   2      	     FileSumCheck += rparameter_buffer[8];
 686   2      	     FileSize[i][3]  = rparameter_buffer[9];
 687   2      	     FileSumCheck += rparameter_buffer[9];
 688   2      		
 689   2      	}
 690   1      }
 691          
 692          //Initial Flash  
 693          void InitFlash()		//Reset All Buffer And Other Parameter
 694          {
 695   1      	int i;
 696   1      	for(i=0; i<512; i++) {
 697   2      		wdata_buffer[i] = 0;
 698   2      		rdata_buffer[i] = 0;
 699   2      	}
 700   1      
 701   1      	for(i=0; i<16; i++) {
 702   2      		wparameter_buffer[i] = 0;
 703   2      		rparameter_buffer[i] = 0;
 704   2      	}
 705   1      	
 706   1      	for(i=0; i<MAXFLASH; i++)
 707   1      		FlashChip[i] = 0;
 708   1          for(i=0;i<6;i++)   //add by rzy
 709   1      	{
 710   2      	    bad[i] = 0;
 711   2      	}
 712   1      
 713   1      	FileNumber = 0;
 714   1      	NowFileName = 0;
 715   1      	
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 23  

 716   1      	ADDR9_16 = 0;
 717   1      	ADDR17_24 = 0;
 718   1      	ADDR25 = 0;
 719   1      	UseChip = 0;
 720   1      	wChecknum = 0;
 721   1      	rChecknum = 0;
 722   1      
 723   1      	ErrorFlash = 0;
 724   1      	ErrorBlock = 0;
 725   1          FileSumCheck = 0;
 726   1          	ckb = 0;
 727   1      
 728   1      }
 729          
 730          //If Flash on board
 731          void FindFlash()
 732          {	
 733   1      	int i=0,m;
 734   1      	P1 = 0xFF;
 735   1      	P23 = 0; //
 736   1      	P22 = 0;
 737   1      	P20 = 0;
 738   1          m   = 1;
 739   1      	for(i=0;i<MAXFLASH;i++)
 740   1      	{
 741   2             
 742   2              P1  = ~m;
 743   2      		P23 = 1; 	// p 2.3  = command latch enable
 744   2      		P0 =0x71;	// p0   = 0x71  
 745   2      		P21 = 0 ;   // P2.1 = WR enable
 746   2      		P21 = 1 ;   //
 747   2      		P0 = 0xff;
 748   2      		P23 = 0;
 749   2      		P25 = 0;	// P2.5 = RD enable
 750   2      		FlashChip[i] = P0;			//40 Or @ Correct
 751   2      		P25 = 1;    // P2.5 = RD disenable
 752   2      		            // change at 03.8.1 
 753   2      		P23 = 1; 	// p 2.3  = command latch enable
 754   2      		P0 =0x90;	// p0   = 0x90  
 755   2      		P21 = 0 ;   // P2.1 = WR enable
 756   2      		P21 = 1 ;   //
 757   2      		P23 = 0;
 758   2      		P22 = 1;    //ALE
 759   2      		P0  = 0;
 760   2      		P21 = 0;    // P2.1 = WR enable
 761   2      		P21 = 1;    //
 762   2      		P22 = 0;
 763   2      		P0  = 0xff;
 764   2      		P25 = 0;
 765   2      		ChipMark = P0;
 766   2      		P25 = 1;
 767   2      		m = m<<1; 
 768   2      		P1  = 0xff;
 769   2      		if(ChipMark != 0xEC)
 770   2      		  {
 771   3      		    FlashChip[i] = 0;
 772   3      			continue;
 773   3      		  }
 774   2      	}
 775   1      }
 776          
 777          //erase all chip 
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 24  

 778          void  EraseFlash()
 779          {	
 780   1      	unsigned char i;
 781   1      	for(i=0;i<MAXFLASH;i++) 
 782   1      	  {
 783   2      		if(FlashChip[i] == 0x40)
 784   2      			EraseOneFlash(i);
 785   2      		
 786   2      		
 787   2      	  }
 788   1      	// 重置文件数
 789   1      	FileNumber = 0;
 790   1      }
 791          
 792          void WriteOnePage()
 793          {	
 794   1      	unsigned char Statusw;
 795   1      	int i,j,m = 1;	
 796   1      	
 797   1      	if(UseChip >= MAXFLASH)
 798   1      		return;
 799   1      	/*
 800   1      	for(j = 1; j<=UseChip; j++)
 801   1      	{
 802   1      		m = 2*m;
 803   1      	}
 804   1      	*/
 805   1      	m = m << UseChip;
 806   1      	P25 = 1; //RE
 807   1      	P22 = 0; //ALE
 808   1      	P23 = 0; //CLE
 809   1      	P20 = 1; //WP
 810   1      	P21 = 1; //WE	
 811   1      	
 812   1      	//P10=0;//
 813   1      	//P1 = 0xFF-m;//CE
 814   1      	P1 = ~m;
 815   1      	//Address input
 816   1      	do 
 817   1      	{	
 818   2      	}while(P26 != 1); //wait P26 =1 ,command erase respond end
 819   1      	
 820   1      	P23 = 1;//CLE	
 821   1      	P0 = 0x00; //write command
 822   1      	P21 = 0;   //WE
 823   1      	P21 = 1;   //WE
 824   1      	P23 = 0;   //CLE
 825   1      	//
 826   1      	P23 = 1;//CLE	
 827   1      	P0 = 0x80; //write command
 828   1      	P21 = 0;   //WE
 829   1      	P21 = 1;   //WE
 830   1      	P23 = 0;   //CLE
 831   1      	//
 832   1      	P22 = 1;   //ALE
 833   1      	P0 = 0x00; //Address A0_A7
 834   1      	P21 = 0;   //WE
 835   1      	P21 = 1;   //WE
 836   1      	P0 = ADDR9_16; //Address A9_A16
 837   1      	P21 = 0;   //WE
 838   1      	P21 = 1;   //WE
 839   1      	P0 = ADDR17_24; //Address A17_A24
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 25  

 840   1      	P21 = 0;   //WE
 841   1      	P21 = 1;   //WE
 842   1      	P0 = ADDR25; //Address A25
 843   1      	P21 = 0;   //WE
 844   1      	P21 = 1;   //WE
 845   1      	P22 = 0;  //ALE
 846   1      	//write buffer data input flash 
 847   1      	do 
 848   1      	{		
 849   2      	}while(P26 != 1); //wait P26 =1 ,command erase respond end
 850   1      	//write char to flash
 851   1      	for(i=0;i<512;i++)
 852   1      	{
 853   2      		P0 = wdata_buffer[i];//data input flash				
 854   2      		P21=0;
 855   2      		P21=1;
 856   2      	}
 857   1      	for(j=0;j<16;j++)
 858   1      	{	
 859   2      		P0 = wparameter_buffer[j];//parameter input flash
 860   2      		P21 = 0;//WE
 861   2      		P21 = 1;//WE
 862   2      	}
 863   1      	P23 = 1;//CLE H
 864   1      	P0  = 0x10;		//command end
 865   1      	P21 = 0;//WE
 866   1      	P21 = 1;//WE
 867   1      	P23 = 0;//CLE
 868   1      	do 
 869   1      	{		
 870   2      	}while(P26 != 1); //wait P26 =1 ,command erase respond end
 871   1      	
 872   1      	P23 = 1;//CLE
 873   1      	P0  = 0x70; //command
 874   1      	
 875   1      	P21 = 0;//WE
 876   1      	P21 = 1;//WE
 877   1      	P23 = 0;//CLE
 878   1      	
 879   1      	P0  =0xFF;
 880   1      	P25=0;//RE
 881   1      	Statusw = P0;
 882   1      	P25 = 1;//RE
 883   1      	P1=0xFF;
 884   1      	P20=0;
 885   1      	//return Statusw;
 886   1      }
 887          
 888          void ReadOnePage()
 889          {
 890   1      	int i,j,m = 1;//delay;
 891   1      
 892   1      	m = m << UseChip;
 893   1      
 894   1      	P25 = 1;//RE
 895   1      	P22 = 0;//ALE
 896   1      	P23 = 0;//CLE
 897   1      	P20 = 0;//WP
 898   1      	P21 = 1;//WE
 899   1      	
 900   1      	//P10 = 0;
 901   1      	//P1 = 0xFF-m;//CE
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 26  

 902   1      	P1 = ~m;
 903   1      	
 904   1      	//Address input
 905   1      	P23 = 1;		//CLE
 906   1      	P0   = 0x00;	//read command
 907   1      	P21 = 0;		//WE
 908   1      	P21 = 1;		//WE
 909   1      	P23 = 0;		//CLE
 910   1      	P22 = 1;		//ALE
 911   1      	P0   = 0x00; 	//Address A0_A7
 912   1      	P21  = 0;   		//WE
 913   1      	P21  = 1;   		//WE
 914   1      	P0   = ADDR9_16; 	//Address A9_A16
 915   1      	P21  = 0;   		//WE
 916   1      	P21  = 1;   		//WE
 917   1      	P0   = ADDR17_24; //Address A17_A24
 918   1      	P21  = 0;   		//WE
 919   1      	P21  = 1;   		//WE
 920   1      	P0   = ADDR25; 	//Address A25
 921   1      	P21  = 0;   		//WE
 922   1      	P21  = 1;   		//WE
 923   1      	P22 = 0;		//CLE
 924   1          do
 925   1      	{		
 926   2      	}while(P26 != 1);////wait P26 =1 
 927   1          P0 =0xFF;
 928   1      	
 929   1      	for(i=0;i<512;i++)
 930   1      	{	
 931   2      		P25 = 0;//RE
 932   2      		rdata_buffer[i] = P0;//data into buffer
 933   2      		P25 = 1;
 934   2      		//for(j=0; j<1 ; j++);
 935   2      
 936   2      	}				
 937   1      	for(j=0;j<16;j++)
 938   1      	{
 939   2      		P25 = 0;
 940   2      		rparameter_buffer[j] = P0;//parameter into buffer
 941   2      		P25 = 1;
 942   2      	}
 943   1      
 944   1      	do
 945   1      	{		
 946   2      	}while(P26 != 1);////add at 03.08.04 
 947   1      	P1 =0xFF;
 948   1      }
 949          
 950          
 951          void ReadOnePage_C()
 952          {
 953   1      	int j,m = 1;//delay;
 954   1      /*	
 955   1      	for(j = 1; j<=UseChip; j++)
 956   1      	{
 957   1      		m = 2*m;
 958   1      	}
 959   1      */
 960   1      	m = m << UseChip;
 961   1      
 962   1      	P25 = 1;//RE
 963   1      	P22 = 0;//ALE
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 27  

 964   1      	P23 = 0;//CLE
 965   1      	P20 = 0;//WP
 966   1      	P21 = 1;//WE
 967   1      	
 968   1      	//P10 = 0;
 969   1      	//P1 = 0xFF-m;//CE
 970   1      	P1 = ~m;
 971   1      	
 972   1      	//Address input
 973   1      	P23 = 1;		//CLE
 974   1      	P0   = 0x50;	//read command
 975   1      	P21 = 0;		//WE
 976   1      	P21 = 1;		//WE
 977   1      	P23 = 0;		//CLE
 978   1      	P22 = 1;		//ALE
 979   1      	P0   = 0x00; 	//Address A0_A7
 980   1      	P21  = 0;   		//WE
 981   1      	P21  = 1;   		//WE
 982   1      	P0   = ADDR9_16; 	//Address A9_A16
 983   1      	P21  = 0;   		//WE
 984   1      	P21  = 1;   		//WE
 985   1      	P0   = ADDR17_24; //Address A17_A24
 986   1      	P21  = 0;   		//WE
 987   1      	P21  = 1;   		//WE
 988   1      	P0   = ADDR25; 	//Address A25
 989   1      	P21  = 0;   		//WE
 990   1      	P21  = 1;   		//WE
 991   1      	P22 = 0;		//ALE
 992   1          do
 993   1      	{		
 994   2      	}while(P26 != 1);////wait P26 =1 
 995   1          P0 =0xFF;
 996   1      	
 997   1      	for(j=0;j<16;j++)
 998   1      	{
 999   2      		P25 = 0;
1000   2      		rparameter_buffer[j] = P0;//parameter into buffer
1001   2      		P25 = 1;
1002   2      	}
1003   1      
1004   1      	do
1005   1      	{		
1006   2      	}while(P26 != 1);////add at 03.08.04 
1007   1      	P1 =0xFF;
1008   1      }
1009          
1010          
1011          
1012          //erase one chip 
1013          void EraseOneFlash(unsigned char i)			//Erase one block(16K Byte)
1014          {
1015   1      	unsigned char Statuse;	//Status return
1016   1      	unsigned char addr9_16  = 0x00;
1017   1      	unsigned char addr17_24 = 0x00;
1018   1      	unsigned char addr25    = 0x00;//2*i;//question???
1019   1      	unsigned int  pi,k;
1020   1      	unsigned char m = 1 ;
1021   1      	
1022   1      	for(k = 0; k < 512; k++)
1023   1      		wdata_buffer[k] = 0x00;
1024   1      	for(k = 0; k < 16; k++)
1025   1      		wparameter_buffer[k] = 0x00;
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 28  

1026   1      	
1027   1      	
1028   1      		UseChip = 0;
1029   1              ADDR25  = 1;
1030   1      		ADDR9_16 = 0xE0;
1031   1      	    ADDR17_24 = 0xFF;
1032   1      		ReadOnePage();
1033   1      
1034   1      	m = m << i;
1035   1      	P25 = 1; //RD
1036   1      	P22 = 0; //ALE
1037   1      	P23 = 0; //CLE
1038   1      	P20 = 1; //WR protect
1039   1      	P21 = 1; //WR
1040   1      	
1041   1      	
1042   1      loop:
1043   1      
1044   1      	P1  =~m;
1045   1      	P23 = 1; //CLE command latch
1046   1      	P0 = 0x60; // send a command to flash, ready to erase
1047   1      	P21 = 0; //WR
1048   1      	P21 = 1;
1049   1      	P23 = 0;
1050   1      	P22 = 1;
1051   1      	P0 = addr9_16;
1052   1      	P21 = 0; //WR
1053   1      	P21 = 1;
1054   1      	
1055   1      	P0 = addr17_24;
1056   1      	P21 = 0; //WR
1057   1      	P21 = 1;
1058   1      	
1059   1      	P0 = addr25;
1060   1      	P21 = 0; //WR
1061   1      	P21 = 1;
1062   1      	
1063   1      	P22 = 0; //ALE
1064   1      	P23 = 1; //CLE
1065   1      	
1066   1      	P0 = 0xd0;//Erase confirm commmand
1067   1      	
1068   1      	P21 = 0; //WE
1069   1      	P21 = 1; //WE
1070   1      	P23 = 0;  //CLE	
1071   1      	do
1072   1          {
1073   2      	}while(P26!=1); //wait P26 =1 ,command erase respond end
1074   1      	P23 = 1;
1075   1      	P0 =0x70;
1076   1      	P21 = 0; //WE
1077   1      	P21 = 1; //WE
1078   1      	P23 = 0;
1079   1      	P25 = 0; //RD
1080   1      	P0 =0xFF;
1081   1      	Statuse = P0;
1082   1      	P25 = 1; //RD
1083   1      
1084   1      	//USBSendData("begin!\r\n", 8);
1085   1      	Statuse &=0x0F;
1086   1      	  
1087   1      	if(Statuse !=0) {
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 29  

1088   2      		ErrorFlash++;
1089   2      		//putbuf("find a bad block!\r\n");
1090   2      		//坏块补丁修改说明：
1091   2      		//1、在刷时，一旦发现坏块，即使这块的数据都是0，也要再写一次0，以确保万无一失
1092   2      		//2、
1093   2      		ADDR25 = addr25;
1094   2      		ADDR17_24 = addr17_24;
1095   2      		ADDR9_16  = addr9_16;
1096   2      		UseChip = i;
1097   2      		WriteOnePage();
1098   2      		
1099   2      		P20 = 1;
1100   2      		P0 = 0xff;
1101   2      		if(ckb == 1)
1102   2              {
1103   3      		  if( addr25==1 && addr17_24==0xff && addr9_16==0xe0 )
1104   3      		  {bad[0]='N';
1105   4      		  }
1106   3      		  else
1107   3      		  {bad[0]='M';
1108   4      		  }
1109   3      		  bad[1]=i;
1110   3      		  bad[2]=num;     //all bad block number;
1111   3      		  bad[3]=ADDR25;
1112   3      		  bad[4]=ADDR17_24;
1113   3      		  bad[5]=ADDR9_16;
1114   3      	      num++;
1115   3      
1116   3                USBSendData(bad, 6);
1117   3      		  //sprintf(tmpBuf,"%Badblock exist:01X-%01X-%02X-%02X\r\n",
1118   3      		  //(int)i,(int)addr25,(int)addr17_24,(int)addr9_16);
1119   3      	  	  //USBSendData(tmpBuf,30);
1120   3      	  	 // putbuf(tmpBuf);
1121   3      
1122   3      
1123   3      	  	}
1124   2      	  	
1125   2      	}
1126   1      	else
1127   1      	{
1128   2      	    if( addr25==1 && addr17_24==0xff && addr9_16==0xe0)
1129   2              {
1130   3                bad[0]='R';
1131   3      		  bad[1]=0;
1132   3      		  bad[2]=0;     //all bad block number;
1133   3      		  bad[3]=addr25;
1134   3      		  bad[4]=addr17_24;
1135   3      		  bad[5]=addr9_16;
1136   3      	      USBSendData(bad, 6); 
1137   3                USBSendData("This is end!\r\n", 14); 
1138   3      		}
1139   2      	}
1140   1      	
1141   1      	P1 = 0xFF;
1142   1      	
1143   1      	addr9_16+=0x20; //Address add
1144   1      
1145   1      	if(addr9_16 == 0x00)
1146   1      	{		
1147   2      		addr17_24++; //Address add
1148   2      		if(addr17_24 == 0x00)
1149   2      		{
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 30  

1150   3      			addr25++; //Address add					
1151   3      		}
1152   2      	}
1153   1      
1154   1      	if(addr25>1)
1155   1      	{
1156   2      		
1157   2      			for(pi=0; pi<512; pi++)
1158   2      			   wdata_buffer[pi] = rdata_buffer[pi];
1159   2      			for(pi=0; pi<16; pi++)
1160   2      			   wparameter_buffer[pi] = rparameter_buffer[pi];
1161   2      			UseChip = 0;
1162   2              	ADDR25  = 1;
1163   2      			ADDR9_16 = 0xE0;
1164   2      	    	ADDR17_24 = 0xFF;
1165   2      			WriteOnePage();
1166   2      	
1167   2      		return;//(ADDR25!=(0x2*i))&&(ADDR25!=(0x2*i+1)) questions
1168   2      	}
1169   1      	goto loop; 
1170   1      }
1171          
1172          
1173          void ReadoneChip_leavefactory_invalidblock(unsigned char Chipi)
1174          {
1175   1      	int j,m = 1;//delay;
1176   1      
1177   1          unsigned char addr9_16  = 0x00;
1178   1      	unsigned char addr17_24 = 0x00;
1179   1      	unsigned char addr25    = 0x00;
1180   1      
1181   1      	m = m << Chipi;
1182   1      
1183   1      	P25 = 1;//RE
1184   1      	P22 = 0;//ALE
1185   1      	P23 = 0;//CLE
1186   1      	P20 = 0;//WP
1187   1      	P21 = 1;//WE
1188   1      	
1189   1      block:
1190   1      	P1 = ~m;
1191   1      	
1192   1      	//Address input
1193   1      	P23 = 1;		//CLE
1194   1      	P0   = 0x50;	//read command
1195   1      	P21 = 0;		//WE
1196   1      	P21 = 1;		//WE
1197   1      	P23 = 0;		//CLE
1198   1      	P22 = 1;		//ALE
1199   1      	P0   = 0x00; 	//Address A0_A7
1200   1      	P21  = 0;   		//WE
1201   1      	P21  = 1;   		//WE
1202   1      	P0   = addr9_16; 	//Address A9_A16
1203   1      	P21  = 0;   		//WE
1204   1      	P21  = 1;   		//WE
1205   1      	P0   = addr17_24; //Address A17_A24
1206   1      	P21  = 0;   		//WE
1207   1      	P21  = 1;   		//WE
1208   1      	P0   = addr25; 	//Address A25
1209   1      	P21  = 0;   		//WE
1210   1      	P21  = 1;   		//WE
1211   1      	P22 = 0;		//CLE
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 31  

1212   1          do
1213   1      	{		
1214   2      	}while(P26 != 1);////wait P26 =1 
1215   1          P0 =0xFF;
1216   1      	
1217   1      	for(j=0;j<16;j++)
1218   1      	{
1219   2      		P25 = 0;
1220   2      		rparameter_buffer[j] = P0;//parameter into buffer
1221   2      		P25 = 1;
1222   2      	}
1223   1          do
1224   1      	{		
1225   2      	}while(P26 != 1);
1226   1      
1227   1      	if(rparameter_buffer[5] != 0xff)
1228   1            {
1229   2              ErrorBlock++;
1230   2              sprintf(tmpBuf,"Invalid Block--Chip%01X\r\nADDR25 >>%02X\r\nADDR17_24 >>%02X\r\nADDR9_16 >>%02X\r\
             -n",(int)Chipi,(int)addr25,(int)addr17_24,(int)addr9_16);
1231   2              putbuf(tmpBuf);
1232   2            } 
1233   1          for(j=0;j<16;j++)
1234   1      	{
1235   2      		P25 = 0;
1236   2      		rparameter_buffer[j] = P0;//parameter into buffer
1237   2      		P25 = 1;
1238   2      	}
1239   1      	if(rparameter_buffer[5] != 0xff)
1240   1      	  {
1241   2              ErrorBlock++;
1242   2      		sprintf(tmpBuf,"Invalid Block--Chip%01X\r\nADDR25 >>%02X\r\nADDR17_24 >>%02X\r\nADDR9_16 >>%02X\r\n",(in
             -t)Chipi,(int)addr25,(int)addr17_24,(int)addr9_16);
1243   2              putbuf(tmpBuf);
1244   2      	  }
1245   1      
1246   1      	do
1247   1      	{		
1248   2      	}while(P26 != 1);////add at 03.08.04 
1249   1      	P1 =0xFF;
1250   1      
1251   1          addr9_16+=0x20; //Address add
1252   1      	if(addr9_16 == 0x00)
1253   1      	{		
1254   2      		addr17_24++; //Address add
1255   2      		if(addr17_24 == 0x00)
1256   2      		{
1257   3      			addr25++; //Address add					
1258   3      		}
1259   2      	}
1260   1      	if(addr25>1)
1261   1      		return;//(ADDR25!=(0x2*i))&&(ADDR25!=(0x2*i+1)) questions
1262   1      	goto block;   
1263   1      }
1264          
1265          // 可以在不擦除flash的情况下，检测坏块，修改日期：2005年3月21日
1266          /*
1267          void ReadoneChip_leavefactory_invalidblock(unsigned char Chipi)
1268          {
1269          	int j,m = 1;//delay;
1270          
1271              unsigned char addr9_16  = 0x00;
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 32  

1272          	unsigned char addr17_24 = 0x00;
1273          	unsigned char addr25    = 0x00;
1274          
1275          	m = m << Chipi;
1276          
1277          	P25 = 1;//RE
1278          	P22 = 0;//ALE
1279          	P23 = 0;//CLE
1280          	P20 = 0;//WP
1281          	P21 = 1;//WE
1282          	
1283          block:
1284          	P1 = ~m;
1285          	
1286          	//Address input
1287          	P23 = 1;		//CLE
1288          	P0   = 0x50;	//read command
1289          	P21 = 0;		//WE
1290          	P21 = 1;		//WE
1291          	P23 = 0;		//CLE
1292          	P22 = 1;		//ALE
1293          	P0   = 0x00; 	//Address A0_A7
1294          	P21  = 0;   		//WE
1295          	P21  = 1;   		//WE
1296          	P0   = addr9_16; 	//Address A9_A16
1297          	P21  = 0;   		//WE
1298          	P21  = 1;   		//WE
1299          	P0   = addr17_24; //Address A17_A24
1300          	P21  = 0;   		//WE
1301          	P21  = 1;   		//WE
1302          	P0   = addr25; 	//Address A25
1303          	P21  = 0;   		//WE
1304          	P21  = 1;   		//WE
1305          	P22 = 0;		//CLE
1306              do
1307          	{		
1308          	}while(P26 != 1);////wait P26 =1 
1309              P0 =0xFF;
1310          	
1311          	for(j=0;j<16;j++)
1312          	{
1313          		P25 = 0;
1314          		rparameter_buffer[j] = P0;//parameter into buffer
1315          		P25 = 1;
1316          	}
1317              do
1318          	{		
1319          	}while(P26 != 1);
1320          	P1 = 0xff;
1321          
1322          	for(j = 0; j < 16; j++){
1323          		if(rparameter_buffer[j] != 0x00)
1324          			break;
1325          		else 
1326          			continue;
1327          	}
1328          	
1329          	if(j == 16){
1330          			ErrorBlock++;
1331          			sprintf(tmpBuf,"Invalid Block--Chip%01X\r\nADDR25 >>%02X\r\nADDR17_24 >>%02X\r\nADDR9_16 >>%02X\r\n",(i
             -nt)Chipi,(int)addr25,(int)addr17_24,(int)addr9_16);
1332          			putbuf(tmpBuf);
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 33  

1333          			USBSendData(tmpbuf,30);
1334          	}
1335          	
1336          
1337              addr9_16+=0x20; //Address add
1338          	if(addr9_16 == 0x00)
1339          	{		
1340          		addr17_24++; //Address add
1341          		if(addr17_24 == 0x00)
1342          		{
1343          			addr25++; //Address add					
1344          		}
1345          	}
1346          	if(addr25>1)
1347          		return;//(ADDR25!=(0x2*i))&&(ADDR25!=(0x2*i+1)) questions
1348          	goto block;   
1349          }
1350          */
1351          
1352          
1353          
1354          void  ReadallChip_leavefactory_invalidblock()
1355          {	
1356   1      	unsigned char i;
1357   1      	for(i=0;i<MAXFLASH;i++) 
1358   1      	  {
1359   2      		if(FlashChip[i] == 0x40)
1360   2      		  ReadoneChip_leavefactory_invalidblock(i);
1361   2      	  }
1362   1      
1363   1      }
1364          
1365          void  TestoneChip_Status_information(unsigned char Chipi)
1366          {
1367   1      	
1368   1      	Erasel = 1;
1369   1      	ckb = 1;
1370   1      	EraseOneFlash(Chipi);
1371   1      	ckb = 0;
1372   1      	Erasel = 0;
1373   1      	
1374   1      }
1375          
1376          
1377          
1378          void TestallChip_Status_information()
1379          {
1380   1          unsigned char i;
1381   1          
1382   1      	for(i=0;i<MAXFLASH;i++) 
1383   1      	  {
1384   2      		if(FlashChip[i] == 0x40)
1385   2      		  TestoneChip_Status_information(i);
1386   2      	  }
1387   1          FileNumber = 0;
1388   1      }
1389          
1390          /*
1391          void EraseOneBlock()			//Erase one block(16K Byte)
1392          {
1393          	unsigned char Statuse;	//Status return
1394          	//unsigned char addr9_16  = 0x00;
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 34  

1395              unsigned char addr9_16  = 0xE0;
1396          	unsigned char addr17_24 = 0xFF;
1397          	unsigned char addr25    = 0x01;//2*i;//question???
1398          
1399          	unsigned char m = 1,ii=0 ;
1400          
1401          	m = m << ii;
1402          	P25 = 1; //RD
1403          	P22 = 0; //ALE
1404          	P23 = 0; //CLE
1405          	P20 = 1; //WR protect
1406          	P21 = 1; //WR
1407          
1408          	P1  =~m;
1409          	P23 = 1; //CLE command latch
1410          	P0 = 0x60; // send a command to flash, ready to erase
1411          	P21 = 0; //WR
1412          	P21 = 1;
1413          	P23 = 0;
1414          	P22 = 1;
1415          	P0 = addr9_16;
1416          	P21 = 0; //WR
1417          	P21 = 1;
1418          	
1419          	P0 = addr17_24;
1420          	P21 = 0; //WR
1421          	P21 = 1;
1422          	
1423          	P0 = addr25;
1424          	P21 = 0; //WR
1425          	P21 = 1;
1426          	
1427          	P22 = 0; //ALE
1428          	P23 = 1; //CLE
1429          	
1430          	P0 = 0xd0;//Erase confirm commmand
1431          	
1432          	P21 = 0; //WE
1433          	P21 = 1; //WE
1434          	P23 = 0;  //CLE	
1435          	do
1436              {
1437          	}while(P26!=1); //wait P26 =1 ,command erase respond end
1438          	P23 = 1;
1439          	P0 =0x70;
1440          	P21 = 0; //WE
1441          	P21 = 1; //WE
1442          	P0 =0xFF;
1443          	P23 = 0;
1444          	P25 = 0; //RD
1445          	Statuse = P0;
1446          	P25 = 1; //RD
1447          	
1448          	Statuse &=0x0F;
1449          	if(Statuse !=0) ErrorFlash++;
1450          	
1451          	P1 = 0xFF;
1452          }
1453          */
1454          
1455          
1456          
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 35  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION L?0298 (BEGIN)
0000         L?0299:
0000 E500        R     MOV     A,U_Data+03H
0002 2420              ADD     A,#020H
0004 F500        R     MOV     U_Data+03H,A
0006 E4                CLR     A
0007 3500        R     ADDC    A,U_Data+02H
0009 F500        R     MOV     U_Data+02H,A
000B E4                CLR     A
000C 3500        R     ADDC    A,U_Data+01H
000E F500        R     MOV     U_Data+01H,A
0010 E4                CLR     A
0011 3500        R     ADDC    A,U_Data
0013 F500        R     MOV     U_Data,A
             ; FUNCTION CheckFlash (BEGIN)
                                           ; SOURCE LINE # 41
                                           ; SOURCE LINE # 42
                                           ; SOURCE LINE # 45
0015 E500        R     MOV     A,U_Data+01H
0017 D3                SETB    C
0018 9401              SUBB    A,#01H
001A 4055              JC      ?C0001
                                           ; SOURCE LINE # 47
001C 900000      R     MOV     DPTR,#UseChip
001F E0                MOVX    A,@DPTR
0020 2401              ADD     A,#01H
0022 FF                MOV     R7,A
0023 E4                CLR     A
0024 33                RLC     A
0025 FE                MOV     R6,A
;---- Variable 'i' assigned to Register 'R6/R7' ----
0026         ?C0002:
0026 C3                CLR     C
0027 EF                MOV     A,R7
0028 9406              SUBB    A,#06H
002A EE                MOV     A,R6
002B 6480              XRL     A,#080H
002D 9480              SUBB    A,#080H
002F 5016              JNC     ?C0003
                                           ; SOURCE LINE # 48
0031 7400        R     MOV     A,#LOW FlashChip
0033 2F                ADD     A,R7
0034 F8                MOV     R0,A
0035 E6                MOV     A,@R0
0036 B44007            CJNE    A,#040H,?C0004
                                           ; SOURCE LINE # 49
0039 900000      R     MOV     DPTR,#UseChip
003C EF                MOV     A,R7
003D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 50
003E 8007              SJMP    ?C0003
                                           ; SOURCE LINE # 51
                                           ; SOURCE LINE # 52
0040         ?C0004:
0040 0F                INC     R7
0041 BF0001            CJNE    R7,#00H,?C0248
0044 0E                INC     R6
0045         ?C0248:
0045 80DF              SJMP    ?C0002
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 36  

0047         ?C0003:
                                           ; SOURCE LINE # 53
0047 EF                MOV     A,R7
0048 6406              XRL     A,#06H
004A 4E                ORL     A,R6
004B 700B              JNZ     ?C0006
                                           ; SOURCE LINE # 54
004D 900000      R     MOV     DPTR,#UseChip
0050 7406              MOV     A,#06H
0052 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 55
0053 7E00              MOV     R6,#00H
0055 7F00              MOV     R7,#00H
0057 22                RET     
                                           ; SOURCE LINE # 56
0058         ?C0006:
                                           ; SOURCE LINE # 57
0058 E4                CLR     A
0059 F500        R     MOV     U_Data+03H,A
                                           ; SOURCE LINE # 58
005B F500        R     MOV     U_Data+02H,A
                                           ; SOURCE LINE # 59
005D F500        R     MOV     U_Data+01H,A
                                           ; SOURCE LINE # 60
005F 900000      R     MOV     DPTR,#ADDR25
0062 E500        R     MOV     A,U_Data+01H
0064 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 61
0065 900000      R     MOV     DPTR,#ADDR9_16
0068 E500        R     MOV     A,U_Data+03H
006A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 62
006B 900000      R     MOV     DPTR,#ADDR17_24
006E E500        R     MOV     A,U_Data+02H
0070 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 64
0071         ?C0001:
                                           ; SOURCE LINE # 66
0071 7E00              MOV     R6,#00H
0073 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 68
0075         ?C0007:
0075 22                RET     
             ; FUNCTION CheckFlash (END)

             ; FUNCTION _FindNextBlock (BEGIN)
                                           ; SOURCE LINE # 71
0000 8F00        R     MOV     offset+03H,R7
0002 8E00        R     MOV     offset+02H,R6
0004 8D00        R     MOV     offset+01H,R5
0006 8C00        R     MOV     offset,R4
                                           ; SOURCE LINE # 72
                                           ; SOURCE LINE # 73
0008 E4                CLR     A
0009 F500        R     MOV     i+03H,A
000B F500        R     MOV     i+02H,A
000D F500        R     MOV     i+01H,A
000F F500        R     MOV     i,A
                                           ; SOURCE LINE # 74
0011 F500        R     MOV     len+03H,A
0013 F500        R     MOV     len+02H,A
0015 F500        R     MOV     len+01H,A
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 37  

0017 F500        R     MOV     len,A
                                           ; SOURCE LINE # 75
0019 900000      R     MOV     DPTR,#ADDR9_16
001C E0                MOVX    A,@DPTR
001D F500        R     MOV     U_Data+03H,A
                                           ; SOURCE LINE # 76
001F 900000      R     MOV     DPTR,#ADDR17_24
0022 E0                MOVX    A,@DPTR
0023 F500        R     MOV     U_Data+02H,A
                                           ; SOURCE LINE # 77
0025 900000      R     MOV     DPTR,#ADDR25
0028 E0                MOVX    A,@DPTR
0029 F500        R     MOV     U_Data+01H,A
                                           ; SOURCE LINE # 78
002B E4                CLR     A
002C F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 80
002E 7F20              MOV     R7,#020H
0030 FE                MOV     R6,A
0031 FD                MOV     R5,A
0032 FC                MOV     R4,A
0033 AB00        R     MOV     R3,offset+03H
0035 AA00        R     MOV     R2,offset+02H
0037 A900        R     MOV     R1,offset+01H
0039 A800        R     MOV     R0,offset
003B 120000      E     LCALL   ?C?LMUL
003E 8F00        R     MOV     len+03H,R7
0040 8E00        R     MOV     len+02H,R6
0042 8D00        R     MOV     len+01H,R5
0044 8C00        R     MOV     len,R4
                                           ; SOURCE LINE # 82
0046 E500        R     MOV     A,U_Data+03H
0048 2420              ADD     A,#020H
004A F500        R     MOV     U_Data+03H,A
004C E4                CLR     A
004D 3500        R     ADDC    A,U_Data+02H
004F F500        R     MOV     U_Data+02H,A
0051 E4                CLR     A
0052 3500        R     ADDC    A,U_Data+01H
0054 F500        R     MOV     U_Data+01H,A
0056 E4                CLR     A
0057 3500        R     ADDC    A,U_Data
0059 F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 83
005B E500        R     MOV     A,U_Data
005D 6005              JZ      ?C0008
                                           ; SOURCE LINE # 84
005F 7E00              MOV     R6,#00H
0061 7F00              MOV     R7,#00H
0063 22                RET     
0064         ?C0008:
                                           ; SOURCE LINE # 85
0064 E500        R     MOV     A,U_Data+01H
0066 D3                SETB    C
0067 9401              SUBB    A,#01H
0069 5003              JNC     $ + 5H
006B 020000      R     LJMP    ?C0010
                                           ; SOURCE LINE # 86
                                           ; SOURCE LINE # 87
006E 900000      R     MOV     DPTR,#UseChip
0071 E0                MOVX    A,@DPTR
0072 2401              ADD     A,#01H
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 38  

0074 FF                MOV     R7,A
0075 E4                CLR     A
0076 33                RLC     A
0077 FE                MOV     R6,A
0078 E4                CLR     A
0079 8F00        R     MOV     i+03H,R7
007B 8E00        R     MOV     i+02H,R6
007D F500        R     MOV     i+01H,A
007F F500        R     MOV     i,A
0081         ?C0011:
0081 E4                CLR     A
0082 7F06              MOV     R7,#06H
0084 FE                MOV     R6,A
0085 FD                MOV     R5,A
0086 FC                MOV     R4,A
0087 AB00        R     MOV     R3,i+03H
0089 AA00        R     MOV     R2,i+02H
008B A900        R     MOV     R1,i+01H
008D A800        R     MOV     R0,i
008F C3                CLR     C
0090 120000      E     LCALL   ?C?ULCMP
0093 5028              JNC     ?C0012
                                           ; SOURCE LINE # 88
                                           ; SOURCE LINE # 89
0095 AF00        R     MOV     R7,i+03H
0097 7400        R     MOV     A,#LOW FlashChip
0099 2F                ADD     A,R7
009A F8                MOV     R0,A
009B E6                MOV     A,@R0
009C B44007            CJNE    A,#040H,?C0013
                                           ; SOURCE LINE # 90
                                           ; SOURCE LINE # 91
009F 900000      R     MOV     DPTR,#UseChip
00A2 EF                MOV     A,R7
00A3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 92
00A4 8017              SJMP    ?C0012
                                           ; SOURCE LINE # 93
                                           ; SOURCE LINE # 94
00A6         ?C0013:
00A6 E500        R     MOV     A,i+03H
00A8 2401              ADD     A,#01H
00AA F500        R     MOV     i+03H,A
00AC E4                CLR     A
00AD 3500        R     ADDC    A,i+02H
00AF F500        R     MOV     i+02H,A
00B1 E4                CLR     A
00B2 3500        R     ADDC    A,i+01H
00B4 F500        R     MOV     i+01H,A
00B6 E4                CLR     A
00B7 3500        R     ADDC    A,i
00B9 F500        R     MOV     i,A
00BB 80C4              SJMP    ?C0011
00BD         ?C0012:
                                           ; SOURCE LINE # 95
00BD E4                CLR     A
00BE 7F06              MOV     R7,#06H
00C0 FE                MOV     R6,A
00C1 FD                MOV     R5,A
00C2 FC                MOV     R4,A
00C3 AB00        R     MOV     R3,i+03H
00C5 AA00        R     MOV     R2,i+02H
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 39  

00C7 A900        R     MOV     R1,i+01H
00C9 A800        R     MOV     R0,i
00CB C3                CLR     C
00CC 120000      E     LCALL   ?C?ULCMP
00CF 700B              JNZ     ?C0015
                                           ; SOURCE LINE # 96
                                           ; SOURCE LINE # 97
00D1 900000      R     MOV     DPTR,#UseChip
00D4 7406              MOV     A,#06H
00D6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 98
00D7 7E00              MOV     R6,#00H
00D9 7F00              MOV     R7,#00H
00DB 22                RET     
                                           ; SOURCE LINE # 99
00DC         ?C0015:
                                           ; SOURCE LINE # 100
00DC E4                CLR     A
00DD F500        R     MOV     U_Data+03H,A
00DF F500        R     MOV     U_Data+02H,A
00E1 F500        R     MOV     U_Data+01H,A
00E3 F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 101
00E5 900000      R     MOV     DPTR,#ADDR25
00E8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 102
00E9 900000      R     MOV     DPTR,#ADDR9_16
00EC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 103
00ED 900000      R     MOV     DPTR,#ADDR17_24
00F0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 104
00F1 120000      R     LCALL   ReadOnePage_C
00F4         ?C0016:
                                           ; SOURCE LINE # 105
00F4 900000      R     MOV     DPTR,#rparameter_buffer
00F7 E0                MOVX    A,@DPTR
00F8 702C              JNZ     ?C0017
                                           ; SOURCE LINE # 106
                                           ; SOURCE LINE # 107
00FA E500        R     MOV     A,U_Data+03H
00FC 2420              ADD     A,#020H
00FE F500        R     MOV     U_Data+03H,A
0100 E4                CLR     A
0101 3500        R     ADDC    A,U_Data+02H
0103 F500        R     MOV     U_Data+02H,A
0105 E4                CLR     A
0106 3500        R     ADDC    A,U_Data+01H
0108 F500        R     MOV     U_Data+01H,A
010A E4                CLR     A
010B 3500        R     ADDC    A,U_Data
010D F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 108
010F E500        R     MOV     A,U_Data+01H
0111 D3                SETB    C
0112 9401              SUBB    A,#01H
0114 400B              JC      ?C0018
                                           ; SOURCE LINE # 109
                                           ; SOURCE LINE # 110
0116 E4                CLR     A
0117 F500        R     MOV     U_Data+03H,A
0119 F500        R     MOV     U_Data+02H,A
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 40  

011B F500        R     MOV     U_Data+01H,A
011D F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 111
011F 8052              SJMP    blockaddress
                                           ; SOURCE LINE # 112
0121         ?C0018:
                                           ; SOURCE LINE # 113
                                           ; SOURCE LINE # 114
                                           ; SOURCE LINE # 115
                                           ; SOURCE LINE # 116
0121 120000      R     LCALL   L?0297
                                           ; SOURCE LINE # 118
0124 80CE              SJMP    ?C0016
0126         ?C0017:
                                           ; SOURCE LINE # 119
0126 900000      R     MOV     DPTR,#rparameter_buffer
0129 E0                MOVX    A,@DPTR
                                           ; SOURCE LINE # 120
012A 8047              SJMP    blockaddress
                                           ; SOURCE LINE # 121
012C         ?C0010:
                                           ; SOURCE LINE # 123
                                           ; SOURCE LINE # 124
012C 900000      R     MOV     DPTR,#ADDR25
012F E500        R     MOV     A,U_Data+01H
0131 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 125
0132 900000      R     MOV     DPTR,#ADDR9_16
0135 E500        R     MOV     A,U_Data+03H
0137 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 126
0138 900000      R     MOV     DPTR,#ADDR17_24
013B E500        R     MOV     A,U_Data+02H
013D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 127
013E 120000      R     LCALL   ReadOnePage_C
0141         ?C0022:
                                           ; SOURCE LINE # 128
0141 900000      R     MOV     DPTR,#rparameter_buffer
0144 E0                MOVX    A,@DPTR
0145 702C              JNZ     ?C0023
                                           ; SOURCE LINE # 129
                                           ; SOURCE LINE # 130
0147 E500        R     MOV     A,U_Data+03H
0149 2420              ADD     A,#020H
014B F500        R     MOV     U_Data+03H,A
014D E4                CLR     A
014E 3500        R     ADDC    A,U_Data+02H
0150 F500        R     MOV     U_Data+02H,A
0152 E4                CLR     A
0153 3500        R     ADDC    A,U_Data+01H
0155 F500        R     MOV     U_Data+01H,A
0157 E4                CLR     A
0158 3500        R     ADDC    A,U_Data
015A F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 131
015C E500        R     MOV     A,U_Data+01H
015E D3                SETB    C
015F 9401              SUBB    A,#01H
0161 400B              JC      ?C0024
                                           ; SOURCE LINE # 132
                                           ; SOURCE LINE # 133
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 41  

0163 E4                CLR     A
0164 F500        R     MOV     U_Data+03H,A
0166 F500        R     MOV     U_Data+02H,A
0168 F500        R     MOV     U_Data+01H,A
016A F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 134
016C 8005              SJMP    blockaddress
                                           ; SOURCE LINE # 135
016E         ?C0024:
                                           ; SOURCE LINE # 136
                                           ; SOURCE LINE # 137
                                           ; SOURCE LINE # 138
                                           ; SOURCE LINE # 139
016E 120000      R     LCALL   L?0297
                                           ; SOURCE LINE # 141
0171 80CE              SJMP    ?C0022
0173         ?C0023:
                                           ; SOURCE LINE # 142
                                           ; SOURCE LINE # 143
                                           ; SOURCE LINE # 145
                                           ; SOURCE LINE # 146
0173         blockaddress:
                                           ; SOURCE LINE # 147
0173 900000      R     MOV     DPTR,#ADDR9_16
0176 E500        R     MOV     A,U_Data+03H
0178 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 148
0179 900000      R     MOV     DPTR,#ADDR17_24
017C E500        R     MOV     A,U_Data+02H
017E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 149
017F 900000      R     MOV     DPTR,#ADDR25
0182 E500        R     MOV     A,U_Data+01H
0184 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 151
0185         ?C0009:
0185 22                RET     
             ; FUNCTION _FindNextBlock (END)

             ; FUNCTION FindPrvBlock (BEGIN)
                                           ; SOURCE LINE # 153
                                           ; SOURCE LINE # 154
                                           ; SOURCE LINE # 155
;---- Variable 'i' assigned to Register 'R2/R3' ----
0000 E4                CLR     A
0001 FB                MOV     R3,A
0002 FA                MOV     R2,A
                                           ; SOURCE LINE # 156
0003 900000      R     MOV     DPTR,#ADDR9_16
0006 E0                MOVX    A,@DPTR
0007 6003              JZ      $ + 5H
0009 020000      R     LJMP    ?C0026
000C 900000      R     MOV     DPTR,#ADDR17_24
000F E0                MOVX    A,@DPTR
0010 6003              JZ      $ + 5H
0012 020000      R     LJMP    ?C0026
0015 900000      R     MOV     DPTR,#ADDR25
0018 E0                MOVX    A,@DPTR
0019 6003              JZ      $ + 5H
001B 020000      R     LJMP    ?C0026
                                           ; SOURCE LINE # 157
                                           ; SOURCE LINE # 158
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 42  

001E 900000      R     MOV     DPTR,#UseChip
0021 E0                MOVX    A,@DPTR
0022 F9                MOV     R1,A
0023 700B              JNZ     ?C0027
                                           ; SOURCE LINE # 159
                                           ; SOURCE LINE # 160
0025 F500        R     MOV     U_Data+03H,A
0027 F500        R     MOV     U_Data+02H,A
0029 F500        R     MOV     U_Data+01H,A
002B F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 161
002D 020000      R     LJMP    prvblockaddress
                                           ; SOURCE LINE # 162
0030         ?C0027:
                                           ; SOURCE LINE # 163
0030 E9                MOV     A,R1
0031 24FF              ADD     A,#0FFH
0033 FB                MOV     R3,A
0034 E4                CLR     A
0035 34FF              ADDC    A,#0FFH
0037 FA                MOV     R2,A
0038         ?C0029:
0038 C3                CLR     C
0039 EA                MOV     A,R2
003A 6480              XRL     A,#080H
003C 9480              SUBB    A,#080H
003E 4025              JC      ?C0030
                                           ; SOURCE LINE # 164
                                           ; SOURCE LINE # 165
0040 7400        R     MOV     A,#LOW FlashChip
0042 2B                ADD     A,R3
0043 F8                MOV     R0,A
0044 E6                MOV     A,@R0
0045 B44007            CJNE    A,#040H,?C0032
                                           ; SOURCE LINE # 166
                                           ; SOURCE LINE # 167
0048 900000      R     MOV     DPTR,#UseChip
004B EB                MOV     A,R3
004C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 168
004D 8016              SJMP    ?C0030
                                           ; SOURCE LINE # 169
004F         ?C0032:
                                           ; SOURCE LINE # 170
004F EB                MOV     A,R3
0050 4A                ORL     A,R2
0051 700B              JNZ     ?C0031
                                           ; SOURCE LINE # 171
                                           ; SOURCE LINE # 172
0053 900000      R     MOV     DPTR,#UseChip
0056 7406              MOV     A,#06H
0058 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 173
0059 7E00              MOV     R6,#00H
005B 7F00              MOV     R7,#00H
005D 22                RET     
                                           ; SOURCE LINE # 174
                                           ; SOURCE LINE # 175
005E         ?C0031:
005E EB                MOV     A,R3
005F 1B                DEC     R3
0060 70D6              JNZ     ?C0029
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 43  

0062 1A                DEC     R2
0063         ?C0249:
0063 80D3              SJMP    ?C0029
0065         ?C0030:
                                           ; SOURCE LINE # 177
0065 7500E0      R     MOV     U_Data+03H,#0E0H
                                           ; SOURCE LINE # 178
0068 7500FF      R     MOV     U_Data+02H,#0FFH
                                           ; SOURCE LINE # 179
006B 750001      R     MOV     U_Data+01H,#01H
                                           ; SOURCE LINE # 180
006E E4                CLR     A
                                           ; SOURCE LINE # 182
                                           ; SOURCE LINE # 183
                                           ; SOURCE LINE # 184
                                           ; SOURCE LINE # 185
006F 120000      R     LCALL   L?0296
0072         ?C0036:
                                           ; SOURCE LINE # 187
0072 900000      R     MOV     DPTR,#rparameter_buffer
0075 E0                MOVX    A,@DPTR
0076 7036              JNZ     ?C0037
                                           ; SOURCE LINE # 188
                                           ; SOURCE LINE # 189
0078 C3                CLR     C
0079 E500        R     MOV     A,U_Data+03H
007B 9420              SUBB    A,#020H
007D F500        R     MOV     U_Data+03H,A
007F E500        R     MOV     A,U_Data+02H
0081 9400              SUBB    A,#00H
0083 F500        R     MOV     U_Data+02H,A
0085 E500        R     MOV     A,U_Data+01H
0087 9400              SUBB    A,#00H
0089 F500        R     MOV     U_Data+01H,A
008B E500        R     MOV     A,U_Data
008D 9400              SUBB    A,#00H
008F F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 190
0091 E500        R     MOV     A,U_Data
0093 D3                SETB    C
0094 9400              SUBB    A,#00H
0096 400C              JC      ?C0038
                                           ; SOURCE LINE # 191
                                           ; SOURCE LINE # 192
0098 E4                CLR     A
0099 F500        R     MOV     U_Data+03H,A
009B F500        R     MOV     U_Data+02H,A
009D F500        R     MOV     U_Data+01H,A
009F F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 193
00A1 020000      R     LJMP    prvblockaddress
                                           ; SOURCE LINE # 194
00A4         ?C0038:
                                           ; SOURCE LINE # 195
                                           ; SOURCE LINE # 196
                                           ; SOURCE LINE # 197
                                           ; SOURCE LINE # 198
00A4 120000      R     LCALL   L?0297
                                           ; SOURCE LINE # 199
00A7 900000      R     MOV     DPTR,#rparameter_buffer
00AA E0                MOVX    A,@DPTR
00AB B4AAC4            CJNE    A,#0AAH,?C0036
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 44  

                                           ; SOURCE LINE # 200
                                           ; SOURCE LINE # 202
00AE         ?C0037:
                                           ; SOURCE LINE # 203
00AE 900000      R     MOV     DPTR,#ADDR9_16
00B1 E500        R     MOV     A,U_Data+03H
00B3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 204
00B4 900000      R     MOV     DPTR,#ADDR17_24
00B7 E500        R     MOV     A,U_Data+02H
00B9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 205
00BA 900000      R     MOV     DPTR,#ADDR25
00BD E500        R     MOV     A,U_Data+01H
00BF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 207
00C0 020000      R     LJMP    prvblockaddress
00C3         ?C0026:
                                           ; SOURCE LINE # 209
                                           ; SOURCE LINE # 210
00C3 900000      R     MOV     DPTR,#ADDR9_16
00C6 E0                MOVX    A,@DPTR
00C7 F500        R     MOV     U_Data+03H,A
                                           ; SOURCE LINE # 211
00C9 900000      R     MOV     DPTR,#ADDR17_24
00CC E0                MOVX    A,@DPTR
00CD F500        R     MOV     U_Data+02H,A
                                           ; SOURCE LINE # 212
00CF 900000      R     MOV     DPTR,#ADDR25
00D2 E0                MOVX    A,@DPTR
00D3 F500        R     MOV     U_Data+01H,A
                                           ; SOURCE LINE # 213
00D5 E4                CLR     A
00D6 F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 215
00D8 C3                CLR     C
00D9 E500        R     MOV     A,U_Data+03H
00DB 9420              SUBB    A,#020H
00DD F500        R     MOV     U_Data+03H,A
00DF E500        R     MOV     A,U_Data+02H
00E1 9400              SUBB    A,#00H
00E3 F500        R     MOV     U_Data+02H,A
00E5 E500        R     MOV     A,U_Data+01H
00E7 9400              SUBB    A,#00H
00E9 F500        R     MOV     U_Data+01H,A
00EB E500        R     MOV     A,U_Data
00ED 9400              SUBB    A,#00H
                                           ; SOURCE LINE # 216
                                           ; SOURCE LINE # 217
                                           ; SOURCE LINE # 218
                                           ; SOURCE LINE # 219
00EF 120000      R     LCALL   L?0296
00F2         ?C0041:
                                           ; SOURCE LINE # 221
00F2 900000      R     MOV     DPTR,#rparameter_buffer
00F5 E0                MOVX    A,@DPTR
00F6 7035              JNZ     ?C0042
                                           ; SOURCE LINE # 222
                                           ; SOURCE LINE # 223
00F8 C3                CLR     C
00F9 E500        R     MOV     A,U_Data+03H
00FB 9420              SUBB    A,#020H
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 45  

00FD F500        R     MOV     U_Data+03H,A
00FF E500        R     MOV     A,U_Data+02H
0101 9400              SUBB    A,#00H
0103 F500        R     MOV     U_Data+02H,A
0105 E500        R     MOV     A,U_Data+01H
0107 9400              SUBB    A,#00H
0109 F500        R     MOV     U_Data+01H,A
010B E500        R     MOV     A,U_Data
010D 9400              SUBB    A,#00H
010F F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 224
0111 E500        R     MOV     A,U_Data
0113 D3                SETB    C
0114 9400              SUBB    A,#00H
0116 400B              JC      ?C0043
                                           ; SOURCE LINE # 225
                                           ; SOURCE LINE # 226
0118 E4                CLR     A
0119 F500        R     MOV     U_Data+03H,A
011B F500        R     MOV     U_Data+02H,A
011D F500        R     MOV     U_Data+01H,A
011F F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 227
0121 801C              SJMP    prvblockaddress
                                           ; SOURCE LINE # 228
0123         ?C0043:
                                           ; SOURCE LINE # 229
                                           ; SOURCE LINE # 230
                                           ; SOURCE LINE # 231
                                           ; SOURCE LINE # 232
0123 120000      R     LCALL   L?0297
                                           ; SOURCE LINE # 233
0126 900000      R     MOV     DPTR,#rparameter_buffer
0129 E0                MOVX    A,@DPTR
012A B4AAC5            CJNE    A,#0AAH,?C0041
                                           ; SOURCE LINE # 234
                                           ; SOURCE LINE # 236
012D         ?C0042:
                                           ; SOURCE LINE # 237
012D 900000      R     MOV     DPTR,#ADDR9_16
0130 E500        R     MOV     A,U_Data+03H
0132 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 238
0133 900000      R     MOV     DPTR,#ADDR17_24
0136 E500        R     MOV     A,U_Data+02H
0138 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 239
0139 900000      R     MOV     DPTR,#ADDR25
013C E500        R     MOV     A,U_Data+01H
013E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 241
                                           ; SOURCE LINE # 242
013F         prvblockaddress:
                                           ; SOURCE LINE # 243
013F 900000      R     MOV     DPTR,#ADDR9_16
0142 E500        R     MOV     A,U_Data+03H
0144 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 244
0145 900000      R     MOV     DPTR,#ADDR17_24
0148 E500        R     MOV     A,U_Data+02H
014A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 245
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 46  

014B 900000      R     MOV     DPTR,#ADDR25
014E E500        R     MOV     A,U_Data+01H
0150 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 246
0151 7E00              MOV     R6,#00H
0153 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 248
0155         ?C0035:
0155 22                RET     
             ; FUNCTION FindPrvBlock (END)

             ; FUNCTION _FindPage (BEGIN)
                                           ; SOURCE LINE # 249
0000 8F00        R     MOV     offset+03H,R7
0002 8E00        R     MOV     offset+02H,R6
0004 8D00        R     MOV     offset+01H,R5
0006 8C00        R     MOV     offset,R4
                                           ; SOURCE LINE # 250
                                           ; SOURCE LINE # 254
0008 900000      R     MOV     DPTR,#ADDR9_16
000B E0                MOVX    A,@DPTR
000C FF                MOV     R7,A
000D F500        R     MOV     U_Data+03H,A
                                           ; SOURCE LINE # 255
000F 900000      R     MOV     DPTR,#ADDR17_24
0012 E0                MOVX    A,@DPTR
0013 FE                MOV     R6,A
0014 F500        R     MOV     U_Data+02H,A
                                           ; SOURCE LINE # 256
0016 900000      R     MOV     DPTR,#ADDR25
0019 E0                MOVX    A,@DPTR
001A FD                MOV     R5,A
001B F500        R     MOV     U_Data+01H,A
                                           ; SOURCE LINE # 257
001D E4                CLR     A
001E F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 259
0020 900000      R     MOV     DPTR,#UseChip
0023 E0                MOVX    A,@DPTR
0024 7018              JNZ     ?C0045
0026 ED                MOV     A,R5
0027 B40114            CJNE    A,#01H,?C0045
002A EE                MOV     A,R6
002B B4FF10            CJNE    A,#0FFH,?C0045
002E EF                MOV     A,R7
002F B4DF0C            CJNE    A,#0DFH,?C0045
                                           ; SOURCE LINE # 260
0032 7500FF      R     MOV     U_Data+03H,#0FFH
0035 7500FF      R     MOV     U_Data+02H,#0FFH
0038 750001      R     MOV     U_Data+01H,#01H
003B 750000      R     MOV     U_Data,#00H
003E         ?C0045:
                                           ; SOURCE LINE # 268
003E E4                CLR     A
003F 7F20              MOV     R7,#020H
0041 FE                MOV     R6,A
0042 FD                MOV     R5,A
0043 FC                MOV     R4,A
0044 AB00        R     MOV     R3,offset+03H
0046 AA00        R     MOV     R2,offset+02H
0048 A900        R     MOV     R1,offset+01H
004A A800        R     MOV     R0,offset
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 47  

004C C3                CLR     C
004D 120000      E     LCALL   ?C?ULCMP
0050 504B              JNC     ?C0047
0052 900000      R     MOV     DPTR,#ADDR9_16
0055 E0                MOVX    A,@DPTR
0056 FF                MOV     R7,A
0057 E4                CLR     A
0058 EF                MOV     A,R7
0059 2500        R     ADD     A,offset+03H
005B FF                MOV     R7,A
005C E4                CLR     A
005D 3500        R     ADDC    A,offset+02H
005F FE                MOV     R6,A
0060 E4                CLR     A
0061 3500        R     ADDC    A,offset+01H
0063 FD                MOV     R5,A
0064 E4                CLR     A
0065 3500        R     ADDC    A,offset
0067 FC                MOV     R4,A
0068 E4                CLR     A
0069 7B20              MOV     R3,#020H
006B FA                MOV     R2,A
006C F9                MOV     R1,A
006D F8                MOV     R0,A
006E 120000      E     LCALL   ?C?ULDIV
0071 C004              PUSH    AR4
0073 C005              PUSH    AR5
0075 C006              PUSH    AR6
0077 C007              PUSH    AR7
0079 900000      R     MOV     DPTR,#ADDR9_16
007C E0                MOVX    A,@DPTR
007D FF                MOV     R7,A
007E C4                SWAP    A
007F 13                RRC     A
0080 5407              ANL     A,#07H
0082 FF                MOV     R7,A
0083 E4                CLR     A
0084 FC                MOV     R4,A
0085 FD                MOV     R5,A
0086 FE                MOV     R6,A
0087 F8                MOV     R0,A
0088 F9                MOV     R1,A
0089 FA                MOV     R2,A
008A AB07              MOV     R3,AR7
008C D007              POP     AR7
008E D006              POP     AR6
0090 D005              POP     AR5
0092 D004              POP     AR4
0094 C3                CLR     C
0095 120000      E     LCALL   ?C?ULCMP
0098 7003              JNZ     $ + 5H
009A 020000      R     LJMP    ?C0046
009D         ?C0047:
                                           ; SOURCE LINE # 269
009D E4                CLR     A
009E 7B20              MOV     R3,#020H
00A0 FA                MOV     R2,A
00A1 F9                MOV     R1,A
00A2 F8                MOV     R0,A
00A3 AF00        R     MOV     R7,offset+03H
00A5 AE00        R     MOV     R6,offset+02H
00A7 AD00        R     MOV     R5,offset+01H
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 48  

00A9 AC00        R     MOV     R4,offset
00AB 120000      E     LCALL   ?C?ULDIV
00AE 8F00        R     MOV     k+03H,R7
00B0 8E00        R     MOV     k+02H,R6
00B2 8D00        R     MOV     k+01H,R5
00B4 8C00        R     MOV     k,R4
                                           ; SOURCE LINE # 271
00B6 900000      R     MOV     DPTR,#ADDR9_16
00B9 E0                MOVX    A,@DPTR
00BA FB                MOV     R3,A
00BB C4                SWAP    A
00BC 13                RRC     A
00BD 5407              ANL     A,#07H
00BF 75F020            MOV     B,#020H
00C2 A4                MUL     AB
00C3 FF                MOV     R7,A
00C4 EB                MOV     A,R3
00C5 C3                CLR     C
00C6 9F                SUBB    A,R7
00C7 FF                MOV     R7,A
00C8 E4                CLR     A
00C9 95F0              SUBB    A,B
00CB FE                MOV     R6,A
00CC E4                CLR     A
00CD 8F00        R     MOV     m+03H,R7
00CF 8E00        R     MOV     m+02H,R6
00D1 F500        R     MOV     m+01H,A
00D3 F500        R     MOV     m,A
                                           ; SOURCE LINE # 272
00D5 C3                CLR     C
00D6 EB                MOV     A,R3
00D7 9500        R     SUBB    A,m+03H
00D9 F500        R     MOV     n+03H,A
00DB E4                CLR     A
00DC 9500        R     SUBB    A,m+02H
00DE F500        R     MOV     n+02H,A
00E0 E4                CLR     A
00E1 9500        R     SUBB    A,m+01H
00E3 F500        R     MOV     n+01H,A
00E5 E4                CLR     A
00E6 9500        R     SUBB    A,m
00E8 F500        R     MOV     n,A
                                           ; SOURCE LINE # 273
00EA E500        R     MOV     A,offset+03H
00EC 541F              ANL     A,#01FH
00EE FF                MOV     R7,A
00EF E4                CLR     A
00F0 EF                MOV     A,R7
00F1 2500        R     ADD     A,m+03H
00F3 F500        R     MOV     j+03H,A
00F5 E4                CLR     A
00F6 3500        R     ADDC    A,m+02H
00F8 F500        R     MOV     j+02H,A
00FA E4                CLR     A
00FB 3500        R     ADDC    A,m+01H
00FD F500        R     MOV     j+01H,A
00FF E4                CLR     A
0100 3500        R     ADDC    A,m
0102 F500        R     MOV     j,A
                                           ; SOURCE LINE # 274
0104 E500        R     MOV     A,j+03H
0106 541F              ANL     A,#01FH
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 49  

0108 F500        R     MOV     l+03H,A
010A E4                CLR     A
010B F500        R     MOV     l+02H,A
010D F500        R     MOV     l+01H,A
010F F500        R     MOV     l,A
                                           ; SOURCE LINE # 275
0111 FF                MOV     R7,A
0112 FE                MOV     R6,A
0113 FD                MOV     R5,A
0114 FC                MOV     R4,A
0115 AB00        R     MOV     R3,k+03H
0117 AA00        R     MOV     R2,k+02H
0119 A900        R     MOV     R1,k+01H
011B A800        R     MOV     R0,k
011D C3                CLR     C
011E 120000      E     LCALL   ?C?ULCMP
0121 7003              JNZ     $ + 5H
0123 020000      R     LJMP    ?C0048
                                           ; SOURCE LINE # 276
0126 AA00        R     MOV     R2,m+02H
0128 A900        R     MOV     R1,m+01H
012A A800        R     MOV     R0,m
012C C3                CLR     C
012D E500        R     MOV     A,U_Data+03H
012F 9500        R     SUBB    A,m+03H
0131 F500        R     MOV     U_Data+03H,A
0133 E500        R     MOV     A,U_Data+02H
0135 9A                SUBB    A,R2
0136 F500        R     MOV     U_Data+02H,A
0138 E500        R     MOV     A,U_Data+01H
013A 99                SUBB    A,R1
013B F500        R     MOV     U_Data+01H,A
013D E500        R     MOV     A,U_Data
013F 98                SUBB    A,R0
0140 F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 277
0142         ?C0049:
0142 E4                CLR     A
0143 FF                MOV     R7,A
0144 FE                MOV     R6,A
0145 FD                MOV     R5,A
0146 FC                MOV     R4,A
0147 AB00        R     MOV     R3,k+03H
0149 AA00        R     MOV     R2,k+02H
014B A900        R     MOV     R1,k+01H
014D A800        R     MOV     R0,k
014F D3                SETB    C
0150 120000      E     LCALL   ?C?ULCMP
0153 5003              JNC     $ + 5H
0155 020000      R     LJMP    ?C0061
                                           ; SOURCE LINE # 278
                                           ; SOURCE LINE # 279
0158 120000      R     LCALL   L?0298
015B EF                MOV     A,R7
015C 4E                ORL     A,R6
015D 7003              JNZ     ?C0052
                                           ; SOURCE LINE # 280
015F FE                MOV     R6,A
0160 FF                MOV     R7,A
0161 22                RET     
0162         ?C0052:
                                           ; SOURCE LINE # 281
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 50  

                                           ; SOURCE LINE # 282
                                           ; SOURCE LINE # 283
                                           ; SOURCE LINE # 285
0162 120000      R     LCALL   L?0297
                                           ; SOURCE LINE # 286
0165 900000      R     MOV     DPTR,#rparameter_buffer
0168 E0                MOVX    A,@DPTR
0169 7018              JNZ     ?C0054
                                           ; SOURCE LINE # 287
016B E500        R     MOV     A,k+03H
016D 2401              ADD     A,#01H
016F F500        R     MOV     k+03H,A
0171 E4                CLR     A
0172 3500        R     ADDC    A,k+02H
0174 F500        R     MOV     k+02H,A
0176 E4                CLR     A
0177 3500        R     ADDC    A,k+01H
0179 F500        R     MOV     k+01H,A
017B E4                CLR     A
017C 3500        R     ADDC    A,k
017E F500        R     MOV     k,A
                                           ; SOURCE LINE # 288
0180 020000      R     LJMP    ?C0051
                                           ; SOURCE LINE # 289
0183         ?C0054:
0183 E4                CLR     A
0184 7F01              MOV     R7,#01H
0186 FE                MOV     R6,A
0187 FD                MOV     R5,A
0188 FC                MOV     R4,A
0189 AB00        R     MOV     R3,k+03H
018B AA00        R     MOV     R2,k+02H
018D A900        R     MOV     R1,k+01H
018F A800        R     MOV     R0,k
0191 C3                CLR     C
0192 120000      E     LCALL   ?C?ULCMP
0195 7035              JNZ     ?C0051
0197 7F20              MOV     R7,#020H
0199 FE                MOV     R6,A
019A FD                MOV     R5,A
019B FC                MOV     R4,A
019C AB00        R     MOV     R3,j+03H
019E AA00        R     MOV     R2,j+02H
01A0 A900        R     MOV     R1,j+01H
01A2 A800        R     MOV     R0,j
01A4 C3                CLR     C
01A5 120000      E     LCALL   ?C?ULCMP
01A8 4022              JC      ?C0051
                                           ; SOURCE LINE # 290
                                           ; SOURCE LINE # 291
01AA 120000      R     LCALL   L?0298
01AD EF                MOV     A,R7
01AE 4E                ORL     A,R6
01AF 7003              JNZ     ?C0057
                                           ; SOURCE LINE # 292
01B1 FE                MOV     R6,A
01B2 FF                MOV     R7,A
01B3 22                RET     
01B4         ?C0057:
                                           ; SOURCE LINE # 293
                                           ; SOURCE LINE # 294
                                           ; SOURCE LINE # 295
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 51  

                                           ; SOURCE LINE # 297
01B4 120000      R     LCALL   L?0297
01B7         ?C0058:
                                           ; SOURCE LINE # 298
01B7 900000      R     MOV     DPTR,#rparameter_buffer
01BA E0                MOVX    A,@DPTR
01BB 700F              JNZ     ?C0051
                                           ; SOURCE LINE # 299
                                           ; SOURCE LINE # 300
01BD 120000      R     LCALL   L?0299
01C0 EF                MOV     A,R7
01C1 4E                ORL     A,R6
01C2 7003              JNZ     ?C0060
                                           ; SOURCE LINE # 301
01C4 FE                MOV     R6,A
01C5 FF                MOV     R7,A
01C6 22                RET     
01C7         ?C0060:
                                           ; SOURCE LINE # 302
                                           ; SOURCE LINE # 303
                                           ; SOURCE LINE # 304
                                           ; SOURCE LINE # 306
01C7 120000      R     LCALL   L?0297
                                           ; SOURCE LINE # 307
01CA 80EB              SJMP    ?C0058
                                           ; SOURCE LINE # 308
                                           ; SOURCE LINE # 309
01CC         ?C0051:
01CC E500        R     MOV     A,k+03H
01CE 24FF              ADD     A,#0FFH
01D0 F500        R     MOV     k+03H,A
01D2 E500        R     MOV     A,k+02H
01D4 34FF              ADDC    A,#0FFH
01D6 F500        R     MOV     k+02H,A
01D8 E500        R     MOV     A,k+01H
01DA 34FF              ADDC    A,#0FFH
01DC F500        R     MOV     k+01H,A
01DE E500        R     MOV     A,k
01E0 34FF              ADDC    A,#0FFH
01E2 F500        R     MOV     k,A
01E4 020000      R     LJMP    ?C0049
                                           ; SOURCE LINE # 310
01E7         ?C0048:
                                           ; SOURCE LINE # 312
01E7 C3                CLR     C
01E8 7420              MOV     A,#020H
01EA 9500        R     SUBB    A,m+03H
01EC FF                MOV     R7,A
01ED E4                CLR     A
01EE 9500        R     SUBB    A,m+02H
01F0 FE                MOV     R6,A
01F1 E4                CLR     A
01F2 9500        R     SUBB    A,m+01H
01F4 FD                MOV     R5,A
01F5 E4                CLR     A
01F6 9500        R     SUBB    A,m
01F8 FC                MOV     R4,A
01F9 E500        R     MOV     A,U_Data+03H
01FB 2F                ADD     A,R7
01FC F500        R     MOV     U_Data+03H,A
01FE E500        R     MOV     A,U_Data+02H
0200 3E                ADDC    A,R6
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 52  

0201 F500        R     MOV     U_Data+02H,A
0203 E500        R     MOV     A,U_Data+01H
0205 3D                ADDC    A,R5
0206 F500        R     MOV     U_Data+01H,A
0208 E500        R     MOV     A,U_Data
020A 3C                ADDC    A,R4
020B F500        R     MOV     U_Data,A
020D         ?C0061:
                                           ; SOURCE LINE # 313
020D 120000      R     LCALL   CheckFlash
0210 EF                MOV     A,R7
0211 4E                ORL     A,R6
0212 7003              JNZ     ?C0062
                                           ; SOURCE LINE # 314
0214 FE                MOV     R6,A
0215 FF                MOV     R7,A
0216 22                RET     
0217         ?C0062:
                                           ; SOURCE LINE # 315
                                           ; SOURCE LINE # 316
                                           ; SOURCE LINE # 317
                                           ; SOURCE LINE # 319
0217 120000      R     LCALL   L?0297
021A         ?C0063:
                                           ; SOURCE LINE # 320
021A 900000      R     MOV     DPTR,#rparameter_buffer
021D E0                MOVX    A,@DPTR
021E 700F              JNZ     ?C0064
                                           ; SOURCE LINE # 321
                                           ; SOURCE LINE # 322
0220 120000      R     LCALL   L?0299
0223 EF                MOV     A,R7
0224 4E                ORL     A,R6
0225 7003              JNZ     ?C0065
                                           ; SOURCE LINE # 323
0227 FE                MOV     R6,A
0228 FF                MOV     R7,A
0229 22                RET     
022A         ?C0065:
                                           ; SOURCE LINE # 324
                                           ; SOURCE LINE # 325
                                           ; SOURCE LINE # 326
                                           ; SOURCE LINE # 328
022A 120000      R     LCALL   L?0297
                                           ; SOURCE LINE # 329
022D 80EB              SJMP    ?C0063
022F         ?C0064:
                                           ; SOURCE LINE # 330
022F AE00        R     MOV     R6,l+02H
0231 AD00        R     MOV     R5,l+01H
0233 AC00        R     MOV     R4,l
0235 E500        R     MOV     A,U_Data+03H
0237 2500        R     ADD     A,l+03H
0239 F500        R     MOV     U_Data+03H,A
023B E500        R     MOV     A,U_Data+02H
023D 3E                ADDC    A,R6
023E F500        R     MOV     U_Data+02H,A
0240 E500        R     MOV     A,U_Data+01H
0242 3D                ADDC    A,R5
0243 F500        R     MOV     U_Data+01H,A
0245 E500        R     MOV     A,U_Data
0247 3C                ADDC    A,R4
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 53  

0248 F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 333
024A 801B              SJMP    ?C0066
024C         ?C0046:
                                           ; SOURCE LINE # 337
024C AE00        R     MOV     R6,offset+02H
024E AD00        R     MOV     R5,offset+01H
0250 AC00        R     MOV     R4,offset
0252 E500        R     MOV     A,U_Data+03H
0254 2500        R     ADD     A,offset+03H
0256 F500        R     MOV     U_Data+03H,A
0258 E500        R     MOV     A,U_Data+02H
025A 3E                ADDC    A,R6
025B F500        R     MOV     U_Data+02H,A
025D E500        R     MOV     A,U_Data+01H
025F 3D                ADDC    A,R5
0260 F500        R     MOV     U_Data+01H,A
0262 E500        R     MOV     A,U_Data
0264 3C                ADDC    A,R4
0265 F500        R     MOV     U_Data,A
0267         ?C0066:
                                           ; SOURCE LINE # 339
0267 E500        R     MOV     A,U_Data
0269 6005              JZ      ?C0067
                                           ; SOURCE LINE # 340
026B 7E00              MOV     R6,#00H
026D 7F00              MOV     R7,#00H
026F 22                RET     
0270         ?C0067:
                                           ; SOURCE LINE # 342
0270 900000      R     MOV     DPTR,#ADDR25
0273 E500        R     MOV     A,U_Data+01H
0275 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 343
0276 900000      R     MOV     DPTR,#ADDR9_16
0279 E500        R     MOV     A,U_Data+03H
027B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 344
027C 900000      R     MOV     DPTR,#ADDR17_24
027F E500        R     MOV     A,U_Data+02H
0281 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 345
0282 7E00              MOV     R6,#00H
0284 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 346
0286         ?C0053:
0286 22                RET     
             ; FUNCTION _FindPage (END)

             ; FUNCTION FindEnd (BEGIN)
                                           ; SOURCE LINE # 349
                                           ; SOURCE LINE # 350
                                           ; SOURCE LINE # 352
0000 E4                CLR     A
0001 F500        R     MOV     chip,A
                                           ; SOURCE LINE # 353
0003 F500        R     MOV     addr9_16,A
                                           ; SOURCE LINE # 354
0005 F500        R     MOV     addr17_24,A
                                           ; SOURCE LINE # 355
0007 F500        R     MOV     addr25,A
                                           ; SOURCE LINE # 356
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 54  

0009 F500        R     MOV     address9_16,A
                                           ; SOURCE LINE # 357
000B F500        R     MOV     address17_24,A
                                           ; SOURCE LINE # 358
000D F500        R     MOV     address25,A
                                           ; SOURCE LINE # 359
;---- Variable 'count' assigned to Register 'R2/R3' ----
000F FB                MOV     R3,A
0010 FA                MOV     R2,A
                                           ; SOURCE LINE # 360
0011 F500        R     MOV     i1,A
0013 F500        R     MOV     i1+01H,A
                                           ; SOURCE LINE # 361
0015 F500        R     MOV     i2,A
                                           ; SOURCE LINE # 363
0017 900000      R     MOV     DPTR,#UseChip
001A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 364
001B F500        R     MOV     U_Data+03H,A
001D F500        R     MOV     U_Data+02H,A
001F F500        R     MOV     U_Data+01H,A
0021 F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 365
0023 900000      R     MOV     DPTR,#ADDR9_16
0026 E500        R     MOV     A,U_Data+03H
0028 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 366
0029 900000      R     MOV     DPTR,#ADDR17_24
002C E500        R     MOV     A,U_Data+02H
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 367
002F 900000      R     MOV     DPTR,#ADDR25
0032 E500        R     MOV     A,U_Data+01H
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 371
0035 E4                CLR     A
0036 F500        R     MOV     i,A
0038 F500        R     MOV     i+01H,A
003A         ?C0068:
                                           ; SOURCE LINE # 372
                                           ; SOURCE LINE # 373
003A 7400        R     MOV     A,#LOW FlashChip
003C 2500        R     ADD     A,i+01H
003E F8                MOV     R0,A
003F E6                MOV     A,@R0
0040 B44007            CJNE    A,#040H,?C0070
                                           ; SOURCE LINE # 374
                                           ; SOURCE LINE # 375
0043 0B                INC     R3
0044 BB0001            CJNE    R3,#00H,?C0250
0047 0A                INC     R2
0048         ?C0250:
                                           ; SOURCE LINE # 376
0048 800E              SJMP    ?C0069
                                           ; SOURCE LINE # 377
                                           ; SOURCE LINE # 378
004A         ?C0070:
004A 0500        R     INC     i+01H
004C E500        R     MOV     A,i+01H
004E 7002              JNZ     ?C0251
0050 0500        R     INC     i
0052         ?C0251:
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 55  

0052 6406              XRL     A,#06H
0054 4500        R     ORL     A,i
0056 70E2              JNZ     ?C0068
0058         ?C0069:
                                           ; SOURCE LINE # 379
0058 EB                MOV     A,R3
0059 4A                ORL     A,R2
005A 7003              JNZ     $ + 5H
005C 020000      R     LJMP    ?C0073
005F         ?C0072:
                                           ; SOURCE LINE # 382
005F 7500FF      R     MOV     chip,#0FFH
                                           ; SOURCE LINE # 388
0062 E4                CLR     A
0063 F500        R     MOV     i,A
0065 F500        R     MOV     i+01H,A
0067         ?C0074:
                                           ; SOURCE LINE # 389
                                           ; SOURCE LINE # 390
0067 AF00        R     MOV     R7,i+01H
0069 7400        R     MOV     A,#LOW FlashChip
006B 2F                ADD     A,R7
006C F8                MOV     R0,A
006D E6                MOV     A,@R0
006E 6440              XRL     A,#040H
0070 6003              JZ      $ + 5H
0072 020000      R     LJMP    ?C0076
                                           ; SOURCE LINE # 391
                                           ; SOURCE LINE # 394
0075 900000      R     MOV     DPTR,#UseChip
0078 EF                MOV     A,R7
0079 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 395
007A E4                CLR     A
007B F500        R     MOV     U_Data+03H,A
007D F500        R     MOV     U_Data+02H,A
007F F500        R     MOV     U_Data+01H,A
                                           ; SOURCE LINE # 396
                                           ; SOURCE LINE # 397
                                           ; SOURCE LINE # 398
                                           ; SOURCE LINE # 399
0081 120000      R     LCALL   L?0296
                                           ; SOURCE LINE # 401
0084 900000      R     MOV     DPTR,#rparameter_buffer
0087 E0                MOVX    A,@DPTR
0088 FF                MOV     R7,A
0089 B4AA0C            CJNE    A,#0AAH,?C0078
                                           ; SOURCE LINE # 402
                                           ; SOURCE LINE # 403
008C 850000      R     MOV     chip,i+01H
                                           ; SOURCE LINE # 404
008F 900000      R     MOV     DPTR,#UseChip
0092 E500        R     MOV     A,chip
0094 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 405
0095 020000      R     LJMP    ?C0076
0098         ?C0078:
                                           ; SOURCE LINE # 407
0098 EF                MOV     A,R7
0099 704C              JNZ     ?C0080
                                           ; SOURCE LINE # 408
                                           ; SOURCE LINE # 410
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 56  

                                           ; SOURCE LINE # 411
                                           ; SOURCE LINE # 412
                                           ; SOURCE LINE # 413
                                           ; SOURCE LINE # 414
009B 120000      R     LCALL   L?0295
009E         ?C0081:
                                           ; SOURCE LINE # 415
009E 900000      R     MOV     DPTR,#rparameter_buffer
00A1 E0                MOVX    A,@DPTR
00A2 7031              JNZ     ?C0082
                                           ; SOURCE LINE # 416
                                           ; SOURCE LINE # 418
                                           ; SOURCE LINE # 419
                                           ; SOURCE LINE # 420
                                           ; SOURCE LINE # 421
                                           ; SOURCE LINE # 422
00A4 120000      R     LCALL   L?0295
                                           ; SOURCE LINE # 423
00A7 E500        R     MOV     A,U_Data+01H
00A9 D3                SETB    C
00AA 9401              SUBB    A,#01H
00AC 40F0              JC      ?C0081
                                           ; SOURCE LINE # 424
                                           ; SOURCE LINE # 425
00AE E500        R     MOV     A,i+01H
00B0 2401              ADD     A,#01H
00B2 F500        R     MOV     i1+01H,A
00B4 E4                CLR     A
00B5 3500        R     ADDC    A,i
00B7 F500        R     MOV     i1,A
                                           ; SOURCE LINE # 426
00B9 C3                CLR     C
00BA E500        R     MOV     A,i1+01H
00BC 9406              SUBB    A,#06H
00BE E500        R     MOV     A,i1
00C0 6480              XRL     A,#080H
00C2 9480              SUBB    A,#080H
00C4 400A              JC      ?C0084
                                           ; SOURCE LINE # 427
                                           ; SOURCE LINE # 428
00C6 E500        R     MOV     A,chip
00C8 F4                CPL     A
00C9 7003              JNZ     $ + 5H
00CB 020000      R     LJMP    ?C0073
                                           ; SOURCE LINE # 429
00CE 8039              SJMP    findchip
                                           ; SOURCE LINE # 432
00D0         ?C0084:
                                           ; SOURCE LINE # 434
                                           ; SOURCE LINE # 435
00D0 850000      R     MOV     chip,i+01H
                                           ; SOURCE LINE # 436
00D3 8034              SJMP    findchip
                                           ; SOURCE LINE # 437
                                           ; SOURCE LINE # 438
                                           ; SOURCE LINE # 440
00D5         ?C0082:
                                           ; SOURCE LINE # 441
00D5 900000      R     MOV     DPTR,#rparameter_buffer
00D8 E0                MOVX    A,@DPTR
00D9 B4AA2D            CJNE    A,#0AAH,findchip
                                           ; SOURCE LINE # 442
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 57  

                                           ; SOURCE LINE # 443
00DC 850000      R     MOV     chip,i+01H
                                           ; SOURCE LINE # 444
00DF 900000      R     MOV     DPTR,#UseChip
00E2 E500        R     MOV     A,chip
00E4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 445
00E5 800C              SJMP    ?C0076
                                           ; SOURCE LINE # 447
                                           ; SOURCE LINE # 448
00E7         ?C0080:
                                           ; SOURCE LINE # 449
                                           ; SOURCE LINE # 451
00E7 E500        R     MOV     A,chip
00E9 B4FF1D            CJNE    A,#0FFH,findchip
                                           ; SOURCE LINE # 452
00EC 900000      R     MOV     DPTR,#UseChip
00EF E500        R     MOV     A,i+01H
00F1 F0                MOVX    @DPTR,A
00F2 22                RET     
                                           ; SOURCE LINE # 454
                                           ; SOURCE LINE # 455
                                           ; SOURCE LINE # 456
                                           ; SOURCE LINE # 457
                                           ; SOURCE LINE # 458
00F3         ?C0076:
00F3 0500        R     INC     i+01H
00F5 E500        R     MOV     A,i+01H
00F7 7002              JNZ     ?C0252
00F9 0500        R     INC     i
00FB         ?C0252:
00FB C3                CLR     C
00FC 9406              SUBB    A,#06H
00FE E500        R     MOV     A,i
0100 6480              XRL     A,#080H
0102 9480              SUBB    A,#080H
0104 5003              JNC     $ + 5H
0106 020000      R     LJMP    ?C0074
                                           ; SOURCE LINE # 459
0109         findchip:
                                           ; SOURCE LINE # 461
0109 900000      R     MOV     DPTR,#UseChip
010C E500        R     MOV     A,chip
010E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 462
010F E4                CLR     A
0110 F500        R     MOV     U_Data+03H,A
0112 F500        R     MOV     U_Data+02H,A
0114 F500        R     MOV     U_Data+01H,A
0116 F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 464
0118 900000      R     MOV     DPTR,#ADDR9_16
011B E500        R     MOV     A,U_Data+03H
011D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 465
011E 900000      R     MOV     DPTR,#ADDR17_24
0121 E500        R     MOV     A,U_Data+02H
0123 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 466
0124 900000      R     MOV     DPTR,#ADDR25
0127 E500        R     MOV     A,U_Data+02H
0129 F0                MOVX    @DPTR,A
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 58  

                                           ; SOURCE LINE # 467
012A 120000      R     LCALL   ReadOnePage_C
                                           ; SOURCE LINE # 469
012D E4                CLR     A
012E F500        R     MOV     i,A
0130 F500        R     MOV     i+01H,A
0132         ?C0093:
                                           ; SOURCE LINE # 470
                                           ; SOURCE LINE # 471
0132 E500        R     MOV     A,i+01H
0134 F4                CPL     A
0135 7004              JNZ     ?C0253
0137 E500        R     MOV     A,i
0139 640F              XRL     A,#0FH
013B         ?C0253:
013B 703F              JNZ     ?C0096
                                           ; SOURCE LINE # 472
                                           ; SOURCE LINE # 474
013D 7500FF      E     MOV     ?_sprintf?BYTE+03H,#0FFH
0140 750000      R     MOV     ?_sprintf?BYTE+04H,#HIGH ?SC_0
0143 750000      R     MOV     ?_sprintf?BYTE+05H,#LOW ?SC_0
0146 900000      R     MOV     DPTR,#UseChip
0149 E0                MOVX    A,@DPTR
014A 750000      E     MOV     ?_sprintf?BYTE+06H,#00H
014D F500        E     MOV     ?_sprintf?BYTE+07H,A
014F 900000      R     MOV     DPTR,#ADDR9_16
0152 E0                MOVX    A,@DPTR
0153 750000      E     MOV     ?_sprintf?BYTE+08H,#00H
0156 F500        E     MOV     ?_sprintf?BYTE+09H,A
0158 900000      R     MOV     DPTR,#ADDR17_24
015B E0                MOVX    A,@DPTR
015C 750000      E     MOV     ?_sprintf?BYTE+0AH,#00H
015F F500        E     MOV     ?_sprintf?BYTE+0BH,A
0161 900000      R     MOV     DPTR,#ADDR25
0164 E0                MOVX    A,@DPTR
0165 750000      E     MOV     ?_sprintf?BYTE+0CH,#00H
0168 F500        E     MOV     ?_sprintf?BYTE+0DH,A
016A 7B01              MOV     R3,#01H
016C 7A00        E     MOV     R2,#HIGH tmpBuf
016E 7900        E     MOV     R1,#LOW tmpBuf
0170 120000      E     LCALL   _sprintf
                                           ; SOURCE LINE # 475
0173 7B01              MOV     R3,#01H
0175 7A00        E     MOV     R2,#HIGH tmpBuf
0177 7900        E     MOV     R1,#LOW tmpBuf
0179 120000      E     LCALL   _putbuf
                                           ; SOURCE LINE # 479
017C         ?C0096:
                                           ; SOURCE LINE # 480
017C 900000      R     MOV     DPTR,#rparameter_buffer
017F E0                MOVX    A,@DPTR
0180 64AA              XRL     A,#0AAH
0182 704D              JNZ     ?C0097
                                           ; SOURCE LINE # 481
                                           ; SOURCE LINE # 482
0184 900000      R     MOV     DPTR,#ADDR9_16
0187 E0                MOVX    A,@DPTR
0188 F500        R     MOV     addr9_16,A
                                           ; SOURCE LINE # 483
018A 900000      R     MOV     DPTR,#ADDR17_24
018D E0                MOVX    A,@DPTR
018E F500        R     MOV     addr17_24,A
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 59  

                                           ; SOURCE LINE # 484
0190 900000      R     MOV     DPTR,#ADDR25
0193 E0                MOVX    A,@DPTR
0194 F500        R     MOV     addr25,A
                                           ; SOURCE LINE # 486
0196 E500        R     MOV     A,U_Data+03H
0198 2420              ADD     A,#020H
019A F500        R     MOV     U_Data+03H,A
019C E4                CLR     A
019D 3500        R     ADDC    A,U_Data+02H
019F F500        R     MOV     U_Data+02H,A
01A1 E4                CLR     A
01A2 3500        R     ADDC    A,U_Data+01H
01A4 F500        R     MOV     U_Data+01H,A
01A6 E4                CLR     A
01A7 3500        R     ADDC    A,U_Data
01A9 F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 487
01AB 900000      R     MOV     DPTR,#ADDR9_16
01AE E500        R     MOV     A,U_Data+03H
01B0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 488
01B1 E0                MOVX    A,@DPTR
01B2 7018              JNZ     ?C0098
                                           ; SOURCE LINE # 489
                                           ; SOURCE LINE # 490
01B4 900000      R     MOV     DPTR,#ADDR17_24
01B7 E0                MOVX    A,@DPTR
01B8 04                INC     A
01B9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 491
01BA E0                MOVX    A,@DPTR
01BB 700F              JNZ     ?C0098
                                           ; SOURCE LINE # 492
                                           ; SOURCE LINE # 493
01BD 900000      R     MOV     DPTR,#ADDR25
01C0 E0                MOVX    A,@DPTR
01C1 04                INC     A
01C2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 494
01C3 E0                MOVX    A,@DPTR
01C4 D3                SETB    C
01C5 9401              SUBB    A,#01H
01C7 4003              JC      $ + 5H
01C9 020000      R     LJMP    ?C0073
                                           ; SOURCE LINE # 495
                                           ; SOURCE LINE # 497
                                           ; SOURCE LINE # 498
                                           ; SOURCE LINE # 499
01CC         ?C0098:
                                           ; SOURCE LINE # 500
01CC 120000      R     LCALL   ReadOnePage_C
                                           ; SOURCE LINE # 501
01CF 8057              SJMP    ?C0095
01D1         ?C0097:
                                           ; SOURCE LINE # 502
01D1 900000      R     MOV     DPTR,#rparameter_buffer
01D4 E0                MOVX    A,@DPTR
01D5 7065              JNZ     findaddress
                                           ; SOURCE LINE # 503
                                           ; SOURCE LINE # 504
01D7 900000      R     MOV     DPTR,#ADDR9_16
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 60  

01DA E0                MOVX    A,@DPTR
01DB F500        R     MOV     addr9_16,A
                                           ; SOURCE LINE # 505
01DD 900000      R     MOV     DPTR,#ADDR17_24
01E0 E0                MOVX    A,@DPTR
01E1 F500        R     MOV     addr17_24,A
                                           ; SOURCE LINE # 506
01E3 900000      R     MOV     DPTR,#ADDR25
01E6 E0                MOVX    A,@DPTR
01E7 F500        R     MOV     addr25,A
                                           ; SOURCE LINE # 508
01E9 E500        R     MOV     A,U_Data+03H
01EB 2420              ADD     A,#020H
01ED F500        R     MOV     U_Data+03H,A
01EF E4                CLR     A
01F0 3500        R     ADDC    A,U_Data+02H
01F2 F500        R     MOV     U_Data+02H,A
01F4 E4                CLR     A
01F5 3500        R     ADDC    A,U_Data+01H
01F7 F500        R     MOV     U_Data+01H,A
01F9 E4                CLR     A
01FA 3500        R     ADDC    A,U_Data
01FC F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 509
01FE 900000      R     MOV     DPTR,#ADDR9_16
0201 E500        R     MOV     A,U_Data+03H
0203 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 510
0204 E0                MOVX    A,@DPTR
0205 701E              JNZ     ?C0103
                                           ; SOURCE LINE # 511
                                           ; SOURCE LINE # 512
0207 900000      R     MOV     DPTR,#ADDR17_24
020A E0                MOVX    A,@DPTR
020B 04                INC     A
020C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 513
020D E0                MOVX    A,@DPTR
020E 7015              JNZ     ?C0103
                                           ; SOURCE LINE # 514
                                           ; SOURCE LINE # 515
0210 900000      R     MOV     DPTR,#ADDR25
0213 E0                MOVX    A,@DPTR
0214 04                INC     A
0215 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 516
0216 E0                MOVX    A,@DPTR
0217 D3                SETB    C
0218 9401              SUBB    A,#01H
021A 4009              JC      ?C0103
                                           ; SOURCE LINE # 517
                                           ; SOURCE LINE # 518
021C E4                CLR     A
021D F500        R     MOV     addr9_16,A
                                           ; SOURCE LINE # 519
021F F500        R     MOV     addr17_24,A
                                           ; SOURCE LINE # 520
0221 F500        R     MOV     addr25,A
                                           ; SOURCE LINE # 521
0223 8017              SJMP    findaddress
                                           ; SOURCE LINE # 522
                                           ; SOURCE LINE # 523
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 61  

                                           ; SOURCE LINE # 524
0225         ?C0103:
                                           ; SOURCE LINE # 526
0225 120000      R     LCALL   ReadOnePage_C
                                           ; SOURCE LINE # 527
                                           ; SOURCE LINE # 530
                                           ; SOURCE LINE # 531
                                           ; SOURCE LINE # 532
                                           ; SOURCE LINE # 533
0228         ?C0095:
0228 0500        R     INC     i+01H
022A E500        R     MOV     A,i+01H
022C 7002              JNZ     ?C0254
022E 0500        R     INC     i
0230         ?C0254:
0230 C3                CLR     C
0231 E500        R     MOV     A,i
0233 6480              XRL     A,#080H
0235 9490              SUBB    A,#090H
0237 5003              JNC     $ + 5H
0239 020000      R     LJMP    ?C0093
                                           ; SOURCE LINE # 534
023C         findaddress:
                                           ; SOURCE LINE # 535
023C 900000      R     MOV     DPTR,#ADDR9_16
023F E500        R     MOV     A,addr9_16
0241 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 536
0242 900000      R     MOV     DPTR,#ADDR17_24
0245 E500        R     MOV     A,addr17_24
0247 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 537
0248 900000      R     MOV     DPTR,#ADDR25
024B E500        R     MOV     A,addr25
024D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 539
024E 7500FF      E     MOV     ?_sprintf?BYTE+03H,#0FFH
0251 750000      R     MOV     ?_sprintf?BYTE+04H,#HIGH ?SC_61
0254 750000      R     MOV     ?_sprintf?BYTE+05H,#LOW ?SC_61
0257 900000      R     MOV     DPTR,#UseChip
025A E0                MOVX    A,@DPTR
025B 750000      E     MOV     ?_sprintf?BYTE+06H,#00H
025E F500        E     MOV     ?_sprintf?BYTE+07H,A
0260 900000      R     MOV     DPTR,#ADDR9_16
0263 E0                MOVX    A,@DPTR
0264 750000      E     MOV     ?_sprintf?BYTE+08H,#00H
0267 F500        E     MOV     ?_sprintf?BYTE+09H,A
0269 900000      R     MOV     DPTR,#ADDR17_24
026C E0                MOVX    A,@DPTR
026D 750000      E     MOV     ?_sprintf?BYTE+0AH,#00H
0270 F500        E     MOV     ?_sprintf?BYTE+0BH,A
0272 900000      R     MOV     DPTR,#ADDR25
0275 E0                MOVX    A,@DPTR
0276 750000      E     MOV     ?_sprintf?BYTE+0CH,#00H
0279 F500        E     MOV     ?_sprintf?BYTE+0DH,A
027B 7B01              MOV     R3,#01H
027D 7A00        E     MOV     R2,#HIGH tmpBuf
027F 7900        E     MOV     R1,#LOW tmpBuf
0281 120000      E     LCALL   _sprintf
                                           ; SOURCE LINE # 540
0284 7B01              MOV     R3,#01H
0286 7A00        E     MOV     R2,#HIGH tmpBuf
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 62  

0288 7900        E     MOV     R1,#LOW tmpBuf
028A 120000      E     LCALL   _putbuf
                                           ; SOURCE LINE # 542
028D 120000      R     LCALL   ReadOnePage
                                           ; SOURCE LINE # 544
0290 900000      R     MOV     DPTR,#rparameter_buffer+01H
0293 E0                MOVX    A,@DPTR
0294 900000      R     MOV     DPTR,#NowFileName
0297 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 545
0298 E0                MOVX    A,@DPTR
0299 04                INC     A
029A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 548
029B E0                MOVX    A,@DPTR
029C 900000      R     MOV     DPTR,#FileNumber
029F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 550
02A0 900000      R     MOV     DPTR,#rparameter_buffer+02H
02A3 E0                MOVX    A,@DPTR
02A4 FF                MOV     R7,A
02A5 900000      R     MOV     DPTR,#FileNumber
02A8 E0                MOVX    A,@DPTR
02A9 FE                MOV     R6,A
02AA 75F004            MOV     B,#04H
02AD A4                MUL     AB
02AE 2400        R     ADD     A,#LOW FileStart+0FFFCH
02B0 F582              MOV     DPL,A
02B2 E5F0              MOV     A,B
02B4 3400        R     ADDC    A,#HIGH FileStart+0FFFCH
02B6 F583              MOV     DPH,A
02B8 EF                MOV     A,R7
02B9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 551
02BA 900000      R     MOV     DPTR,#rparameter_buffer+03H
02BD E0                MOVX    A,@DPTR
02BE FF                MOV     R7,A
02BF 75F004            MOV     B,#04H
02C2 EE                MOV     A,R6
02C3 A4                MUL     AB
02C4 2400        R     ADD     A,#LOW FileStart+0FFFDH
02C6 F582              MOV     DPL,A
02C8 E5F0              MOV     A,B
02CA 3400        R     ADDC    A,#HIGH FileStart+0FFFDH
02CC F583              MOV     DPH,A
02CE EF                MOV     A,R7
02CF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 552
02D0 900000      R     MOV     DPTR,#rparameter_buffer+04H
02D3 E0                MOVX    A,@DPTR
02D4 FF                MOV     R7,A
02D5 75F004            MOV     B,#04H
02D8 EE                MOV     A,R6
02D9 A4                MUL     AB
02DA 2400        R     ADD     A,#LOW FileStart+0FFFEH
02DC F582              MOV     DPL,A
02DE E5F0              MOV     A,B
02E0 3400        R     ADDC    A,#HIGH FileStart+0FFFEH
02E2 F583              MOV     DPH,A
02E4 EF                MOV     A,R7
02E5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 553
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 63  

02E6 900000      R     MOV     DPTR,#rparameter_buffer+05H
02E9 E0                MOVX    A,@DPTR
02EA FF                MOV     R7,A
02EB 75F004            MOV     B,#04H
02EE EE                MOV     A,R6
02EF A4                MUL     AB
02F0 2400        R     ADD     A,#LOW FileStart+0FFFFH
02F2 F582              MOV     DPL,A
02F4 E5F0              MOV     A,B
02F6 3400        R     ADDC    A,#HIGH FileStart+0FFFFH
02F8 F583              MOV     DPH,A
02FA EF                MOV     A,R7
02FB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 554
02FC 900000      R     MOV     DPTR,#ADDR9_16
02FF E0                MOVX    A,@DPTR
0300 FF                MOV     R7,A
0301 F500        R     MOV     address9_16,A
                                           ; SOURCE LINE # 555
0303 900000      R     MOV     DPTR,#ADDR17_24
0306 E0                MOVX    A,@DPTR
0307 FE                MOV     R6,A
0308 F500        R     MOV     address17_24,A
                                           ; SOURCE LINE # 556
030A 900000      R     MOV     DPTR,#ADDR25
030D E0                MOVX    A,@DPTR
030E FD                MOV     R5,A
030F F500        R     MOV     address25,A
                                           ; SOURCE LINE # 558
0311 8F00        R     MOV     U_Data+03H,R7
                                           ; SOURCE LINE # 559
0313 8E00        R     MOV     U_Data+02H,R6
                                           ; SOURCE LINE # 560
0315 8D00        R     MOV     U_Data+01H,R5
                                           ; SOURCE LINE # 563
0317 E4                CLR     A
0318 F500        R     MOV     i2,A
031A         ?C0108:
                                           ; SOURCE LINE # 564
                                           ; SOURCE LINE # 565
                                           ; SOURCE LINE # 566
                                           ; SOURCE LINE # 567
                                           ; SOURCE LINE # 568
031A 120000      R     LCALL   L?0297
                                           ; SOURCE LINE # 569
031D 900000      R     MOV     DPTR,#rparameter_buffer
0320 E0                MOVX    A,@DPTR
0321 B4AA31            CJNE    A,#0AAH,?C0111
                                           ; SOURCE LINE # 570
                                           ; SOURCE LINE # 571
0324 900000      R     MOV     DPTR,#ADDR9_16
0327 E0                MOVX    A,@DPTR
0328 F500        R     MOV     addr9_16,A
                                           ; SOURCE LINE # 572
032A 900000      R     MOV     DPTR,#ADDR17_24
032D E0                MOVX    A,@DPTR
032E F500        R     MOV     addr17_24,A
                                           ; SOURCE LINE # 573
0330 900000      R     MOV     DPTR,#ADDR25
0333 E0                MOVX    A,@DPTR
0334 F500        R     MOV     addr25,A
                                           ; SOURCE LINE # 575
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 64  

0336 AF00        R     MOV     R7,U_Data+03H
0338 AE00        R     MOV     R6,U_Data+02H
033A AD00        R     MOV     R5,U_Data+01H
033C AC00        R     MOV     R4,U_Data
033E E4                CLR     A
033F FA                MOV     R2,A
0340 F9                MOV     R1,A
0341 F8                MOV     R0,A
0342 EF                MOV     A,R7
0343 2401              ADD     A,#01H
0345 F500        R     MOV     U_Data+03H,A
0347 EA                MOV     A,R2
0348 3E                ADDC    A,R6
0349 F500        R     MOV     U_Data+02H,A
034B E9                MOV     A,R1
034C 3D                ADDC    A,R5
034D F500        R     MOV     U_Data+01H,A
034F E8                MOV     A,R0
0350 3C                ADDC    A,R4
0351 F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 576
0353 8022              SJMP    ?C0110
0355         ?C0111:
                                           ; SOURCE LINE # 577
0355 900000      R     MOV     DPTR,#rparameter_buffer
0358 E0                MOVX    A,@DPTR
0359 7025              JNZ     ?C0109
                                           ; SOURCE LINE # 578
                                           ; SOURCE LINE # 579
035B AF00        R     MOV     R7,U_Data+03H
035D AE00        R     MOV     R6,U_Data+02H
035F AD00        R     MOV     R5,U_Data+01H
0361 AC00        R     MOV     R4,U_Data
0363 FA                MOV     R2,A
0364 F9                MOV     R1,A
0365 F8                MOV     R0,A
0366 EF                MOV     A,R7
0367 2401              ADD     A,#01H
0369 F500        R     MOV     U_Data+03H,A
036B EA                MOV     A,R2
036C 3E                ADDC    A,R6
036D F500        R     MOV     U_Data+02H,A
036F E9                MOV     A,R1
0370 3D                ADDC    A,R5
0371 F500        R     MOV     U_Data+01H,A
0373 E8                MOV     A,R0
0374 3C                ADDC    A,R4
0375 F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 580
                                           ; SOURCE LINE # 582
                                           ; SOURCE LINE # 583
                                           ; SOURCE LINE # 584
                                           ; SOURCE LINE # 585
0377         ?C0110:
0377 0500        R     INC     i2
0379 E500        R     MOV     A,i2
037B C3                CLR     C
037C 9420              SUBB    A,#020H
037E 409A              JC      ?C0108
0380         ?C0109:
                                           ; SOURCE LINE # 586
0380 900000      R     MOV     DPTR,#ADDR9_16
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 65  

0383 E500        R     MOV     A,addr9_16
0385 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 587
0386 900000      R     MOV     DPTR,#ADDR17_24
0389 E500        R     MOV     A,addr17_24
038B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 588
038C 900000      R     MOV     DPTR,#ADDR25
038F E500        R     MOV     A,addr25
0391 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 589
0392 120000      R     LCALL   ReadOnePage_C
                                           ; SOURCE LINE # 591
0395 900000      R     MOV     DPTR,#rparameter_buffer+06H
0398 E0                MOVX    A,@DPTR
0399 FF                MOV     R7,A
039A 900000      R     MOV     DPTR,#FileNumber
039D E0                MOVX    A,@DPTR
039E FE                MOV     R6,A
039F 75F004            MOV     B,#04H
03A2 A4                MUL     AB
03A3 2400        R     ADD     A,#LOW FileSize+0FFFCH
03A5 F582              MOV     DPL,A
03A7 E5F0              MOV     A,B
03A9 3400        R     ADDC    A,#HIGH FileSize+0FFFCH
03AB F583              MOV     DPH,A
03AD EF                MOV     A,R7
03AE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 592
03AF 900000      R     MOV     DPTR,#rparameter_buffer+07H
03B2 E0                MOVX    A,@DPTR
03B3 FF                MOV     R7,A
03B4 75F004            MOV     B,#04H
03B7 EE                MOV     A,R6
03B8 A4                MUL     AB
03B9 2400        R     ADD     A,#LOW FileSize+0FFFDH
03BB F582              MOV     DPL,A
03BD E5F0              MOV     A,B
03BF 3400        R     ADDC    A,#HIGH FileSize+0FFFDH
03C1 F583              MOV     DPH,A
03C3 EF                MOV     A,R7
03C4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 593
03C5 900000      R     MOV     DPTR,#rparameter_buffer+08H
03C8 E0                MOVX    A,@DPTR
03C9 FF                MOV     R7,A
03CA 75F004            MOV     B,#04H
03CD EE                MOV     A,R6
03CE A4                MUL     AB
03CF 2400        R     ADD     A,#LOW FileSize+0FFFEH
03D1 F582              MOV     DPL,A
03D3 E5F0              MOV     A,B
03D5 3400        R     ADDC    A,#HIGH FileSize+0FFFEH
03D7 F583              MOV     DPH,A
03D9 EF                MOV     A,R7
03DA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 594
03DB 900000      R     MOV     DPTR,#rparameter_buffer+09H
03DE E0                MOVX    A,@DPTR
03DF FF                MOV     R7,A
03E0 75F004            MOV     B,#04H
03E3 EE                MOV     A,R6
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 66  

03E4 A4                MUL     AB
03E5 2400        R     ADD     A,#LOW FileSize+0FFFFH
03E7 F582              MOV     DPL,A
03E9 E5F0              MOV     A,B
03EB 3400        R     ADDC    A,#HIGH FileSize+0FFFFH
03ED F583              MOV     DPH,A
03EF EF                MOV     A,R7
03F0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 597
03F1 900000      R     MOV     DPTR,#ADDR9_16
03F4 E500        R     MOV     A,address9_16
03F6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 598
03F7 900000      R     MOV     DPTR,#ADDR17_24
03FA E500        R     MOV     A,address17_24
03FC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 599
03FD 900000      R     MOV     DPTR,#ADDR25
0400 E500        R     MOV     A,address25
0402 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 600
0403 7F01              MOV     R7,#01H
0405 7E00              MOV     R6,#00H
0407 7D00              MOV     R5,#00H
0409 7C00              MOV     R4,#00H
040B 120000      R     LCALL   _FindNextBlock
                                           ; SOURCE LINE # 607
040E 7500FF      E     MOV     ?_sprintf?BYTE+03H,#0FFH
0411 750000      R     MOV     ?_sprintf?BYTE+04H,#HIGH ?SC_123
0414 750000      R     MOV     ?_sprintf?BYTE+05H,#LOW ?SC_123
0417 900000      R     MOV     DPTR,#FileNumber
041A E0                MOVX    A,@DPTR
041B FF                MOV     R7,A
041C 75F004            MOV     B,#04H
041F A4                MUL     AB
0420 2400        R     ADD     A,#LOW FileSize+0FFFCH
0422 F582              MOV     DPL,A
0424 E5F0              MOV     A,B
0426 3400        R     ADDC    A,#HIGH FileSize+0FFFCH
0428 F583              MOV     DPH,A
042A E0                MOVX    A,@DPTR
042B 750000      E     MOV     ?_sprintf?BYTE+06H,#00H
042E F500        E     MOV     ?_sprintf?BYTE+07H,A
0430 75F004            MOV     B,#04H
0433 EF                MOV     A,R7
0434 A4                MUL     AB
0435 2400        R     ADD     A,#LOW FileSize+0FFFDH
0437 F582              MOV     DPL,A
0439 E5F0              MOV     A,B
043B 3400        R     ADDC    A,#HIGH FileSize+0FFFDH
043D F583              MOV     DPH,A
043F E0                MOVX    A,@DPTR
0440 750000      E     MOV     ?_sprintf?BYTE+08H,#00H
0443 F500        E     MOV     ?_sprintf?BYTE+09H,A
0445 75F004            MOV     B,#04H
0448 EF                MOV     A,R7
0449 A4                MUL     AB
044A 2400        R     ADD     A,#LOW FileSize+0FFFEH
044C F582              MOV     DPL,A
044E E5F0              MOV     A,B
0450 3400        R     ADDC    A,#HIGH FileSize+0FFFEH
0452 F583              MOV     DPH,A
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 67  

0454 E0                MOVX    A,@DPTR
0455 750000      E     MOV     ?_sprintf?BYTE+0AH,#00H
0458 F500        E     MOV     ?_sprintf?BYTE+0BH,A
045A 75F004            MOV     B,#04H
045D EF                MOV     A,R7
045E A4                MUL     AB
045F 2400        R     ADD     A,#LOW FileSize+0FFFFH
0461 F582              MOV     DPL,A
0463 E5F0              MOV     A,B
0465 3400        R     ADDC    A,#HIGH FileSize+0FFFFH
0467 F583              MOV     DPH,A
0469 E0                MOVX    A,@DPTR
046A 750000      E     MOV     ?_sprintf?BYTE+0CH,#00H
046D F500        E     MOV     ?_sprintf?BYTE+0DH,A
046F 7B01              MOV     R3,#01H
0471 7A00        E     MOV     R2,#HIGH tmpBuf
0473 7900        E     MOV     R1,#LOW tmpBuf
0475 120000      E     LCALL   _sprintf
                                           ; SOURCE LINE # 608
0478 7B01              MOV     R3,#01H
047A 7A00        E     MOV     R2,#HIGH tmpBuf
047C 7900        E     MOV     R1,#LOW tmpBuf
047E 120000      E     LCALL   _putbuf
                                           ; SOURCE LINE # 611
0481         ?C0073:
0481 22                RET     
             ; FUNCTION FindEnd (END)

             ; FUNCTION FindFiles (BEGIN)
                                           ; SOURCE LINE # 613
                                           ; SOURCE LINE # 614
                                           ; SOURCE LINE # 615
0000 E4                CLR     A
0001 F500        R     MOV     i,A
0003 F500        R     MOV     i+01H,A
                                           ; SOURCE LINE # 616
0005 F500        R     MOV     j,A
                                           ; SOURCE LINE # 617
0007 F500        R     MOV     space9_16,A
                                           ; SOURCE LINE # 618
0009 F500        R     MOV     space17_24,A
                                           ; SOURCE LINE # 619
000B F500        R     MOV     space25,A
                                           ; SOURCE LINE # 620
000D 900000      E     MOV     DPTR,#FileSumCheck
0010 F0                MOVX    @DPTR,A
0011 A3                INC     DPTR
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 625
0013 120000      R     LCALL   FindEnd
                                           ; SOURCE LINE # 628
0016 900000      R     MOV     DPTR,#FileNumber
0019 E0                MOVX    A,@DPTR
001A 24FE              ADD     A,#0FEH
001C F500        R     MOV     i+01H,A
001E E4                CLR     A
001F 34FF              ADDC    A,#0FFH
0021 F500        R     MOV     i,A
0023         ?C0115:
0023 C3                CLR     C
0024 E500        R     MOV     A,i
0026 6480              XRL     A,#080H
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 68  

0028 9480              SUBB    A,#080H
002A 5003              JNC     $ + 5H
002C 020000      R     LJMP    ?C0125
                                           ; SOURCE LINE # 629
                                           ; SOURCE LINE # 630
002F E500        R     MOV     A,i+01H
0031 AE00        R     MOV     R6,i
0033 7802              MOV     R0,#02H
0035         ?C0255:
0035 C3                CLR     C
0036 33                RLC     A
0037 CE                XCH     A,R6
0038 33                RLC     A
0039 CE                XCH     A,R6
003A D8F9              DJNZ    R0,?C0255
003C FF                MOV     R7,A
003D 2400        R     ADD     A,#LOW FileStart+04H
003F F582              MOV     DPL,A
0041 7400        R     MOV     A,#HIGH FileStart+04H
0043 3E                ADDC    A,R6
0044 F583              MOV     DPH,A
0046 E0                MOVX    A,@DPTR
0047 900000      R     MOV     DPTR,#UseChip
004A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 631
004B 7400        R     MOV     A,#LOW FileStart+05H
004D 2F                ADD     A,R7
004E F582              MOV     DPL,A
0050 7400        R     MOV     A,#HIGH FileStart+05H
0052 3E                ADDC    A,R6
0053 F583              MOV     DPH,A
0055 E0                MOVX    A,@DPTR
0056 900000      R     MOV     DPTR,#ADDR9_16
0059 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 632
005A 7400        R     MOV     A,#LOW FileStart+06H
005C 2F                ADD     A,R7
005D F582              MOV     DPL,A
005F 7400        R     MOV     A,#HIGH FileStart+06H
0061 3E                ADDC    A,R6
0062 F583              MOV     DPH,A
0064 E0                MOVX    A,@DPTR
0065 900000      R     MOV     DPTR,#ADDR17_24
0068 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 633
0069 E500        R     MOV     A,i+01H
006B AE00        R     MOV     R6,i
006D 7802              MOV     R0,#02H
006F         ?C0256:
006F C3                CLR     C
0070 33                RLC     A
0071 CE                XCH     A,R6
0072 33                RLC     A
0073 CE                XCH     A,R6
0074 D8F9              DJNZ    R0,?C0256
0076 2400        R     ADD     A,#LOW FileStart+07H
0078 F582              MOV     DPL,A
007A 7400        R     MOV     A,#HIGH FileStart+07H
007C 3E                ADDC    A,R6
007D F583              MOV     DPH,A
007F E0                MOVX    A,@DPTR
0080 900000      R     MOV     DPTR,#ADDR25
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 69  

0083 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 635
0084 120000      R     LCALL   FindPrvBlock
                                           ; SOURCE LINE # 636
0087 120000      R     LCALL   ReadOnePage
                                           ; SOURCE LINE # 637
008A 900000      R     MOV     DPTR,#rparameter_buffer+02H
008D E0                MOVX    A,@DPTR
008E FD                MOV     R5,A
008F E500        R     MOV     A,i+01H
0091 AE00        R     MOV     R6,i
0093 7802              MOV     R0,#02H
0095         ?C0257:
0095 C3                CLR     C
0096 33                RLC     A
0097 CE                XCH     A,R6
0098 33                RLC     A
0099 CE                XCH     A,R6
009A D8F9              DJNZ    R0,?C0257
009C FF                MOV     R7,A
009D 2400        R     ADD     A,#LOW FileStart
009F F582              MOV     DPL,A
00A1 7400        R     MOV     A,#HIGH FileStart
00A3 3E                ADDC    A,R6
00A4 F583              MOV     DPH,A
00A6 ED                MOV     A,R5
00A7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 638
00A8 900000      E     MOV     DPTR,#FileSumCheck+01H
00AB E0                MOVX    A,@DPTR
00AC 2D                ADD     A,R5
00AD F0                MOVX    @DPTR,A
00AE 900000      E     MOV     DPTR,#FileSumCheck
00B1 E0                MOVX    A,@DPTR
00B2 3400              ADDC    A,#00H
00B4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 639
00B5 900000      R     MOV     DPTR,#rparameter_buffer+03H
00B8 E0                MOVX    A,@DPTR
00B9 FD                MOV     R5,A
00BA 7400        R     MOV     A,#LOW FileStart+01H
00BC 2F                ADD     A,R7
00BD F582              MOV     DPL,A
00BF 7400        R     MOV     A,#HIGH FileStart+01H
00C1 3E                ADDC    A,R6
00C2 F583              MOV     DPH,A
00C4 ED                MOV     A,R5
00C5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 640
00C6 ED                MOV     A,R5
00C7 FF                MOV     R7,A
00C8 900000      E     MOV     DPTR,#FileSumCheck+01H
00CB E0                MOVX    A,@DPTR
00CC 2F                ADD     A,R7
00CD F0                MOVX    @DPTR,A
00CE 900000      E     MOV     DPTR,#FileSumCheck
00D1 E0                MOVX    A,@DPTR
00D2 3400              ADDC    A,#00H
00D4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 641
00D5 900000      R     MOV     DPTR,#rparameter_buffer+04H
00D8 E0                MOVX    A,@DPTR
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 70  

00D9 FD                MOV     R5,A
00DA E500        R     MOV     A,i+01H
00DC AE00        R     MOV     R6,i
00DE 7802              MOV     R0,#02H
00E0         ?C0258:
00E0 C3                CLR     C
00E1 33                RLC     A
00E2 CE                XCH     A,R6
00E3 33                RLC     A
00E4 CE                XCH     A,R6
00E5 D8F9              DJNZ    R0,?C0258
00E7 FF                MOV     R7,A
00E8 2400        R     ADD     A,#LOW FileStart+02H
00EA F582              MOV     DPL,A
00EC 7400        R     MOV     A,#HIGH FileStart+02H
00EE 3E                ADDC    A,R6
00EF F583              MOV     DPH,A
00F1 ED                MOV     A,R5
00F2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 642
00F3 900000      E     MOV     DPTR,#FileSumCheck+01H
00F6 E0                MOVX    A,@DPTR
00F7 2D                ADD     A,R5
00F8 F0                MOVX    @DPTR,A
00F9 900000      E     MOV     DPTR,#FileSumCheck
00FC E0                MOVX    A,@DPTR
00FD 3400              ADDC    A,#00H
00FF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 643
0100 900000      R     MOV     DPTR,#rparameter_buffer+05H
0103 E0                MOVX    A,@DPTR
0104 FD                MOV     R5,A
0105 7400        R     MOV     A,#LOW FileStart+03H
0107 2F                ADD     A,R7
0108 F582              MOV     DPL,A
010A 7400        R     MOV     A,#HIGH FileStart+03H
010C 3E                ADDC    A,R6
010D F583              MOV     DPH,A
010F ED                MOV     A,R5
0110 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 644
0111 ED                MOV     A,R5
0112 FF                MOV     R7,A
0113 900000      E     MOV     DPTR,#FileSumCheck+01H
0116 E0                MOVX    A,@DPTR
0117 2F                ADD     A,R7
0118 F0                MOVX    @DPTR,A
0119 900000      E     MOV     DPTR,#FileSumCheck
011C E0                MOVX    A,@DPTR
011D 3400              ADDC    A,#00H
011F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 647
0120 900000      R     MOV     DPTR,#ADDR9_16
0123 E0                MOVX    A,@DPTR
0124 F500        R     MOV     U_Data+03H,A
                                           ; SOURCE LINE # 648
0126 900000      R     MOV     DPTR,#ADDR17_24
0129 E0                MOVX    A,@DPTR
012A F500        R     MOV     U_Data+02H,A
                                           ; SOURCE LINE # 649
012C 900000      R     MOV     DPTR,#ADDR25
012F E0                MOVX    A,@DPTR
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 71  

0130 F500        R     MOV     U_Data+01H,A
                                           ; SOURCE LINE # 652
0132 E4                CLR     A
0133 F500        R     MOV     j,A
0135         ?C0118:
                                           ; SOURCE LINE # 653
                                           ; SOURCE LINE # 654
                                           ; SOURCE LINE # 655
                                           ; SOURCE LINE # 656
                                           ; SOURCE LINE # 657
0135 120000      R     LCALL   L?0297
                                           ; SOURCE LINE # 658
0138 900000      R     MOV     DPTR,#rparameter_buffer
013B E0                MOVX    A,@DPTR
013C B4AA31            CJNE    A,#0AAH,?C0121
                                           ; SOURCE LINE # 659
                                           ; SOURCE LINE # 660
013F 900000      R     MOV     DPTR,#ADDR9_16
0142 E0                MOVX    A,@DPTR
0143 F500        R     MOV     space9_16,A
                                           ; SOURCE LINE # 661
0145 900000      R     MOV     DPTR,#ADDR17_24
0148 E0                MOVX    A,@DPTR
0149 F500        R     MOV     space17_24,A
                                           ; SOURCE LINE # 662
014B 900000      R     MOV     DPTR,#ADDR25
014E E0                MOVX    A,@DPTR
014F F500        R     MOV     space25,A
                                           ; SOURCE LINE # 664
0151 AF00        R     MOV     R7,U_Data+03H
0153 AE00        R     MOV     R6,U_Data+02H
0155 AD00        R     MOV     R5,U_Data+01H
0157 AC00        R     MOV     R4,U_Data
0159 E4                CLR     A
015A FA                MOV     R2,A
015B F9                MOV     R1,A
015C F8                MOV     R0,A
015D EF                MOV     A,R7
015E 2401              ADD     A,#01H
0160 F500        R     MOV     U_Data+03H,A
0162 EA                MOV     A,R2
0163 3E                ADDC    A,R6
0164 F500        R     MOV     U_Data+02H,A
0166 E9                MOV     A,R1
0167 3D                ADDC    A,R5
0168 F500        R     MOV     U_Data+01H,A
016A E8                MOV     A,R0
016B 3C                ADDC    A,R4
016C F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 665
016E 8022              SJMP    ?C0120
0170         ?C0121:
                                           ; SOURCE LINE # 666
0170 900000      R     MOV     DPTR,#rparameter_buffer
0173 E0                MOVX    A,@DPTR
0174 7025              JNZ     ?C0119
                                           ; SOURCE LINE # 667
                                           ; SOURCE LINE # 668
0176 AF00        R     MOV     R7,U_Data+03H
0178 AE00        R     MOV     R6,U_Data+02H
017A AD00        R     MOV     R5,U_Data+01H
017C AC00        R     MOV     R4,U_Data
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 72  

017E FA                MOV     R2,A
017F F9                MOV     R1,A
0180 F8                MOV     R0,A
0181 EF                MOV     A,R7
0182 2401              ADD     A,#01H
0184 F500        R     MOV     U_Data+03H,A
0186 EA                MOV     A,R2
0187 3E                ADDC    A,R6
0188 F500        R     MOV     U_Data+02H,A
018A E9                MOV     A,R1
018B 3D                ADDC    A,R5
018C F500        R     MOV     U_Data+01H,A
018E E8                MOV     A,R0
018F 3C                ADDC    A,R4
0190 F500        R     MOV     U_Data,A
                                           ; SOURCE LINE # 669
                                           ; SOURCE LINE # 671
                                           ; SOURCE LINE # 672
                                           ; SOURCE LINE # 673
                                           ; SOURCE LINE # 674
0192         ?C0120:
0192 0500        R     INC     j
0194 E500        R     MOV     A,j
0196 C3                CLR     C
0197 9420              SUBB    A,#020H
0199 409A              JC      ?C0118
019B         ?C0119:
                                           ; SOURCE LINE # 675
019B 900000      R     MOV     DPTR,#ADDR9_16
019E E500        R     MOV     A,space9_16
01A0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 676
01A1 900000      R     MOV     DPTR,#ADDR17_24
01A4 E500        R     MOV     A,space17_24
01A6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 677
01A7 900000      R     MOV     DPTR,#ADDR25
01AA E500        R     MOV     A,space25
01AC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 678
01AD 120000      R     LCALL   ReadOnePage_C
                                           ; SOURCE LINE # 680
01B0 900000      R     MOV     DPTR,#rparameter_buffer+06H
01B3 E0                MOVX    A,@DPTR
01B4 FD                MOV     R5,A
01B5 E500        R     MOV     A,i+01H
01B7 AE00        R     MOV     R6,i
01B9 7802              MOV     R0,#02H
01BB         ?C0259:
01BB C3                CLR     C
01BC 33                RLC     A
01BD CE                XCH     A,R6
01BE 33                RLC     A
01BF CE                XCH     A,R6
01C0 D8F9              DJNZ    R0,?C0259
01C2 FF                MOV     R7,A
01C3 2400        R     ADD     A,#LOW FileSize
01C5 F582              MOV     DPL,A
01C7 7400        R     MOV     A,#HIGH FileSize
01C9 3E                ADDC    A,R6
01CA F583              MOV     DPH,A
01CC ED                MOV     A,R5
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 73  

01CD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 681
01CE 900000      E     MOV     DPTR,#FileSumCheck+01H
01D1 E0                MOVX    A,@DPTR
01D2 2D                ADD     A,R5
01D3 F0                MOVX    @DPTR,A
01D4 900000      E     MOV     DPTR,#FileSumCheck
01D7 E0                MOVX    A,@DPTR
01D8 3400              ADDC    A,#00H
01DA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 682
01DB 900000      R     MOV     DPTR,#rparameter_buffer+07H
01DE E0                MOVX    A,@DPTR
01DF FD                MOV     R5,A
01E0 7400        R     MOV     A,#LOW FileSize+01H
01E2 2F                ADD     A,R7
01E3 F582              MOV     DPL,A
01E5 7400        R     MOV     A,#HIGH FileSize+01H
01E7 3E                ADDC    A,R6
01E8 F583              MOV     DPH,A
01EA ED                MOV     A,R5
01EB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 683
01EC ED                MOV     A,R5
01ED FF                MOV     R7,A
01EE 900000      E     MOV     DPTR,#FileSumCheck+01H
01F1 E0                MOVX    A,@DPTR
01F2 2F                ADD     A,R7
01F3 F0                MOVX    @DPTR,A
01F4 900000      E     MOV     DPTR,#FileSumCheck
01F7 E0                MOVX    A,@DPTR
01F8 3400              ADDC    A,#00H
01FA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 684
01FB 900000      R     MOV     DPTR,#rparameter_buffer+08H
01FE E0                MOVX    A,@DPTR
01FF FD                MOV     R5,A
0200 E500        R     MOV     A,i+01H
0202 AE00        R     MOV     R6,i
0204 7802              MOV     R0,#02H
0206         ?C0260:
0206 C3                CLR     C
0207 33                RLC     A
0208 CE                XCH     A,R6
0209 33                RLC     A
020A CE                XCH     A,R6
020B D8F9              DJNZ    R0,?C0260
020D FF                MOV     R7,A
020E 2400        R     ADD     A,#LOW FileSize+02H
0210 F582              MOV     DPL,A
0212 7400        R     MOV     A,#HIGH FileSize+02H
0214 3E                ADDC    A,R6
0215 F583              MOV     DPH,A
0217 ED                MOV     A,R5
0218 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 685
0219 900000      E     MOV     DPTR,#FileSumCheck+01H
021C E0                MOVX    A,@DPTR
021D 2D                ADD     A,R5
021E F0                MOVX    @DPTR,A
021F 900000      E     MOV     DPTR,#FileSumCheck
0222 E0                MOVX    A,@DPTR
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 74  

0223 3400              ADDC    A,#00H
0225 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 686
0226 900000      R     MOV     DPTR,#rparameter_buffer+09H
0229 E0                MOVX    A,@DPTR
022A FD                MOV     R5,A
022B 7400        R     MOV     A,#LOW FileSize+03H
022D 2F                ADD     A,R7
022E F582              MOV     DPL,A
0230 7400        R     MOV     A,#HIGH FileSize+03H
0232 3E                ADDC    A,R6
0233 F583              MOV     DPH,A
0235 ED                MOV     A,R5
0236 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 687
0237 ED                MOV     A,R5
0238 FF                MOV     R7,A
0239 900000      E     MOV     DPTR,#FileSumCheck+01H
023C E0                MOVX    A,@DPTR
023D 2F                ADD     A,R7
023E F0                MOVX    @DPTR,A
023F 900000      E     MOV     DPTR,#FileSumCheck
0242 E0                MOVX    A,@DPTR
0243 3400              ADDC    A,#00H
0245 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 689
0246 E500        R     MOV     A,i+01H
0248 1500        R     DEC     i+01H
024A 7002              JNZ     ?C0261
024C 1500        R     DEC     i
024E         ?C0261:
024E 020000      R     LJMP    ?C0115
                                           ; SOURCE LINE # 690
0251         ?C0125:
0251 22                RET     
             ; FUNCTION FindFiles (END)

             ; FUNCTION InitFlash (BEGIN)
                                           ; SOURCE LINE # 693
                                           ; SOURCE LINE # 694
                                           ; SOURCE LINE # 696
;---- Variable 'i' assigned to Register 'R6/R7' ----
0000 E4                CLR     A
0001 FF                MOV     R7,A
0002 FE                MOV     R6,A
0003         ?C0126:
                                           ; SOURCE LINE # 697
0003 7400        R     MOV     A,#LOW wdata_buffer
0005 2F                ADD     A,R7
0006 F582              MOV     DPL,A
0008 7400        R     MOV     A,#HIGH wdata_buffer
000A 3E                ADDC    A,R6
000B F583              MOV     DPH,A
000D E4                CLR     A
000E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 698
000F 7400        R     MOV     A,#LOW rdata_buffer
0011 2F                ADD     A,R7
0012 F582              MOV     DPL,A
0014 7400        R     MOV     A,#HIGH rdata_buffer
0016 3E                ADDC    A,R6
0017 F583              MOV     DPH,A
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 75  

0019 E4                CLR     A
001A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 699
001B 0F                INC     R7
001C BF0001            CJNE    R7,#00H,?C0262
001F 0E                INC     R6
0020         ?C0262:
0020 E4                CLR     A
0021 B507DF            CJNE    A,AR7,?C0126
0024 EE                MOV     A,R6
0025 B402DB            CJNE    A,#02H,?C0126
0028         ?C0127:
                                           ; SOURCE LINE # 701
0028 E4                CLR     A
0029 FE                MOV     R6,A
002A FF                MOV     R7,A
002B         ?C0129:
                                           ; SOURCE LINE # 702
002B 7400        R     MOV     A,#LOW wparameter_buffer
002D 2F                ADD     A,R7
002E F582              MOV     DPL,A
0030 E4                CLR     A
0031 3400        R     ADDC    A,#HIGH wparameter_buffer
0033 F583              MOV     DPH,A
0035 E4                CLR     A
0036 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 703
0037 7400        R     MOV     A,#LOW rparameter_buffer
0039 2F                ADD     A,R7
003A F582              MOV     DPL,A
003C E4                CLR     A
003D 3400        R     ADDC    A,#HIGH rparameter_buffer
003F F583              MOV     DPH,A
0041 E4                CLR     A
0042 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 704
0043 0F                INC     R7
0044 BF0001            CJNE    R7,#00H,?C0264
0047 0E                INC     R6
0048         ?C0264:
0048 EF                MOV     A,R7
0049 6410              XRL     A,#010H
004B 4E                ORL     A,R6
004C 70DD              JNZ     ?C0129
004E         ?C0130:
                                           ; SOURCE LINE # 706
004E E4                CLR     A
004F FE                MOV     R6,A
0050 FF                MOV     R7,A
0051         ?C0132:
                                           ; SOURCE LINE # 707
0051 7E06              MOV     R6,#06H
0053 7800        R     MOV     R0,#LOW FlashChip
0055 E4                CLR     A
0056         ?C0265:
0056 F6                MOV     @R0,A
0057 08                INC     R0
0058 DEFC              DJNZ    R6,?C0265
005A         ?C0133:
                                           ; SOURCE LINE # 708
005A E4                CLR     A
005B FE                MOV     R6,A
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 76  

005C FF                MOV     R7,A
005D         ?C0135:
                                           ; SOURCE LINE # 709
                                           ; SOURCE LINE # 710
005D 7E06              MOV     R6,#06H
005F 900000      R     MOV     DPTR,#bad
0062 E4                CLR     A
0063         ?C0266:
0063 F0                MOVX    @DPTR,A
0064 A3                INC     DPTR
0065 DEFC              DJNZ    R6,?C0266
                                           ; SOURCE LINE # 711
0067         ?C0136:
                                           ; SOURCE LINE # 713
0067 E4                CLR     A
0068 900000      R     MOV     DPTR,#FileNumber
006B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 714
006C 900000      R     MOV     DPTR,#NowFileName
006F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 716
0070 900000      R     MOV     DPTR,#ADDR9_16
0073 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 717
0074 900000      R     MOV     DPTR,#ADDR17_24
0077 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 718
0078 900000      R     MOV     DPTR,#ADDR25
007B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 719
007C 900000      R     MOV     DPTR,#UseChip
007F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 720
0080 900000      R     MOV     DPTR,#wChecknum
0083 F0                MOVX    @DPTR,A
0084 A3                INC     DPTR
0085 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 721
0086 900000      R     MOV     DPTR,#rChecknum
0089 F0                MOVX    @DPTR,A
008A A3                INC     DPTR
008B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 723
008C 900000      R     MOV     DPTR,#ErrorFlash
008F F0                MOVX    @DPTR,A
0090 A3                INC     DPTR
0091 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 724
0092 900000      E     MOV     DPTR,#ErrorBlock
0095 F0                MOVX    @DPTR,A
0096 A3                INC     DPTR
0097 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 725
0098 900000      E     MOV     DPTR,#FileSumCheck
009B F0                MOVX    @DPTR,A
009C A3                INC     DPTR
009D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 726
009E 900000      R     MOV     DPTR,#ckb
00A1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 728
00A2 22                RET     
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 77  

             ; FUNCTION InitFlash (END)

             ; FUNCTION FindFlash (BEGIN)
                                           ; SOURCE LINE # 731
                                           ; SOURCE LINE # 732
                                           ; SOURCE LINE # 733
;---- Variable 'i' assigned to Register 'R4/R5' ----
0000 E4                CLR     A
0001 FD                MOV     R5,A
0002 FC                MOV     R4,A
                                           ; SOURCE LINE # 734
0003 7590FF            MOV     P1,#0FFH
                                           ; SOURCE LINE # 735
0006 C2A3              CLR     P23
                                           ; SOURCE LINE # 736
0008 C2A2              CLR     P22
                                           ; SOURCE LINE # 737
000A C2A0              CLR     P20
                                           ; SOURCE LINE # 738
;---- Variable 'm' assigned to Register 'R2/R3' ----
000C 7B01              MOV     R3,#01H
000E FA                MOV     R2,A
                                           ; SOURCE LINE # 739
000F         ?C0139:
                                           ; SOURCE LINE # 740
                                           ; SOURCE LINE # 742
000F EB                MOV     A,R3
0010 F4                CPL     A
0011 F590              MOV     P1,A
                                           ; SOURCE LINE # 743
0013 D2A3              SETB    P23
                                           ; SOURCE LINE # 744
0015 758071            MOV     P0,#071H
                                           ; SOURCE LINE # 745
0018 C2A1              CLR     P21
                                           ; SOURCE LINE # 746
001A D2A1              SETB    P21
                                           ; SOURCE LINE # 747
001C 7580FF            MOV     P0,#0FFH
                                           ; SOURCE LINE # 748
001F C2A3              CLR     P23
                                           ; SOURCE LINE # 749
0021 C2A5              CLR     P25
                                           ; SOURCE LINE # 750
0023 7400        R     MOV     A,#LOW FlashChip
0025 2D                ADD     A,R5
0026 F8                MOV     R0,A
0027 A680              MOV     @R0,P0
                                           ; SOURCE LINE # 751
0029 D2A5              SETB    P25
                                           ; SOURCE LINE # 753
002B D2A3              SETB    P23
                                           ; SOURCE LINE # 754
002D 758090            MOV     P0,#090H
                                           ; SOURCE LINE # 755
0030 C2A1              CLR     P21
                                           ; SOURCE LINE # 756
0032 D2A1              SETB    P21
                                           ; SOURCE LINE # 757
0034 C2A3              CLR     P23
                                           ; SOURCE LINE # 758
0036 D2A2              SETB    P22
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 78  

                                           ; SOURCE LINE # 759
0038 E4                CLR     A
0039 F580              MOV     P0,A
                                           ; SOURCE LINE # 760
003B C2A1              CLR     P21
                                           ; SOURCE LINE # 761
003D D2A1              SETB    P21
                                           ; SOURCE LINE # 762
003F C2A2              CLR     P22
                                           ; SOURCE LINE # 763
0041 7580FF            MOV     P0,#0FFH
                                           ; SOURCE LINE # 764
0044 C2A5              CLR     P25
                                           ; SOURCE LINE # 765
0046 900000      R     MOV     DPTR,#ChipMark
0049 E580              MOV     A,P0
004B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 766
004C D2A5              SETB    P25
                                           ; SOURCE LINE # 767
004E EB                MOV     A,R3
004F 25E0              ADD     A,ACC
0051 FB                MOV     R3,A
0052 EA                MOV     A,R2
0053 33                RLC     A
0054 FA                MOV     R2,A
                                           ; SOURCE LINE # 768
0055 7590FF            MOV     P1,#0FFH
                                           ; SOURCE LINE # 769
0058 E0                MOVX    A,@DPTR
0059 64EC              XRL     A,#0ECH
005B 6006              JZ      ?C0141
                                           ; SOURCE LINE # 770
                                           ; SOURCE LINE # 771
005D 7400        R     MOV     A,#LOW FlashChip
005F 2D                ADD     A,R5
0060 F8                MOV     R0,A
0061 E4                CLR     A
0062 F6                MOV     @R0,A
                                           ; SOURCE LINE # 772
                                           ; SOURCE LINE # 773
                                           ; SOURCE LINE # 774
0063         ?C0141:
0063 0D                INC     R5
0064 BD0001            CJNE    R5,#00H,?C0267
0067 0C                INC     R4
0068         ?C0267:
0068 ED                MOV     A,R5
0069 6406              XRL     A,#06H
006B 4C                ORL     A,R4
006C 70A1              JNZ     ?C0139
                                           ; SOURCE LINE # 775
006E         ?C0143:
006E 22                RET     
             ; FUNCTION FindFlash (END)

             ; FUNCTION EraseFlash (BEGIN)
                                           ; SOURCE LINE # 778
                                           ; SOURCE LINE # 779
                                           ; SOURCE LINE # 781
0000 E4                CLR     A
0001 F500        R     MOV     i,A
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 79  

0003         ?C0144:
                                           ; SOURCE LINE # 782
                                           ; SOURCE LINE # 783
0003 7400        R     MOV     A,#LOW FlashChip
0005 2500        R     ADD     A,i
0007 F8                MOV     R0,A
0008 E6                MOV     A,@R0
0009 B44005            CJNE    A,#040H,?C0146
                                           ; SOURCE LINE # 784
000C AF00        R     MOV     R7,i
000E 120000      R     LCALL   _EraseOneFlash
                                           ; SOURCE LINE # 787
0011         ?C0146:
0011 0500        R     INC     i
0013 E500        R     MOV     A,i
0015 C3                CLR     C
0016 9406              SUBB    A,#06H
0018 40E9              JC      ?C0144
001A         ?C0145:
                                           ; SOURCE LINE # 789
001A E4                CLR     A
001B 900000      R     MOV     DPTR,#FileNumber
001E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 790
001F 22                RET     
             ; FUNCTION EraseFlash (END)

             ; FUNCTION WriteOnePage (BEGIN)
                                           ; SOURCE LINE # 792
                                           ; SOURCE LINE # 793
                                           ; SOURCE LINE # 795
;---- Variable 'm' assigned to Register 'R4/R5' ----
0000 7D01              MOV     R5,#01H
0002 7C00              MOV     R4,#00H
                                           ; SOURCE LINE # 797
0004 900000      R     MOV     DPTR,#UseChip
0007 E0                MOVX    A,@DPTR
0008 FF                MOV     R7,A
0009 C3                CLR     C
000A 9406              SUBB    A,#06H
000C 4003              JC      $ + 5H
000E 020000      R     LJMP    ?C0150
0011         ?C0149:
                                           ; SOURCE LINE # 805
0011 ED                MOV     A,R5
0012 AE04              MOV     R6,AR4
0014 A807              MOV     R0,AR7
0016 08                INC     R0
0017 8005              SJMP    ?C0269
0019         ?C0268:
0019 C3                CLR     C
001A 33                RLC     A
001B CE                XCH     A,R6
001C 33                RLC     A
001D CE                XCH     A,R6
001E         ?C0269:
001E D8F9              DJNZ    R0,?C0268
0020 FD                MOV     R5,A
0021 AC06              MOV     R4,AR6
                                           ; SOURCE LINE # 806
0023 D2A5              SETB    P25
                                           ; SOURCE LINE # 807
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 80  

0025 C2A2              CLR     P22
                                           ; SOURCE LINE # 808
0027 C2A3              CLR     P23
                                           ; SOURCE LINE # 809
0029 D2A0              SETB    P20
                                           ; SOURCE LINE # 810
002B D2A1              SETB    P21
                                           ; SOURCE LINE # 814
002D F4                CPL     A
002E F590              MOV     P1,A
                                           ; SOURCE LINE # 817
                                           ; SOURCE LINE # 818
0030         ?C0151:
0030 30A6FD            JNB     P26,?C0151
                                           ; SOURCE LINE # 820
0033 D2A3              SETB    P23
                                           ; SOURCE LINE # 821
0035 E4                CLR     A
0036 F580              MOV     P0,A
                                           ; SOURCE LINE # 822
0038 C2A1              CLR     P21
                                           ; SOURCE LINE # 823
003A D2A1              SETB    P21
                                           ; SOURCE LINE # 824
003C C2A3              CLR     P23
                                           ; SOURCE LINE # 826
003E D2A3              SETB    P23
                                           ; SOURCE LINE # 827
0040 758080            MOV     P0,#080H
                                           ; SOURCE LINE # 828
0043 C2A1              CLR     P21
                                           ; SOURCE LINE # 829
0045 D2A1              SETB    P21
                                           ; SOURCE LINE # 830
0047 C2A3              CLR     P23
                                           ; SOURCE LINE # 832
0049 D2A2              SETB    P22
                                           ; SOURCE LINE # 833
004B F580              MOV     P0,A
                                           ; SOURCE LINE # 834
004D C2A1              CLR     P21
                                           ; SOURCE LINE # 835
004F D2A1              SETB    P21
                                           ; SOURCE LINE # 836
0051 900000      R     MOV     DPTR,#ADDR9_16
0054 E0                MOVX    A,@DPTR
0055 F580              MOV     P0,A
                                           ; SOURCE LINE # 837
0057 C2A1              CLR     P21
                                           ; SOURCE LINE # 838
0059 D2A1              SETB    P21
                                           ; SOURCE LINE # 839
005B 900000      R     MOV     DPTR,#ADDR17_24
005E E0                MOVX    A,@DPTR
005F F580              MOV     P0,A
                                           ; SOURCE LINE # 840
0061 C2A1              CLR     P21
                                           ; SOURCE LINE # 841
0063 D2A1              SETB    P21
                                           ; SOURCE LINE # 842
0065 900000      R     MOV     DPTR,#ADDR25
0068 E0                MOVX    A,@DPTR
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 81  

0069 F580              MOV     P0,A
                                           ; SOURCE LINE # 843
006B C2A1              CLR     P21
                                           ; SOURCE LINE # 844
006D D2A1              SETB    P21
                                           ; SOURCE LINE # 845
006F C2A2              CLR     P22
                                           ; SOURCE LINE # 848
                                           ; SOURCE LINE # 849
0071         ?C0154:
0071 30A6FD            JNB     P26,?C0154
                                           ; SOURCE LINE # 851
;---- Variable 'i' assigned to Register 'R6/R7' ----
0074 E4                CLR     A
0075 FF                MOV     R7,A
0076 FE                MOV     R6,A
0077         ?C0157:
                                           ; SOURCE LINE # 852
                                           ; SOURCE LINE # 853
0077 7400        R     MOV     A,#LOW wdata_buffer
0079 2F                ADD     A,R7
007A F582              MOV     DPL,A
007C 7400        R     MOV     A,#HIGH wdata_buffer
007E 3E                ADDC    A,R6
007F F583              MOV     DPH,A
0081 E0                MOVX    A,@DPTR
0082 F580              MOV     P0,A
                                           ; SOURCE LINE # 854
0084 C2A1              CLR     P21
                                           ; SOURCE LINE # 855
0086 D2A1              SETB    P21
                                           ; SOURCE LINE # 856
0088 0F                INC     R7
0089 BF0001            CJNE    R7,#00H,?C0270
008C 0E                INC     R6
008D         ?C0270:
008D E4                CLR     A
008E B507E6            CJNE    A,AR7,?C0157
0091 EE                MOV     A,R6
0092 B402E2            CJNE    A,#02H,?C0157
0095         ?C0158:
                                           ; SOURCE LINE # 857
;---- Variable 'j' assigned to Register 'R6/R7' ----
0095 E4                CLR     A
0096 FF                MOV     R7,A
0097 FE                MOV     R6,A
0098         ?C0160:
                                           ; SOURCE LINE # 858
                                           ; SOURCE LINE # 859
0098 7400        R     MOV     A,#LOW wparameter_buffer
009A 2F                ADD     A,R7
009B F582              MOV     DPL,A
009D E4                CLR     A
009E 3400        R     ADDC    A,#HIGH wparameter_buffer
00A0 F583              MOV     DPH,A
00A2 E0                MOVX    A,@DPTR
00A3 F580              MOV     P0,A
                                           ; SOURCE LINE # 860
00A5 C2A1              CLR     P21
                                           ; SOURCE LINE # 861
00A7 D2A1              SETB    P21
                                           ; SOURCE LINE # 862
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 82  

00A9 0F                INC     R7
00AA BF0001            CJNE    R7,#00H,?C0272
00AD 0E                INC     R6
00AE         ?C0272:
00AE EF                MOV     A,R7
00AF 6410              XRL     A,#010H
00B1 4E                ORL     A,R6
00B2 70E4              JNZ     ?C0160
00B4         ?C0161:
                                           ; SOURCE LINE # 863
00B4 D2A3              SETB    P23
                                           ; SOURCE LINE # 864
00B6 758010            MOV     P0,#010H
                                           ; SOURCE LINE # 865
00B9 C2A1              CLR     P21
                                           ; SOURCE LINE # 866
00BB D2A1              SETB    P21
                                           ; SOURCE LINE # 867
00BD C2A3              CLR     P23
                                           ; SOURCE LINE # 869
                                           ; SOURCE LINE # 870
00BF         ?C0163:
00BF 30A6FD            JNB     P26,?C0163
                                           ; SOURCE LINE # 872
00C2 D2A3              SETB    P23
                                           ; SOURCE LINE # 873
00C4 758070            MOV     P0,#070H
                                           ; SOURCE LINE # 875
00C7 C2A1              CLR     P21
                                           ; SOURCE LINE # 876
00C9 D2A1              SETB    P21
                                           ; SOURCE LINE # 877
00CB C2A3              CLR     P23
                                           ; SOURCE LINE # 879
00CD 7580FF            MOV     P0,#0FFH
                                           ; SOURCE LINE # 880
00D0 C2A5              CLR     P25
                                           ; SOURCE LINE # 881
00D2 858000      R     MOV     Statusw,P0
                                           ; SOURCE LINE # 882
00D5 D2A5              SETB    P25
                                           ; SOURCE LINE # 883
00D7 7590FF            MOV     P1,#0FFH
                                           ; SOURCE LINE # 884
00DA C2A0              CLR     P20
                                           ; SOURCE LINE # 886
00DC         ?C0150:
00DC 22                RET     
             ; FUNCTION WriteOnePage (END)

             ; FUNCTION ReadOnePage (BEGIN)
                                           ; SOURCE LINE # 888
                                           ; SOURCE LINE # 889
                                           ; SOURCE LINE # 890
;---- Variable 'm' assigned to Register 'R4/R5' ----
0000 7D01              MOV     R5,#01H
0002 7C00              MOV     R4,#00H
                                           ; SOURCE LINE # 892
0004 900000      R     MOV     DPTR,#UseChip
0007 E0                MOVX    A,@DPTR
0008 FF                MOV     R7,A
0009 ED                MOV     A,R5
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 83  

000A 7E00              MOV     R6,#00H
000C A807              MOV     R0,AR7
000E 08                INC     R0
000F 8005              SJMP    ?C0274
0011         ?C0273:
0011 C3                CLR     C
0012 33                RLC     A
0013 CE                XCH     A,R6
0014 33                RLC     A
0015 CE                XCH     A,R6
0016         ?C0274:
0016 D8F9              DJNZ    R0,?C0273
0018 FD                MOV     R5,A
0019 AC06              MOV     R4,AR6
                                           ; SOURCE LINE # 894
001B D2A5              SETB    P25
                                           ; SOURCE LINE # 895
001D C2A2              CLR     P22
                                           ; SOURCE LINE # 896
001F C2A3              CLR     P23
                                           ; SOURCE LINE # 897
0021 C2A0              CLR     P20
                                           ; SOURCE LINE # 898
0023 D2A1              SETB    P21
                                           ; SOURCE LINE # 902
0025 F4                CPL     A
0026 F590              MOV     P1,A
                                           ; SOURCE LINE # 905
0028 D2A3              SETB    P23
                                           ; SOURCE LINE # 906
002A E4                CLR     A
002B F580              MOV     P0,A
                                           ; SOURCE LINE # 907
002D C2A1              CLR     P21
                                           ; SOURCE LINE # 908
002F D2A1              SETB    P21
                                           ; SOURCE LINE # 909
0031 C2A3              CLR     P23
                                           ; SOURCE LINE # 910
0033 D2A2              SETB    P22
                                           ; SOURCE LINE # 911
0035 F580              MOV     P0,A
                                           ; SOURCE LINE # 912
0037 C2A1              CLR     P21
                                           ; SOURCE LINE # 913
0039 D2A1              SETB    P21
                                           ; SOURCE LINE # 914
003B 900000      R     MOV     DPTR,#ADDR9_16
003E E0                MOVX    A,@DPTR
003F F580              MOV     P0,A
                                           ; SOURCE LINE # 915
0041 C2A1              CLR     P21
                                           ; SOURCE LINE # 916
0043 D2A1              SETB    P21
                                           ; SOURCE LINE # 917
0045 900000      R     MOV     DPTR,#ADDR17_24
0048 E0                MOVX    A,@DPTR
0049 F580              MOV     P0,A
                                           ; SOURCE LINE # 918
004B C2A1              CLR     P21
                                           ; SOURCE LINE # 919
004D D2A1              SETB    P21
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 84  

                                           ; SOURCE LINE # 920
004F 900000      R     MOV     DPTR,#ADDR25
0052 E0                MOVX    A,@DPTR
0053 F580              MOV     P0,A
                                           ; SOURCE LINE # 921
0055 C2A1              CLR     P21
                                           ; SOURCE LINE # 922
0057 D2A1              SETB    P21
                                           ; SOURCE LINE # 923
0059 C2A2              CLR     P22
                                           ; SOURCE LINE # 925
                                           ; SOURCE LINE # 926
005B         ?C0166:
005B 30A6FD            JNB     P26,?C0166
                                           ; SOURCE LINE # 927
005E 7580FF            MOV     P0,#0FFH
                                           ; SOURCE LINE # 929
;---- Variable 'i' assigned to Register 'R6/R7' ----
0061 E4                CLR     A
0062 FF                MOV     R7,A
0063 FE                MOV     R6,A
0064         ?C0169:
                                           ; SOURCE LINE # 930
                                           ; SOURCE LINE # 931
0064 C2A5              CLR     P25
                                           ; SOURCE LINE # 932
0066 7400        R     MOV     A,#LOW rdata_buffer
0068 2F                ADD     A,R7
0069 F582              MOV     DPL,A
006B 7400        R     MOV     A,#HIGH rdata_buffer
006D 3E                ADDC    A,R6
006E F583              MOV     DPH,A
0070 E580              MOV     A,P0
0072 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 933
0073 D2A5              SETB    P25
                                           ; SOURCE LINE # 936
0075 0F                INC     R7
0076 BF0001            CJNE    R7,#00H,?C0275
0079 0E                INC     R6
007A         ?C0275:
007A E4                CLR     A
007B B507E6            CJNE    A,AR7,?C0169
007E EE                MOV     A,R6
007F B402E2            CJNE    A,#02H,?C0169
0082         ?C0170:
                                           ; SOURCE LINE # 937
;---- Variable 'j' assigned to Register 'R6/R7' ----
0082 E4                CLR     A
0083 FF                MOV     R7,A
0084 FE                MOV     R6,A
0085         ?C0172:
                                           ; SOURCE LINE # 938
                                           ; SOURCE LINE # 939
0085 C2A5              CLR     P25
                                           ; SOURCE LINE # 940
0087 7400        R     MOV     A,#LOW rparameter_buffer
0089 2F                ADD     A,R7
008A F582              MOV     DPL,A
008C E4                CLR     A
008D 3400        R     ADDC    A,#HIGH rparameter_buffer
008F F583              MOV     DPH,A
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 85  

0091 E580              MOV     A,P0
0093 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 941
0094 D2A5              SETB    P25
                                           ; SOURCE LINE # 942
0096 0F                INC     R7
0097 BF0001            CJNE    R7,#00H,?C0277
009A 0E                INC     R6
009B         ?C0277:
009B EF                MOV     A,R7
009C 6410              XRL     A,#010H
009E 4E                ORL     A,R6
009F 70E4              JNZ     ?C0172
                                           ; SOURCE LINE # 945
                                           ; SOURCE LINE # 946
00A1         ?C0175:
00A1 30A6FD            JNB     P26,?C0175
                                           ; SOURCE LINE # 947
00A4 7590FF            MOV     P1,#0FFH
                                           ; SOURCE LINE # 948
00A7 22                RET     
             ; FUNCTION ReadOnePage (END)

             ; FUNCTION L?0295 (BEGIN)
0000 E500        R     MOV     A,U_Data+03H
0002 2420              ADD     A,#020H
0004 F500        R     MOV     U_Data+03H,A
0006 E4                CLR     A
0007 3500        R     ADDC    A,U_Data+02H
0009 F500        R     MOV     U_Data+02H,A
000B E4                CLR     A
000C 3500        R     ADDC    A,U_Data+01H
000E F500        R     MOV     U_Data+01H,A
0010 E4                CLR     A
0011 3500        R     ADDC    A,U_Data
0013         L?0296:
0013 F500        R     MOV     U_Data,A
0015         L?0297:
0015 900000      R     MOV     DPTR,#ADDR9_16
0018 E500        R     MOV     A,U_Data+03H
001A F0                MOVX    @DPTR,A
001B 900000      R     MOV     DPTR,#ADDR17_24
001E E500        R     MOV     A,U_Data+02H
0020 F0                MOVX    @DPTR,A
0021 900000      R     MOV     DPTR,#ADDR25
0024 E500        R     MOV     A,U_Data+01H
0026 F0                MOVX    @DPTR,A
             ; FUNCTION ReadOnePage_C (BEGIN)
                                           ; SOURCE LINE # 951
                                           ; SOURCE LINE # 952
                                           ; SOURCE LINE # 953
;---- Variable 'm' assigned to Register 'R4/R5' ----
0027 7D01              MOV     R5,#01H
0029 7C00              MOV     R4,#00H
                                           ; SOURCE LINE # 960
002B 900000      R     MOV     DPTR,#UseChip
002E E0                MOVX    A,@DPTR
002F FF                MOV     R7,A
0030 ED                MOV     A,R5
0031 7E00              MOV     R6,#00H
0033 A807              MOV     R0,AR7
0035 08                INC     R0
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 86  

0036 8005              SJMP    ?C0279
0038         ?C0278:
0038 C3                CLR     C
0039 33                RLC     A
003A CE                XCH     A,R6
003B 33                RLC     A
003C CE                XCH     A,R6
003D         ?C0279:
003D D8F9              DJNZ    R0,?C0278
003F FD                MOV     R5,A
0040 AC06              MOV     R4,AR6
                                           ; SOURCE LINE # 962
0042 D2A5              SETB    P25
                                           ; SOURCE LINE # 963
0044 C2A2              CLR     P22
                                           ; SOURCE LINE # 964
0046 C2A3              CLR     P23
                                           ; SOURCE LINE # 965
0048 C2A0              CLR     P20
                                           ; SOURCE LINE # 966
004A D2A1              SETB    P21
                                           ; SOURCE LINE # 970
004C F4                CPL     A
004D F590              MOV     P1,A
                                           ; SOURCE LINE # 973
004F D2A3              SETB    P23
                                           ; SOURCE LINE # 974
0051 758050            MOV     P0,#050H
                                           ; SOURCE LINE # 975
0054 C2A1              CLR     P21
                                           ; SOURCE LINE # 976
0056 D2A1              SETB    P21
                                           ; SOURCE LINE # 977
0058 C2A3              CLR     P23
                                           ; SOURCE LINE # 978
005A D2A2              SETB    P22
                                           ; SOURCE LINE # 979
005C E4                CLR     A
005D F580              MOV     P0,A
                                           ; SOURCE LINE # 980
005F C2A1              CLR     P21
                                           ; SOURCE LINE # 981
0061 D2A1              SETB    P21
                                           ; SOURCE LINE # 982
0063 900000      R     MOV     DPTR,#ADDR9_16
0066 E0                MOVX    A,@DPTR
0067 F580              MOV     P0,A
                                           ; SOURCE LINE # 983
0069 C2A1              CLR     P21
                                           ; SOURCE LINE # 984
006B D2A1              SETB    P21
                                           ; SOURCE LINE # 985
006D 900000      R     MOV     DPTR,#ADDR17_24
0070 E0                MOVX    A,@DPTR
0071 F580              MOV     P0,A
                                           ; SOURCE LINE # 986
0073 C2A1              CLR     P21
                                           ; SOURCE LINE # 987
0075 D2A1              SETB    P21
                                           ; SOURCE LINE # 988
0077 900000      R     MOV     DPTR,#ADDR25
007A E0                MOVX    A,@DPTR
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 87  

007B F580              MOV     P0,A
                                           ; SOURCE LINE # 989
007D C2A1              CLR     P21
                                           ; SOURCE LINE # 990
007F D2A1              SETB    P21
                                           ; SOURCE LINE # 991
0081 C2A2              CLR     P22
                                           ; SOURCE LINE # 993
                                           ; SOURCE LINE # 994
0083         ?C0179:
0083 30A6FD            JNB     P26,?C0179
                                           ; SOURCE LINE # 995
0086 7580FF            MOV     P0,#0FFH
                                           ; SOURCE LINE # 997
;---- Variable 'j' assigned to Register 'R6/R7' ----
0089 E4                CLR     A
008A FF                MOV     R7,A
008B FE                MOV     R6,A
008C         ?C0182:
                                           ; SOURCE LINE # 998
                                           ; SOURCE LINE # 999
008C C2A5              CLR     P25
                                           ; SOURCE LINE # 1000
008E 7400        R     MOV     A,#LOW rparameter_buffer
0090 2F                ADD     A,R7
0091 F582              MOV     DPL,A
0093 E4                CLR     A
0094 3400        R     ADDC    A,#HIGH rparameter_buffer
0096 F583              MOV     DPH,A
0098 E580              MOV     A,P0
009A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1001
009B D2A5              SETB    P25
                                           ; SOURCE LINE # 1002
009D 0F                INC     R7
009E BF0001            CJNE    R7,#00H,?C0280
00A1 0E                INC     R6
00A2         ?C0280:
00A2 EF                MOV     A,R7
00A3 6410              XRL     A,#010H
00A5 4E                ORL     A,R6
00A6 70E4              JNZ     ?C0182
                                           ; SOURCE LINE # 1005
                                           ; SOURCE LINE # 1006
00A8         ?C0185:
00A8 30A6FD            JNB     P26,?C0185
                                           ; SOURCE LINE # 1007
00AB 7590FF            MOV     P1,#0FFH
                                           ; SOURCE LINE # 1008
00AE 22                RET     
             ; FUNCTION ReadOnePage_C (END)

             ; FUNCTION _EraseOneFlash (BEGIN)
                                           ; SOURCE LINE # 1013
0000 8F00        R     MOV     i,R7
                                           ; SOURCE LINE # 1014
                                           ; SOURCE LINE # 1016
0002 E4                CLR     A
0003 F500        R     MOV     addr9_16,A
                                           ; SOURCE LINE # 1017
0005 F500        R     MOV     addr17_24,A
                                           ; SOURCE LINE # 1018
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 88  

0007 F500        R     MOV     addr25,A
                                           ; SOURCE LINE # 1020
0009 750001      R     MOV     m,#01H
                                           ; SOURCE LINE # 1022
;---- Variable 'k' assigned to Register 'R6/R7' ----
000C FF                MOV     R7,A
000D FE                MOV     R6,A
000E         ?C0189:
                                           ; SOURCE LINE # 1023
000E 7E02              MOV     R6,#02H
0010 7F00              MOV     R7,#00H
0012 900000      R     MOV     DPTR,#wdata_buffer
0015 E4                CLR     A
0016         ?C0281:
0016 F0                MOVX    @DPTR,A
0017 A3                INC     DPTR
0018 DFFC              DJNZ    R7,?C0281
001A DEFA              DJNZ    R6,?C0281
001C         ?C0190:
                                           ; SOURCE LINE # 1024
001C E4                CLR     A
001D FE                MOV     R6,A
001E FF                MOV     R7,A
001F         ?C0192:
                                           ; SOURCE LINE # 1025
001F 7E10              MOV     R6,#010H
0021 900000      R     MOV     DPTR,#wparameter_buffer
0024 E4                CLR     A
0025         ?C0282:
0025 F0                MOVX    @DPTR,A
0026 A3                INC     DPTR
0027 DEFC              DJNZ    R6,?C0282
0029 7E00              MOV     R6,#00H
002B 7F10              MOV     R7,#010H
002D         ?C0193:
                                           ; SOURCE LINE # 1028
002D E4                CLR     A
002E 900000      R     MOV     DPTR,#UseChip
0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1029
0032 900000      R     MOV     DPTR,#ADDR25
0035 04                INC     A
0036 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1030
0037 900000      R     MOV     DPTR,#ADDR9_16
003A 74E0              MOV     A,#0E0H
003C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1031
003D 900000      R     MOV     DPTR,#ADDR17_24
0040 74FF              MOV     A,#0FFH
0042 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1032
0043 120000      R     LCALL   ReadOnePage
                                           ; SOURCE LINE # 1034
0046 AF00        R     MOV     R7,i
0048 E500        R     MOV     A,m
004A A807              MOV     R0,AR7
004C 08                INC     R0
004D 8002              SJMP    ?C0284
004F         ?C0283:
004F C3                CLR     C
0050 33                RLC     A
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 89  

0051         ?C0284:
0051 D8FC              DJNZ    R0,?C0283
0053 F500        R     MOV     m,A
                                           ; SOURCE LINE # 1035
0055 D2A5              SETB    P25
                                           ; SOURCE LINE # 1036
0057 C2A2              CLR     P22
                                           ; SOURCE LINE # 1037
0059 C2A3              CLR     P23
                                           ; SOURCE LINE # 1038
005B D2A0              SETB    P20
                                           ; SOURCE LINE # 1039
005D D2A1              SETB    P21
                                           ; SOURCE LINE # 1042
005F         loop:
                                           ; SOURCE LINE # 1044
005F E500        R     MOV     A,m
0061 F4                CPL     A
0062 F590              MOV     P1,A
                                           ; SOURCE LINE # 1045
0064 D2A3              SETB    P23
                                           ; SOURCE LINE # 1046
0066 758060            MOV     P0,#060H
                                           ; SOURCE LINE # 1047
0069 C2A1              CLR     P21
                                           ; SOURCE LINE # 1048
006B D2A1              SETB    P21
                                           ; SOURCE LINE # 1049
006D C2A3              CLR     P23
                                           ; SOURCE LINE # 1050
006F D2A2              SETB    P22
                                           ; SOURCE LINE # 1051
0071 850080      R     MOV     P0,addr9_16
                                           ; SOURCE LINE # 1052
0074 C2A1              CLR     P21
                                           ; SOURCE LINE # 1053
0076 D2A1              SETB    P21
                                           ; SOURCE LINE # 1055
0078 850080      R     MOV     P0,addr17_24
                                           ; SOURCE LINE # 1056
007B C2A1              CLR     P21
                                           ; SOURCE LINE # 1057
007D D2A1              SETB    P21
                                           ; SOURCE LINE # 1059
007F 850080      R     MOV     P0,addr25
                                           ; SOURCE LINE # 1060
0082 C2A1              CLR     P21
                                           ; SOURCE LINE # 1061
0084 D2A1              SETB    P21
                                           ; SOURCE LINE # 1063
0086 C2A2              CLR     P22
                                           ; SOURCE LINE # 1064
0088 D2A3              SETB    P23
                                           ; SOURCE LINE # 1066
008A 7580D0            MOV     P0,#0D0H
                                           ; SOURCE LINE # 1068
008D C2A1              CLR     P21
                                           ; SOURCE LINE # 1069
008F D2A1              SETB    P21
                                           ; SOURCE LINE # 1070
0091 C2A3              CLR     P23
                                           ; SOURCE LINE # 1072
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 90  

                                           ; SOURCE LINE # 1073
0093         ?C0196:
0093 30A6FD            JNB     P26,?C0196
                                           ; SOURCE LINE # 1074
0096 D2A3              SETB    P23
                                           ; SOURCE LINE # 1075
0098 758070            MOV     P0,#070H
                                           ; SOURCE LINE # 1076
009B C2A1              CLR     P21
                                           ; SOURCE LINE # 1077
009D D2A1              SETB    P21
                                           ; SOURCE LINE # 1078
009F C2A3              CLR     P23
                                           ; SOURCE LINE # 1079
00A1 C2A5              CLR     P25
                                           ; SOURCE LINE # 1080
00A3 7580FF            MOV     P0,#0FFH
                                           ; SOURCE LINE # 1081
;---- Variable 'Statuse' assigned to Register 'R7' ----
00A6 AF80              MOV     R7,P0
                                           ; SOURCE LINE # 1082
00A8 D2A5              SETB    P25
                                           ; SOURCE LINE # 1085
00AA 53070F            ANL     AR7,#0FH
                                           ; SOURCE LINE # 1087
00AD EF                MOV     A,R7
00AE 7003              JNZ     $ + 5H
00B0 020000      R     LJMP    ?C0199
                                           ; SOURCE LINE # 1088
00B3 900000      R     MOV     DPTR,#ErrorFlash+01H
00B6 E0                MOVX    A,@DPTR
00B7 04                INC     A
00B8 F0                MOVX    @DPTR,A
00B9 7006              JNZ     ?C0285
00BB 900000      R     MOV     DPTR,#ErrorFlash
00BE E0                MOVX    A,@DPTR
00BF 04                INC     A
00C0 F0                MOVX    @DPTR,A
00C1         ?C0285:
                                           ; SOURCE LINE # 1093
00C1 900000      R     MOV     DPTR,#ADDR25
00C4 E500        R     MOV     A,addr25
00C6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1094
00C7 900000      R     MOV     DPTR,#ADDR17_24
00CA E500        R     MOV     A,addr17_24
00CC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1095
00CD 900000      R     MOV     DPTR,#ADDR9_16
00D0 E500        R     MOV     A,addr9_16
00D2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1096
00D3 900000      R     MOV     DPTR,#UseChip
00D6 E500        R     MOV     A,i
00D8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1097
00D9 120000      R     LCALL   WriteOnePage
                                           ; SOURCE LINE # 1099
00DC D2A0              SETB    P20
                                           ; SOURCE LINE # 1100
00DE 7580FF            MOV     P0,#0FFH
                                           ; SOURCE LINE # 1101
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 91  

00E1 900000      R     MOV     DPTR,#ckb
00E4 E0                MOVX    A,@DPTR
00E5 6401              XRL     A,#01H
00E7 6003              JZ      $ + 5H
00E9 020000      R     LJMP    ?C0203
                                           ; SOURCE LINE # 1102
                                           ; SOURCE LINE # 1103
00EC E500        R     MOV     A,addr25
00EE B40112            CJNE    A,#01H,?C0201
00F1 E500        R     MOV     A,addr17_24
00F3 B4FF0D            CJNE    A,#0FFH,?C0201
00F6 E500        R     MOV     A,addr9_16
00F8 B4E008            CJNE    A,#0E0H,?C0201
                                           ; SOURCE LINE # 1104
00FB 900000      R     MOV     DPTR,#bad
00FE 744E              MOV     A,#04EH
0100 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1105
0101 8006              SJMP    ?C0202
0103         ?C0201:
                                           ; SOURCE LINE # 1107
0103 900000      R     MOV     DPTR,#bad
0106 744D              MOV     A,#04DH
0108 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1108
0109         ?C0202:
                                           ; SOURCE LINE # 1109
0109 900000      R     MOV     DPTR,#bad+01H
010C E500        R     MOV     A,i
010E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1110
010F 900000      R     MOV     DPTR,#num
0112 E0                MOVX    A,@DPTR
0113 900000      R     MOV     DPTR,#bad+02H
0116 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1111
0117 900000      R     MOV     DPTR,#ADDR25
011A E0                MOVX    A,@DPTR
011B 900000      R     MOV     DPTR,#bad+03H
011E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1112
011F 900000      R     MOV     DPTR,#ADDR17_24
0122 E0                MOVX    A,@DPTR
0123 900000      R     MOV     DPTR,#bad+04H
0126 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1113
0127 900000      R     MOV     DPTR,#ADDR9_16
012A E0                MOVX    A,@DPTR
012B 900000      R     MOV     DPTR,#bad+05H
012E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1114
012F 900000      R     MOV     DPTR,#num
0132 E0                MOVX    A,@DPTR
0133 04                INC     A
0134 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1116
0135 7B01              MOV     R3,#01H
0137 7A00        R     MOV     R2,#HIGH bad
0139 7900        R     MOV     R1,#LOW bad
013B 7D06              MOV     R5,#06H
013D 120000      E     LCALL   _USBSendData
                                           ; SOURCE LINE # 1123
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 92  

                                           ; SOURCE LINE # 1125
0140 803E              SJMP    ?C0203
0142         ?C0199:
                                           ; SOURCE LINE # 1127
                                           ; SOURCE LINE # 1128
0142 E500        R     MOV     A,addr25
0144 6401              XRL     A,#01H
0146 7038              JNZ     ?C0203
0148 E500        R     MOV     A,addr17_24
014A F4                CPL     A
014B 7033              JNZ     ?C0203
014D E500        R     MOV     A,addr9_16
014F 64E0              XRL     A,#0E0H
0151 702D              JNZ     ?C0203
                                           ; SOURCE LINE # 1129
                                           ; SOURCE LINE # 1130
0153 900000      R     MOV     DPTR,#bad
0156 7452              MOV     A,#052H
0158 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1131
0159 E4                CLR     A
015A A3                INC     DPTR
015B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1132
015C A3                INC     DPTR
015D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1133
015E A3                INC     DPTR
015F E500        R     MOV     A,addr25
0161 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1134
0162 A3                INC     DPTR
0163 E500        R     MOV     A,addr17_24
0165 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1135
0166 A3                INC     DPTR
0167 E500        R     MOV     A,addr9_16
0169 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1136
016A 7B01              MOV     R3,#01H
016C 7A00        R     MOV     R2,#HIGH bad
016E 7900        R     MOV     R1,#LOW bad
0170 7D06              MOV     R5,#06H
0172 120000      E     LCALL   _USBSendData
                                           ; SOURCE LINE # 1137
0175 7BFF              MOV     R3,#0FFH
0177 7A00        R     MOV     R2,#HIGH ?SC_156
0179 7900        R     MOV     R1,#LOW ?SC_156
017B 7D0E              MOV     R5,#0EH
017D 120000      E     LCALL   _USBSendData
                                           ; SOURCE LINE # 1138
                                           ; SOURCE LINE # 1139
0180         ?C0203:
                                           ; SOURCE LINE # 1141
0180 7590FF            MOV     P1,#0FFH
                                           ; SOURCE LINE # 1143
0183 7420              MOV     A,#020H
0185 2500        R     ADD     A,addr9_16
0187 F500        R     MOV     addr9_16,A
                                           ; SOURCE LINE # 1145
0189 7008              JNZ     ?C0205
                                           ; SOURCE LINE # 1146
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 93  

                                           ; SOURCE LINE # 1147
018B 0500        R     INC     addr17_24
                                           ; SOURCE LINE # 1148
018D E500        R     MOV     A,addr17_24
018F 7002              JNZ     ?C0205
                                           ; SOURCE LINE # 1149
                                           ; SOURCE LINE # 1150
0191 0500        R     INC     addr25
                                           ; SOURCE LINE # 1151
                                           ; SOURCE LINE # 1152
0193         ?C0205:
                                           ; SOURCE LINE # 1154
0193 E500        R     MOV     A,addr25
0195 D3                SETB    C
0196 9401              SUBB    A,#01H
0198 5003              JNC     $ + 5H
019A 020000      R     LJMP    loop
                                           ; SOURCE LINE # 1155
                                           ; SOURCE LINE # 1157
;---- Variable 'pi' assigned to Register 'R6/R7' ----
019D E4                CLR     A
019E FF                MOV     R7,A
019F FE                MOV     R6,A
01A0         ?C0208:
                                           ; SOURCE LINE # 1158
01A0 7400        R     MOV     A,#LOW rdata_buffer
01A2 2F                ADD     A,R7
01A3 F582              MOV     DPL,A
01A5 7400        R     MOV     A,#HIGH rdata_buffer
01A7 3E                ADDC    A,R6
01A8 F583              MOV     DPH,A
01AA E0                MOVX    A,@DPTR
01AB FD                MOV     R5,A
01AC 7400        R     MOV     A,#LOW wdata_buffer
01AE 2F                ADD     A,R7
01AF F582              MOV     DPL,A
01B1 7400        R     MOV     A,#HIGH wdata_buffer
01B3 3E                ADDC    A,R6
01B4 F583              MOV     DPH,A
01B6 ED                MOV     A,R5
01B7 F0                MOVX    @DPTR,A
01B8 0F                INC     R7
01B9 BF0001            CJNE    R7,#00H,?C0286
01BC 0E                INC     R6
01BD         ?C0286:
01BD E4                CLR     A
01BE B507DF            CJNE    A,AR7,?C0208
01C1 EE                MOV     A,R6
01C2 B402DB            CJNE    A,#02H,?C0208
01C5         ?C0209:
                                           ; SOURCE LINE # 1159
01C5 E4                CLR     A
01C6 FE                MOV     R6,A
01C7 FF                MOV     R7,A
01C8         ?C0211:
                                           ; SOURCE LINE # 1160
01C8 7400        R     MOV     A,#LOW rparameter_buffer
01CA 2F                ADD     A,R7
01CB F582              MOV     DPL,A
01CD E4                CLR     A
01CE 3400        R     ADDC    A,#HIGH rparameter_buffer
01D0 F583              MOV     DPH,A
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 94  

01D2 E0                MOVX    A,@DPTR
01D3 FD                MOV     R5,A
01D4 7400        R     MOV     A,#LOW wparameter_buffer
01D6 2F                ADD     A,R7
01D7 F582              MOV     DPL,A
01D9 E4                CLR     A
01DA 3400        R     ADDC    A,#HIGH wparameter_buffer
01DC F583              MOV     DPH,A
01DE ED                MOV     A,R5
01DF F0                MOVX    @DPTR,A
01E0 0F                INC     R7
01E1 BF0001            CJNE    R7,#00H,?C0288
01E4 0E                INC     R6
01E5         ?C0288:
01E5 EF                MOV     A,R7
01E6 6410              XRL     A,#010H
01E8 4E                ORL     A,R6
01E9 70DD              JNZ     ?C0211
01EB         ?C0212:
                                           ; SOURCE LINE # 1161
01EB E4                CLR     A
01EC 900000      R     MOV     DPTR,#UseChip
01EF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1162
01F0 900000      R     MOV     DPTR,#ADDR25
01F3 04                INC     A
01F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1163
01F5 900000      R     MOV     DPTR,#ADDR9_16
01F8 74E0              MOV     A,#0E0H
01FA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1164
01FB 900000      R     MOV     DPTR,#ADDR17_24
01FE 74FF              MOV     A,#0FFH
0200 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1165
0201 120000      R     LCALL   WriteOnePage
                                           ; SOURCE LINE # 1168
                                           ; SOURCE LINE # 1169
                                           ; SOURCE LINE # 1170
0204         ?C0214:
0204 22                RET     
             ; FUNCTION _EraseOneFlash (END)

             ; FUNCTION _ReadoneChip_leavefactory_invalidblock (BEGIN)
                                           ; SOURCE LINE # 1173
0000 8F00        R     MOV     Chipi,R7
                                           ; SOURCE LINE # 1174
                                           ; SOURCE LINE # 1175
0002 750000      R     MOV     m,#00H
0005 750001      R     MOV     m+01H,#01H
                                           ; SOURCE LINE # 1177
0008 E4                CLR     A
0009 F500        R     MOV     addr9_16,A
                                           ; SOURCE LINE # 1178
000B F500        R     MOV     addr17_24,A
                                           ; SOURCE LINE # 1179
000D F500        R     MOV     addr25,A
                                           ; SOURCE LINE # 1181
000F E500        R     MOV     A,m+01H
0011 AE00        R     MOV     R6,m
0013 A807              MOV     R0,AR7
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 95  

0015 08                INC     R0
0016 8005              SJMP    ?C0290
0018         ?C0289:
0018 C3                CLR     C
0019 33                RLC     A
001A CE                XCH     A,R6
001B 33                RLC     A
001C CE                XCH     A,R6
001D         ?C0290:
001D D8F9              DJNZ    R0,?C0289
001F F500        R     MOV     m+01H,A
0021 8E00        R     MOV     m,R6
                                           ; SOURCE LINE # 1183
0023 D2A5              SETB    P25
                                           ; SOURCE LINE # 1184
0025 C2A2              CLR     P22
                                           ; SOURCE LINE # 1185
0027 C2A3              CLR     P23
                                           ; SOURCE LINE # 1186
0029 C2A0              CLR     P20
                                           ; SOURCE LINE # 1187
002B D2A1              SETB    P21
                                           ; SOURCE LINE # 1189
002D         block:
                                           ; SOURCE LINE # 1190
002D E500        R     MOV     A,m+01H
002F F4                CPL     A
0030 F590              MOV     P1,A
                                           ; SOURCE LINE # 1193
0032 D2A3              SETB    P23
                                           ; SOURCE LINE # 1194
0034 758050            MOV     P0,#050H
                                           ; SOURCE LINE # 1195
0037 C2A1              CLR     P21
                                           ; SOURCE LINE # 1196
0039 D2A1              SETB    P21
                                           ; SOURCE LINE # 1197
003B C2A3              CLR     P23
                                           ; SOURCE LINE # 1198
003D D2A2              SETB    P22
                                           ; SOURCE LINE # 1199
003F E4                CLR     A
0040 F580              MOV     P0,A
                                           ; SOURCE LINE # 1200
0042 C2A1              CLR     P21
                                           ; SOURCE LINE # 1201
0044 D2A1              SETB    P21
                                           ; SOURCE LINE # 1202
0046 850080      R     MOV     P0,addr9_16
                                           ; SOURCE LINE # 1203
0049 C2A1              CLR     P21
                                           ; SOURCE LINE # 1204
004B D2A1              SETB    P21
                                           ; SOURCE LINE # 1205
004D 850080      R     MOV     P0,addr17_24
                                           ; SOURCE LINE # 1206
0050 C2A1              CLR     P21
                                           ; SOURCE LINE # 1207
0052 D2A1              SETB    P21
                                           ; SOURCE LINE # 1208
0054 850080      R     MOV     P0,addr25
                                           ; SOURCE LINE # 1209
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 96  

0057 C2A1              CLR     P21
                                           ; SOURCE LINE # 1210
0059 D2A1              SETB    P21
                                           ; SOURCE LINE # 1211
005B C2A2              CLR     P22
                                           ; SOURCE LINE # 1213
                                           ; SOURCE LINE # 1214
005D         ?C0216:
005D 30A6FD            JNB     P26,?C0216
                                           ; SOURCE LINE # 1215
0060 7580FF            MOV     P0,#0FFH
                                           ; SOURCE LINE # 1217
0063 E4                CLR     A
0064 F500        R     MOV     j,A
0066 F500        R     MOV     j+01H,A
0068         ?C0219:
                                           ; SOURCE LINE # 1218
                                           ; SOURCE LINE # 1219
0068 C2A5              CLR     P25
                                           ; SOURCE LINE # 1220
006A 7400        R     MOV     A,#LOW rparameter_buffer
006C 2500        R     ADD     A,j+01H
006E F582              MOV     DPL,A
0070 E4                CLR     A
0071 3400        R     ADDC    A,#HIGH rparameter_buffer
0073 F583              MOV     DPH,A
0075 E580              MOV     A,P0
0077 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1221
0078 D2A5              SETB    P25
                                           ; SOURCE LINE # 1222
007A 0500        R     INC     j+01H
007C E500        R     MOV     A,j+01H
007E 7002              JNZ     ?C0291
0080 0500        R     INC     j
0082         ?C0291:
0082 6410              XRL     A,#010H
0084 4500        R     ORL     A,j
0086 70E0              JNZ     ?C0219
                                           ; SOURCE LINE # 1224
                                           ; SOURCE LINE # 1225
0088         ?C0222:
0088 30A6FD            JNB     P26,?C0222
                                           ; SOURCE LINE # 1227
008B 900000      R     MOV     DPTR,#rparameter_buffer+05H
008E E0                MOVX    A,@DPTR
008F F4                CPL     A
0090 6041              JZ      ?C0225
                                           ; SOURCE LINE # 1228
                                           ; SOURCE LINE # 1229
0092 900000      E     MOV     DPTR,#ErrorBlock+01H
0095 E0                MOVX    A,@DPTR
0096 04                INC     A
0097 F0                MOVX    @DPTR,A
0098 7006              JNZ     ?C0292
009A 900000      E     MOV     DPTR,#ErrorBlock
009D E0                MOVX    A,@DPTR
009E 04                INC     A
009F F0                MOVX    @DPTR,A
00A0         ?C0292:
                                           ; SOURCE LINE # 1230
00A0 7500FF      E     MOV     ?_sprintf?BYTE+03H,#0FFH
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 97  

00A3 750000      R     MOV     ?_sprintf?BYTE+04H,#HIGH ?SC_171
00A6 750000      R     MOV     ?_sprintf?BYTE+05H,#LOW ?SC_171
00A9 750000      E     MOV     ?_sprintf?BYTE+06H,#00H
00AC 850000      E     MOV     ?_sprintf?BYTE+07H,Chipi
00AF 750000      E     MOV     ?_sprintf?BYTE+08H,#00H
00B2 850000      E     MOV     ?_sprintf?BYTE+09H,addr25
00B5 750000      E     MOV     ?_sprintf?BYTE+0AH,#00H
00B8 850000      E     MOV     ?_sprintf?BYTE+0BH,addr17_24
00BB 750000      E     MOV     ?_sprintf?BYTE+0CH,#00H
00BE 850000      E     MOV     ?_sprintf?BYTE+0DH,addr9_16
00C1 7B01              MOV     R3,#01H
00C3 7A00        E     MOV     R2,#HIGH tmpBuf
00C5 7900        E     MOV     R1,#LOW tmpBuf
00C7 120000      E     LCALL   _sprintf
                                           ; SOURCE LINE # 1231
00CA 7B01              MOV     R3,#01H
00CC 7A00        E     MOV     R2,#HIGH tmpBuf
00CE 7900        E     MOV     R1,#LOW tmpBuf
00D0 120000      E     LCALL   _putbuf
                                           ; SOURCE LINE # 1232
00D3         ?C0225:
                                           ; SOURCE LINE # 1233
00D3 E4                CLR     A
00D4 F500        R     MOV     j,A
00D6 F500        R     MOV     j+01H,A
00D8         ?C0226:
                                           ; SOURCE LINE # 1234
                                           ; SOURCE LINE # 1235
00D8 C2A5              CLR     P25
                                           ; SOURCE LINE # 1236
00DA 7400        R     MOV     A,#LOW rparameter_buffer
00DC 2500        R     ADD     A,j+01H
00DE F582              MOV     DPL,A
00E0 E4                CLR     A
00E1 3400        R     ADDC    A,#HIGH rparameter_buffer
00E3 F583              MOV     DPH,A
00E5 E580              MOV     A,P0
00E7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1237
00E8 D2A5              SETB    P25
                                           ; SOURCE LINE # 1238
00EA 0500        R     INC     j+01H
00EC E500        R     MOV     A,j+01H
00EE 7002              JNZ     ?C0293
00F0 0500        R     INC     j
00F2         ?C0293:
00F2 6410              XRL     A,#010H
00F4 4500        R     ORL     A,j
00F6 70E0              JNZ     ?C0226
00F8         ?C0227:
                                           ; SOURCE LINE # 1239
00F8 900000      R     MOV     DPTR,#rparameter_buffer+05H
00FB E0                MOVX    A,@DPTR
00FC F4                CPL     A
00FD 6041              JZ      ?C0230
                                           ; SOURCE LINE # 1240
                                           ; SOURCE LINE # 1241
00FF 900000      E     MOV     DPTR,#ErrorBlock+01H
0102 E0                MOVX    A,@DPTR
0103 04                INC     A
0104 F0                MOVX    @DPTR,A
0105 7006              JNZ     ?C0294
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 98  

0107 900000      E     MOV     DPTR,#ErrorBlock
010A E0                MOVX    A,@DPTR
010B 04                INC     A
010C F0                MOVX    @DPTR,A
010D         ?C0294:
                                           ; SOURCE LINE # 1242
010D 7500FF      E     MOV     ?_sprintf?BYTE+03H,#0FFH
0110 750000      R     MOV     ?_sprintf?BYTE+04H,#HIGH ?SC_171
0113 750000      R     MOV     ?_sprintf?BYTE+05H,#LOW ?SC_171
0116 750000      E     MOV     ?_sprintf?BYTE+06H,#00H
0119 850000      E     MOV     ?_sprintf?BYTE+07H,Chipi
011C 750000      E     MOV     ?_sprintf?BYTE+08H,#00H
011F 850000      E     MOV     ?_sprintf?BYTE+09H,addr25
0122 750000      E     MOV     ?_sprintf?BYTE+0AH,#00H
0125 850000      E     MOV     ?_sprintf?BYTE+0BH,addr17_24
0128 750000      E     MOV     ?_sprintf?BYTE+0CH,#00H
012B 850000      E     MOV     ?_sprintf?BYTE+0DH,addr9_16
012E 7B01              MOV     R3,#01H
0130 7A00        E     MOV     R2,#HIGH tmpBuf
0132 7900        E     MOV     R1,#LOW tmpBuf
0134 120000      E     LCALL   _sprintf
                                           ; SOURCE LINE # 1243
0137 7B01              MOV     R3,#01H
0139 7A00        E     MOV     R2,#HIGH tmpBuf
013B 7900        E     MOV     R1,#LOW tmpBuf
013D 120000      E     LCALL   _putbuf
                                           ; SOURCE LINE # 1244
                                           ; SOURCE LINE # 1247
                                           ; SOURCE LINE # 1248
0140         ?C0230:
0140 30A6FD            JNB     P26,?C0230
                                           ; SOURCE LINE # 1249
0143 7590FF            MOV     P1,#0FFH
                                           ; SOURCE LINE # 1251
0146 7420              MOV     A,#020H
0148 2500        R     ADD     A,addr9_16
014A F500        R     MOV     addr9_16,A
                                           ; SOURCE LINE # 1252
014C 7008              JNZ     ?C0233
                                           ; SOURCE LINE # 1253
                                           ; SOURCE LINE # 1254
014E 0500        R     INC     addr17_24
                                           ; SOURCE LINE # 1255
0150 E500        R     MOV     A,addr17_24
0152 7002              JNZ     ?C0233
                                           ; SOURCE LINE # 1256
                                           ; SOURCE LINE # 1257
0154 0500        R     INC     addr25
                                           ; SOURCE LINE # 1258
                                           ; SOURCE LINE # 1259
0156         ?C0233:
                                           ; SOURCE LINE # 1260
0156 E500        R     MOV     A,addr25
0158 D3                SETB    C
0159 9401              SUBB    A,#01H
015B 5003              JNC     $ + 5H
015D 020000      R     LJMP    block
                                           ; SOURCE LINE # 1262
                                           ; SOURCE LINE # 1263
0160         ?C0236:
0160 22                RET     
             ; FUNCTION _ReadoneChip_leavefactory_invalidblock (END)
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 99  


             ; FUNCTION ReadallChip_leavefactory_invalidblock (BEGIN)
                                           ; SOURCE LINE # 1354
                                           ; SOURCE LINE # 1355
                                           ; SOURCE LINE # 1357
0000 E4                CLR     A
0001 F500        R     MOV     i,A
0003         ?C0237:
                                           ; SOURCE LINE # 1358
                                           ; SOURCE LINE # 1359
0003 7400        R     MOV     A,#LOW FlashChip
0005 2500        R     ADD     A,i
0007 F8                MOV     R0,A
0008 E6                MOV     A,@R0
0009 B44005            CJNE    A,#040H,?C0239
                                           ; SOURCE LINE # 1360
000C AF00        R     MOV     R7,i
000E 120000      R     LCALL   _ReadoneChip_leavefactory_invalidblock
                                           ; SOURCE LINE # 1361
0011         ?C0239:
0011 0500        R     INC     i
0013 E500        R     MOV     A,i
0015 C3                CLR     C
0016 9406              SUBB    A,#06H
0018 40E9              JC      ?C0237
                                           ; SOURCE LINE # 1363
001A         ?C0241:
001A 22                RET     
             ; FUNCTION ReadallChip_leavefactory_invalidblock (END)

             ; FUNCTION _TestoneChip_Status_information (BEGIN)
                                           ; SOURCE LINE # 1365
;---- Variable 'Chipi' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1366
                                           ; SOURCE LINE # 1368
0000 900000      R     MOV     DPTR,#Erasel
0003 7401              MOV     A,#01H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1369
0006 900000      R     MOV     DPTR,#ckb
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1370
000A 120000      R     LCALL   _EraseOneFlash
                                           ; SOURCE LINE # 1371
000D E4                CLR     A
000E 900000      R     MOV     DPTR,#ckb
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1372
0012 900000      R     MOV     DPTR,#Erasel
0015 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1374
0016 22                RET     
             ; FUNCTION _TestoneChip_Status_information (END)

             ; FUNCTION TestallChip_Status_information (BEGIN)
                                           ; SOURCE LINE # 1378
                                           ; SOURCE LINE # 1379
                                           ; SOURCE LINE # 1382
0000 E4                CLR     A
0001 F500        R     MOV     i,A
0003         ?C0243:
                                           ; SOURCE LINE # 1383
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 100 

                                           ; SOURCE LINE # 1384
0003 7400        R     MOV     A,#LOW FlashChip
0005 2500        R     ADD     A,i
0007 F8                MOV     R0,A
0008 E6                MOV     A,@R0
0009 B44005            CJNE    A,#040H,?C0245
                                           ; SOURCE LINE # 1385
000C AF00        R     MOV     R7,i
000E 120000      R     LCALL   _TestoneChip_Status_information
                                           ; SOURCE LINE # 1386
0011         ?C0245:
0011 0500        R     INC     i
0013 E500        R     MOV     A,i
0015 C3                CLR     C
0016 9406              SUBB    A,#06H
0018 40E9              JC      ?C0243
001A         ?C0244:
                                           ; SOURCE LINE # 1387
001A E4                CLR     A
001B 900000      R     MOV     DPTR,#FileNumber
001E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1388
001F 22                RET     
             ; FUNCTION TestallChip_Status_information (END)

C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 101 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


ErrorFlash . . . . . . . . . . . . . .  PUBLIC   XDATA  U_INT    0000H  2
CCF2 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00C2H  1
CCF3 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00C3H  1
P0 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0080H  1
CCF4 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00C4H  1
P1 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0090H  1
P2 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00A0H  1
AA . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00DAH  1
P3 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B0H  1
ADDR25 . . . . . . . . . . . . . . . .  PUBLIC   XDATA  U_CHAR   0002H  1
AC . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D6H  1
T0 . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B4H  1
_IO_REQUEST. . . . . . . . . . . . . .  * TAG *  -----  STRUCT   -----  6
  uAddressL. . . . . . . . . . . . . .  MEMBER   -----  U_INT    0000H  2
  bAddressH. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0002H  1
  uSize. . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0003H  2
  bCommand . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0005H  1
MCU_D12CS. . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0096H  1
T1 . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B5H  1
EA . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00AFH  1
T2 . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0090H  1
ULONG. . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_LONG   -----  4
InitFlash. . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  * REG *  DATA   INT      0006H  2
EC . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00AEH  1
CF . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00C7H  1
_bytes . . . . . . . . . . . . . . . .  * TAG *  -----  STRUCT   -----  2
  high . . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  low. . . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
ReadallChip_leavefactory_invalidblock.  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
FE . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      009FH  1
IEN0 . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00A8H  1
IEN1 . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00E8H  1
CEX0 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0093H  1
size_t . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
CEX1 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0094H  1
CP . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00C8H  1
CEX2 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0095H  1
ChipMark . . . . . . . . . . . . . . .  PUBLIC   XDATA  U_CHAR   0003H  1
FileStart. . . . . . . . . . . . . . .  PUBLIC   XDATA  ARRAY    0004H  800
CR . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00C6H  1
EXF2 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00CEH  1
RD . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B7H  1
_epp_flags . . . . . . . . . . . . . .  * TAG *  -----  UNION    -----  2
  bits . . . . . . . . . . . . . . . .  MEMBER   -----  STRUCT   0000H  2
  value. . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0000H  2
ENS1 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00DEH  1
rparameter_buffer. . . . . . . . . . .  PUBLIC   XDATA  ARRAY    0324H  16
UD . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D1H  1
IP . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B8H  1
FileSumCheck . . . . . . . . . . . . .  EXTERN   XDATA  U_INT    -----  2
RI . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0098H  1
FindEnd. . . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  AUTO     DATA   INT      0000H  2
  chip . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0002H  1
  addr9_16 . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0003H  1
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 102 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


  addr17_24. . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0004H  1
  addr25 . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0005H  1
  address9_16. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0006H  1
  address17_24 . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0007H  1
  address25. . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0008H  1
  count. . . . . . . . . . . . . . . .  * REG *  DATA   INT      0002H  2
  i1 . . . . . . . . . . . . . . . . .  AUTO     DATA   INT      0009H  2
  i2 . . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   000BH  1
  findchip . . . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
  findaddress. . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
CY . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D7H  1
INT0 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B2H  1
SI . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00DBH  1
ADDR9_16 . . . . . . . . . . . . . . .  PUBLIC   XDATA  U_CHAR   0334H  1
INT1 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B3H  1
TI . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0099H  1
wparameter_buffer. . . . . . . . . . .  PUBLIC   XDATA  ARRAY    0335H  16
IE0_ . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0089H  1
IE1_ . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008BH  1
FileSize . . . . . . . . . . . . . . .  PUBLIC   XDATA  ARRAY    0345H  800
ReadOnePage. . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  * REG *  DATA   INT      0006H  2
  j. . . . . . . . . . . . . . . . . .  * REG *  DATA   INT      0006H  2
  m. . . . . . . . . . . . . . . . . .  * REG *  DATA   INT      0004H  2
CCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00C0H  1
T2EX . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0091H  1
IO_REQUEST . . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  6
  uAddressL. . . . . . . . . . . . . .  MEMBER   -----  U_INT    0000H  2
  bAddressH. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0002H  1
  uSize. . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0003H  2
  bCommand . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0005H  1
OV . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D2H  1
BLOCKend . . . . . . . . . . . . . . .  PUBLIC   XDATA  U_CHAR   0665H  1
rChecknum. . . . . . . . . . . . . . .  PUBLIC   XDATA  U_INT    0666H  2
bad. . . . . . . . . . . . . . . . . .  PUBLIC   XDATA  ARRAY    0668H  6
WR . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B6H  1
wChecknum. . . . . . . . . . . . . . .  PUBLIC   XDATA  U_INT    066EH  2
FindPrvBlock . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  * REG *  DATA   INT      0002H  2
  prvblockaddress. . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
_rom_addr. . . . . . . . . . . . . . .  * TAG *  -----  UNION    -----  2
  byte . . . . . . . . . . . . . . . .  MEMBER   -----  STRUCT   0000H  2
  word . . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0000H  2
BOOL . . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
RCLK . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00CDH  1
TCLK . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00CCH  1
BLOCKfir . . . . . . . . . . . . . . .  PUBLIC   XDATA  U_CHAR   0670H  1
U_Data . . . . . . . . . . . . . . . .  PUBLIC   DATA   UNION    0000H  4
ckb. . . . . . . . . . . . . . . . . .  PUBLIC   XDATA  U_CHAR   0671H  1
P10. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0090H  1
WriteOnePage . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  Statusw. . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
  i. . . . . . . . . . . . . . . . . .  * REG *  DATA   INT      0006H  2
  j. . . . . . . . . . . . . . . . . .  * REG *  DATA   INT      0006H  2
  m. . . . . . . . . . . . . . . . . .  * REG *  DATA   INT      0004H  2
P20. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A0H  1
P11. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0091H  1
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 103 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


P21. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A1H  1
P12. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0092H  1
P22. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A2H  1
P13. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0093H  1
UseChip. . . . . . . . . . . . . . . .  PUBLIC   XDATA  U_CHAR   0672H  1
P23. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A3H  1
P14. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0094H  1
TCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0088H  1
AD0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0080H  1
P24. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A4H  1
P15. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0095H  1
AD1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0081H  1
P25. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A5H  1
P16. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0096H  1
AD2. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0082H  1
P26. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A6H  1
P17. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0097H  1
AD3. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0083H  1
D12SUSPD . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B3H  1
P27. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A7H  1
AD4. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0084H  1
AD5. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0085H  1
CONTROL_XFER . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  23
  DeviceRequest. . . . . . . . . . . .  MEMBER   -----  STRUCT   0000H  8
  wLength. . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0008H  2
  wCount . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    000AH  2
  pData. . . . . . . . . . . . . . . .  MEMBER   -----  PTR      000CH  3
  dataBuffer . . . . . . . . . . . . .  MEMBER   -----  ARRAY    000FH  8
AD6. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0086H  1
NowFileName. . . . . . . . . . . . . .  PUBLIC   XDATA  U_CHAR   0673H  1
AD7. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0087H  1
AD8. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A0H  1
AD9. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A1H  1
DEVICE_REQUEST . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  8
  bmRequestType. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  bRequest . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  wValue . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0002H  2
  wIndex . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0004H  2
  wLength. . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0006H  2
_device_request. . . . . . . . . . . .  * TAG *  -----  STRUCT   -----  8
  bmRequestType. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  bRequest . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  wValue . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0002H  2
  wIndex . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0004H  2
  wLength. . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0006H  2
_TestoneChip_Status_information. . . .  PUBLIC   CODE   PROC     0000H  -----
  Chipi. . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
ReadOnePage_C. . . . . . . . . . . . .  PUBLIC   CODE   PROC     0027H  -----
  j. . . . . . . . . . . . . . . . . .  * REG *  DATA   INT      0006H  2
  m. . . . . . . . . . . . . . . . . .  * REG *  DATA   INT      0004H  2
CR0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D8H  1
CR1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D9H  1
CR2. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00DFH  1
ES0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00ACH  1
CT2. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00C9H  1
ET0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A9H  1
ES1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00ADH  1
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 104 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


ET1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00ABH  1
TF0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008DH  1
ADDR17_24. . . . . . . . . . . . . . .  PUBLIC   XDATA  U_CHAR   0674H  1
ET2. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00E8H  1
TF1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008FH  1
TF2. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00CFH  1
RB8. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      009AH  1
rom_addr . . . . . . . . . . . . . . .  TYPEDEF  -----  UNION    -----  2
  byte . . . . . . . . . . . . . . . .  MEMBER   -----  STRUCT   0000H  2
  word . . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0000H  2
EX0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A8H  1
IT0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0088H  1
EX1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00AAH  1
TB8. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      009BH  1
IT1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008AH  1
P. . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D0H  1
SM0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      009FH  1
num. . . . . . . . . . . . . . . . . .  PUBLIC   XDATA  U_CHAR   0675H  1
SM1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      009EH  1
ECI. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0092H  1
CheckFlash . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0015H  -----
  i. . . . . . . . . . . . . . . . . .  * REG *  DATA   INT      0006H  2
SM2. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      009DH  1
PS0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00BCH  1
_USBSendData . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
PT0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00BAH  1
PS1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00BDH  1
EPPFLAGS . . . . . . . . . . . . . . .  TYPEDEF  -----  UNION    -----  2
  bits . . . . . . . . . . . . . . . .  MEMBER   -----  STRUCT   0000H  2
  value. . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0000H  2
RS0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D3H  1
PT1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00BBH  1
RS1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D4H  1
PT2. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00BFH  1
TR0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008CH  1
TR1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008EH  1
TR2. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00CAH  1
PX0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00BAH  1
SDA. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0097H  1
PX1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00BAH  1
TestallChip_Status_information . . . .  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
Erasel . . . . . . . . . . . . . . . .  PUBLIC   XDATA  U_CHAR   0676H  1
_FindPage. . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  offset . . . . . . . . . . . . . . .  AUTO     DATA   U_LONG   0000H  4
  j. . . . . . . . . . . . . . . . . .  AUTO     DATA   U_LONG   0004H  4
  k. . . . . . . . . . . . . . . . . .  AUTO     DATA   U_LONG   0008H  4
  l. . . . . . . . . . . . . . . . . .  AUTO     DATA   U_LONG   000CH  4
  m. . . . . . . . . . . . . . . . . .  AUTO     DATA   U_LONG   0010H  4
  n. . . . . . . . . . . . . . . . . .  AUTO     DATA   U_LONG   0014H  4
SCL. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0096H  1
EXEN2. . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00CBH  1
PPC. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00BEH  1
EraseFlash . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
S0CON. . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0098H  1
REN. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      009CH  1
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 105 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


S1CON. . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D8H  1
AD10 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A2H  1
USHORT . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
UNION_Data . . . . . . . . . . . . . .  * TAG *  -----  UNION    -----  4
  ch . . . . . . . . . . . . . . . . .  MEMBER   -----  ARRAY    0000H  4
  i. . . . . . . . . . . . . . . . . .  MEMBER   -----  LONG     0000H  4
T2CON. . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00C8H  1
AD11 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A3H  1
MCU_D12RST . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0097H  1
_EraseOneFlash . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
  Statuse. . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  addr9_16 . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0001H  1
  addr17_24. . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0002H  1
  addr25 . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0003H  1
  pi . . . . . . . . . . . . . . . . .  * REG *  DATA   U_INT    0006H  2
  k. . . . . . . . . . . . . . . . . .  * REG *  DATA   U_INT    0006H  2
  m. . . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0004H  1
  loop . . . . . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
AD12 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A4H  1
STA. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00DDH  1
AD13 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A5H  1
_sprintf . . . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
AD14 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A6H  1
AD15 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A7H  1
rdata_buffer . . . . . . . . . . . . .  PUBLIC   XDATA  ARRAY    0677H  512
RXD. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B0H  1
_flags . . . . . . . . . . . . . . . .  * TAG *  -----  STRUCT   -----  2
  timer. . . . . . . . . . . . . . . .  MEMBER   -----  FIELD    0000H  1.0
  bus_reset. . . . . . . . . . . . . .  MEMBER   -----  FIELD    0000H  1.1
  suspend. . . . . . . . . . . . . . .  MEMBER   -----  FIELD    0000H  1.2
  setup_packet . . . . . . . . . . . .  MEMBER   -----  FIELD    0000H  1.3
  remote_wakeup. . . . . . . . . . . .  MEMBER   -----  FIELD    0000H  1.4
  in_isr . . . . . . . . . . . . . . .  MEMBER   -----  FIELD    0000H  1.5
  control_state. . . . . . . . . . . .  MEMBER   -----  FIELD    0000H  2.6
  configuration. . . . . . . . . . . .  MEMBER   -----  FIELD    0001H  1.0
  command. . . . . . . . . . . . . . .  MEMBER   -----  FIELD    0001H  1.1
  ep1_rxdone . . . . . . . . . . . . .  MEMBER   -----  FIELD    0001H  1.2
  ep2_rxdone . . . . . . . . . . . . .  MEMBER   -----  FIELD    0001H  1.3
FileNumber . . . . . . . . . . . . . .  PUBLIC   XDATA  U_CHAR   0877H  1
TXD. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B1H  1
tmpBuf . . . . . . . . . . . . . . . .  EXTERN   XDATA  ARRAY    -----  100
wdata_buffer . . . . . . . . . . . . .  PUBLIC   XDATA  ARRAY    0878H  512
_ReadoneChip_leavefactory_invalidblock  PUBLIC   CODE   PROC     0000H  -----
  Chipi. . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
  j. . . . . . . . . . . . . . . . . .  AUTO     DATA   INT      0001H  2
  m. . . . . . . . . . . . . . . . . .  AUTO     DATA   INT      0003H  2
  addr9_16 . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0005H  1
  addr17_24. . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0006H  1
  addr25 . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0007H  1
  block. . . . . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
_FindNextBlock . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  offset . . . . . . . . . . . . . . .  AUTO     DATA   U_LONG   0000H  4
  i. . . . . . . . . . . . . . . . . .  AUTO     DATA   U_LONG   0004H  4
  len. . . . . . . . . . . . . . . . .  AUTO     DATA   U_LONG   0008H  4
  blockaddress . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
UCHAR. . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
C51 COMPILER V6.14  FLASH                                                                  06/27/2005 09:39:43 PAGE 106 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


FindFlash. . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  * REG *  DATA   INT      0004H  2
  m. . . . . . . . . . . . . . . . . .  * REG *  DATA   INT      0002H  2
PIO_REQUEST. . . . . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
F0 . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D5H  1
STO. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00DCH  1
FlashChip. . . . . . . . . . . . . . .  PUBLIC   DATA   ARRAY    0004H  6
FindFiles. . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  AUTO     DATA   INT      0000H  2
  j. . . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0002H  1
  space9_16. . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0003H  1
  space17_24 . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0004H  1
  space25. . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0005H  1
_putbuf. . . . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
PSW. . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D0H  1
ErrorBlock . . . . . . . . . . . . . .  EXTERN   XDATA  U_INT    -----  2
CCF0 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00C0H  1
_control_xfer. . . . . . . . . . . . .  * TAG *  -----  STRUCT   -----  23
  DeviceRequest. . . . . . . . . . . .  MEMBER   -----  STRUCT   0000H  8
  wLength. . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0008H  2
  wCount . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    000AH  2
  pData. . . . . . . . . . . . . . . .  MEMBER   -----  PTR      000CH  3
  dataBuffer . . . . . . . . . . . . .  MEMBER   -----  ARRAY    000FH  8
CCF1 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00C1H  1


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   5067    ----
   CONSTANT SIZE    =    247    ----
   XDATA SIZE       =   2680    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10      71
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
